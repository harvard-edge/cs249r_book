# =============================================================================
# VOLUME I PDF CONFIGURATION (Single-spaced, 9pt â€” regular layout)
# =============================================================================
# Builds only Volume I: Introduction
#
# Usage:
#   cp config/_quarto-pdf-vol1.yml _quarto.yml
#   quarto render --to titlepage-pdf
#
# For the double-spaced copy-editing PDF, use:
#   cp config/_quarto-pdf-vol1-copyedit.yml _quarto.yml
#   quarto render --to titlepage-pdf
# =============================================================================

project:
  type: book
  output-dir: _build/pdf-vol1
  execute-dir: project
  post-render:
    - scripts/clean_svgs.py
  preview:
    browser: true
    navigate: true

execute:
  freeze: false

book:
  favicon: assets/images/icons/favicon.png
  cover-image: assets/images/covers/cover-hardcover-book-vol1.png
  cover-image-alt: "Cover image."

  title: "Introduction to Machine Learning Systems"

  date: today
  date-format: long

  author:
    name: Vijay Janapa Reddi
    email: vj@eecs.harvard.edu
    url: https://www.google.com/search?q=Vijay+Janapa+Reddi
    affiliations: Harvard University
    corresponding: true
    roles: "Author, editor and curator."

  abstract: |
    Volume I of Machine Learning Systems presents a comprehensive introduction to understanding and engineering machine learning systems, with a focus on mastering the machine learning node. This volume establishes the foundations through four progressive stages: building conceptual models, engineering complete workflows, optimizing for real-world constraints, and deploying with confidence. The content bridges theoretical foundations and practical engineering, emphasizing the systems context that engineers need to master when building AI solutions. While ML applications and tools evolve rapidly, the engineering principles for building ML systems remain largely consistent. This volume distills these enduring concepts for anyone seeking to build flexible, efficient, and robust ML systems.

  repo-url: https://github.com/harvard-edge/cs249r_book

  page-footer:
    left: |
      Written, edited and curated by Prof. Vijay Janapa Reddi (Harvard University)
    right: |
      This book was built with <a href="https://quarto.org/">Quarto</a>.

  chapters:
    - index.qmd

    # ==================================================
    # Volume I Frontmatter
    # ==================================================
    # - contents/vol1/frontmatter/foreword.qmd
    # - contents/vol1/frontmatter/about.qmd
    # - contents/vol1/frontmatter/acknowledgements.qmd
    # - contents/vol1/frontmatter/notation.qmd

    # ==================================================
    # Part I: Foundations
    # ==================================================
    # - contents/vol1/parts/foundations_principles.qmd
    # - contents/vol1/introduction/introduction.qmd
    - contents/vol1/ml_systems/ml_systems.qmd
    # - contents/vol1/workflow/workflow.qmd
    # - contents/vol1/data_engineering/data_engineering.qmd

    # ==================================================
    # Part II: Build
    # ==================================================
    # - contents/vol1/parts/build_principles.qmd
    # - contents/vol1/dl_primer/dl_primer.qmd
    # - contents/vol1/dnn_architectures/dnn_architectures.qmd
    # - contents/vol1/frameworks/frameworks.qmd
    # - contents/vol1/training/training.qmd

    # ==================================================
    # Part III: Optimize
    # ==================================================
    # - contents/vol1/parts/optimize_principles.qmd
    # - contents/vol1/data_selection/data_selection.qmd
    # - contents/vol1/optimizations/model_compression.qmd
    # - contents/vol1/hw_acceleration/hw_acceleration.qmd
    # - contents/vol1/benchmarking/benchmarking.qmd

    # ==================================================
    # Part IV: Deploy
    # ==================================================
    # - contents/vol1/parts/deploy_principles.qmd
    # - contents/vol1/serving/serving.qmd
    # - contents/vol1/ops/ops.qmd
    # - contents/vol1/responsible_engr/responsible_engr.qmd
    # - contents/vol1/conclusion/conclusion.qmd
    # - contents/vol1/backmatter/references.qmd

  # appendices:
    # - contents/vol1/backmatter/appendix_dam.qmd
    # - contents/vol1/backmatter/appendix_machine.qmd
    # - contents/vol1/backmatter/appendix_algorithm.qmd
    # - contents/vol1/backmatter/appendix_data.qmd
    # - contents/vol1/backmatter/glossary/glossary.qmd

bibliography:
  - contents/vol1/backmatter/references.bib

crossref:
  appendix-title: "Appendix"
  appendix-delim: ":"
  custom:
    - kind: float
      key: vid
      latex-env: vid
      reference-prefix: Video

citation: true
license: CC-BY-NC-SA

filters:
  - filters/sidenote.lua
  - filters/inject_parts.lua
  - filters/dropcap.lua
  # - filters/inject_quizzes.lua  # Disabled for PDF builds
  - pandoc-ext/diagram
  - mlsysbook-ext/custom-numbered-blocks

filter-metadata:
  quiz-config:
    file-pattern: "*_quizzes.json"
    scan-directory: "contents/vol1"
    auto-discover-pdf: true

  part-summaries:
    file: "contents/vol1/parts/summaries.yml"
    enabled: true

  mlsysbook-ext/custom-numbered-blocks:
    icon-path: "assets/images/icons/callouts"
    icon-format: "pdf"
    groups:
      quiz-question:
        colors: ["F0F0F8", "5B4B8A"]
        collapse: false
        numbered: false
      quiz-answer:
        colors: ["E8F2EA", "4A7C59"]
        collapse: true
        numbered: false
      resource-slides:
        colors: ["E0F2F1", "20B2AA"]
        collapse: true
        numbered: false
      resource-videos:
        colors: ["E0F2F1", "20B2AA"]
        collapse: true
        numbered: false
      resource-exercises:
        colors: ["E0F2F1", "20B2AA"]
        collapse: true
        numbered: false
      chapter-connection:
        colors: ["FDF2F7", "A51C30"]
        collapse: true
        numbered: false
      chapter-forward:
        colors: ["FDF2F7", "A51C30"]
        collapse: true
        numbered: false
      chapter-recall:
        colors: ["FFF4E6", "C06014"]
        collapse: true
        numbered: false
      code-listing:
        colors: ["F2F4F8", "D1D7E0"]
        collapse: false
        numbered: false
      definition:
        colors: ["F0F4F8", "1B4F72"]
        collapse: false
        numbered: false
      example:
        colors: ["F0F8F6", "148F77"]
        collapse: false
        numbered: false
      engineers-notebook:
        colors: ["F2F7FF", "2C5282"]
        collapse: false
        numbered: false
      colab-interactive:
        colors: ["FFF5E6", "FF6B35"]
        collapse: false
        numbered: false
      lighthouse:
        colors: ["FDF8E6", "B8860B"]
        collapse: false
        numbered: false
      perspective:
        colors: ["F7F8FA", "4A5568"]
        collapse: false
        numbered: false
      checkpoint:
        colors: ["FFF8E7", "D97706"]
        collapse: false
        numbered: false
      principle:
        colors: ["F3F2FA", "3D3B8E"]
        collapse: false
        numbered: true
      takeaways:
        colors: ["FDF2F7", "BE185D"]
        collapse: false
        numbered: false
      theorem:
        colors: ["F5F0FA", "6B46C1"]
        collapse: false
        numbered: true
    classes:
      callout-quiz-question:
        label: "Self-Check: Question"
        group: quiz-question
      callout-quiz-answer:
        label: "Self-Check: Answer"
        group: quiz-answer
      callout-resource-slides:
        label: "Listing"
        group: resource-slides
      callout-resource-videos:
        label: "Videos"
        group: resource-videos
      callout-resource-exercises:
        label: "Exercises"
        group: resource-exercises
      callout-chapter-connection:
        label: "What's Next"
        group: chapter-connection
      callout-code:
        label: "Code"
        group: code-listing
      callout-definition:
        label: "Definition"
        group: definition
      callout-example:
        label: "Example"
        group: example
      callout-notebook:
        label: "AI Engineer's Notebook"
        group: engineers-notebook
      callout-colab:
        label: "Interactive Colab"
        group: colab-interactive
      callout-lighthouse:
        label: "Lighthouse"
        group: lighthouse
      callout-perspective:
        label: "Systems Perspective"
        group: perspective
      callout-checkpoint:
        label: "Checkpoint"
        group: checkpoint
      callout-principle:
        label: "Principle"
        group: principle
      callout-theorem:
        label: "Theorem"
        group: theorem
      callout-takeaways:
        label: "Takeaways"
        group: takeaways

diagram:
  engine:
    dot: false
    mermaid: false
    asymptote: false
    tikz:
      execpath: lualatex
      header-includes:
        - '\usepackage{tikz}'
        - '\usepackage{pgfplots}'
        - '\usepackage{pgf-pie}'
        - '\usepackage{amsmath}'
        - '\usepackage{amssymb}'
        - '\usepackage{xcolor}'
        - '\pgfplotsset{compat=1.9}'
        - '\usepgfplotslibrary{fillbetween}'
        - '\usetikzlibrary{angles}'
        - '\usetikzlibrary{arrows.meta}'
        - '\usetikzlibrary{arrows}'
        - '\usetikzlibrary{backgrounds}'
        - '\usetikzlibrary{bending}'
        - '\usetikzlibrary{calc}'
        - '\usetikzlibrary{shadows.blur}'
        - '\usetikzlibrary{fit}'
        - '\usetikzlibrary{intersections}'
        - '\usetikzlibrary{positioning}'
        - '\usetikzlibrary{shapes.geometric}'
        - '\usetikzlibrary{shapes}'
        - '\usetikzlibrary{quotes}'
        - '\usetikzlibrary{decorations.pathmorphing}'
        - '\usetikzlibrary{decorations.markings}'
        - '\usetikzlibrary{matrix}'
        - '\usepgfplotslibrary{dateplot}'
        - '\usepgfplotslibrary{polar}'
        - '\definecolor{Brown}{rgb}{0.65, 0.16, 0.16}'
        - '\definecolor{BrownL}{RGB}{233,222,220}'
        - '\definecolor{BrownLine}{RGB}{143,120,116}'
        - '\definecolor{BackColor}{RGB}{255,255,229}'
        - '\definecolor{BackLine}{RGB}{181,181,72}'
        - '\definecolor{BlueD}{RGB}{62,100,125}'
        - '\definecolor{BlueL}{RGB}{209,243,255}'
        - '\definecolor{BlueLine}{HTML}{006395}'
        - '\definecolor{BlueFill}{HTML}{D6EAF8}'
        - '\definecolor{Green}{rgb}{0.0, 0.5, 0.0}'
        - '\definecolor{GreenD}{RGB}{40,117,40}'
        - '\definecolor{GreenL}{RGB}{219,253,166}'
        - '\definecolor{GreenLine}{HTML}{008F45}'
        - '\definecolor{GreenFill}{HTML}{D5F5E3}'
        - '\definecolor{GrayLine}{HTML}{666666}'
        - '\definecolor{OliveL}{RGB}{230,227,191}'
        - '\definecolor{OliveLine}{RGB}{173,166,10}'
        - '\definecolor{OrangeL}{RGB}{250,212,175}'
        - '\definecolor{OrangeLine}{HTML}{E67817}'
        - '\definecolor{RedL}{RGB}{253,226,240}'
        - '\definecolor{RedLine}{HTML}{D9534F}'
        - '\definecolor{RedFill}{HTML}{F2D7D5}'
        - '\definecolor{Sepia}{rgb}{0.44, 0.26, 0.08}'
        - '\definecolor{TextColor}{RGB}{224,224,224}'
        - '\definecolor{TextBlack}{HTML}{333333}'
        - '\definecolor{VioletL}{RGB}{247,180,247}'
        - '\definecolor{VioletL2}{RGB}{243,243,255}'
        - '\definecolor{VioletLine}{HTML}{7E317B}'
        - '\definecolor{VioletLine2}{RGB}{169,136,229}'
        - '\definecolor{YellowLine}{RGB}{251, 188, 4}'
        - '\definecolor{YellowFill}{RGB}{254, 247, 224}'
        - '\definecolor{OrangeFill}{RGB}{255, 237, 213}'
        - '\definecolor{VioletFill}{RGB}{237, 231, 246}'
        - '\definecolor{CubeColor}{RGB}{200, 200, 200}'
        - '\definecolor{myblue}{RGB}{31,119,180}'
        - '\definecolor{myorange}{RGB}{255,127,14}'
        - '\definecolor{mygreen}{RGB}{44,160,44}'
        - '\definecolor{myred}{RGB}{214,39,40}'
        - '\definecolor{mypurple}{RGB}{148,103,189}'
        - '\definecolor{mybrown}{RGB}{140,86,75}'
        - '\definecolor{myolive}{RGB}{173,166,10}'
        - '\definecolor{BlueGreen}{RGB}{20,188,188}'
        - '\definecolor{Cerulean}{RGB}{0,173,231}'
        - '\definecolor{Dandelion}{RGB}{255,185,76}'
        - '\definecolor{Goldenrod}{RGB}{255,219,87}'
        - '\definecolor{Lavender}{RGB}{253,160,204}'
        - '\definecolor{LimeGreen}{RGB}{136,201,70}'
        - '\definecolor{Maroon}{RGB}{186,49,50}'
        - '\definecolor{OrangeRed}{RGB}{255,46,88}'
        - '\definecolor{Peach}{RGB}{255,147,88}'
        - '\definecolor{Thistle}{RGB}{222,132,191}'
        - '\definecolor{Siva}{RGB}{161,152,130}'

editor:
  render-on-save: true

format:
  titlepage-pdf:
    pdf-engine: lualatex
    use-rsvg-convert: true
    documentclass: scrbook
    classoption: [abstract,titlepage]
    header-includes: |
      \usepackage{needspace}
      \let\Needspace\needspace

    coverpage: true
    coverpage-title: "Machine Learning Systems"
    coverpage-bg-image: "assets/images/covers/cover-image-transparent-vol1.png"
    coverpage-author: ["Vijay Janapa Reddi"]
    coverpage-footer: "Introduction to"
    coverpage-theme:
        page-text-align: "left"
        bg-image-left: "0.225\\paperwidth"
        bg-image-bottom: 9
        bg-image-rotate: 0
        bg-image-opacity: 1.0
        header-style: "none"
        date-style: "none"

        footer-fontsize: 25
        footer-left: "0.075\\paperwidth"
        footer-bottom: "0.475\\paperwidth"
        footer-width: "0.9\\paperwidth"
        footer-align: "left"

        title-fontsize: 52
        title-left: "0.075\\paperwidth"
        title-bottom: "0.4\\paperwidth"
        title-width: "0.9\\paperwidth"

        author-style: "plain"
        author-sep: "newline"
        author-fontsize: 20
        author-align: "right"
        author-bottom: "0.175\\paperwidth"
        #author-left: "0.075\\paperwidth"
        author-left: ".925\\paperwidth"
        author-width: 6in

    titlepage: true
    titlepage-theme:
      elements: [ "\\titleblock",
                  "Prof. Vijay Janapa Reddi",
                  "School of Engineering and Applied Sciences",
                  "Harvard University",
                  "\\vspace{80mm}",
                  "With heartfelt gratitude to the community for their invaluable contributions and steadfast support.",
                  "\\vfill",
                  "{{< meta date >}}",
                  "\\vfill"]
      date: "today"
      date-format: long
      page-align: "left"
      title-style: "plain"
      title-fontstyle: ["huge", "bfseries"]
      title-space-after: "4\\baselineskip"
      title-subtitle-space-between: "0.05\\textheight"
      subtitle-fontstyle: ["large", "textit"]
      author-style: "superscript-with-and"
      author-fontstyle: "large"
      affiliation-style: "numbered-list-with-correspondence"
      affiliation-fontstyle: "large"
      affiliation-space-after: "0pt"
      footer-style: "plain"
      footer-fontstyle: "large"
      logo-size: "0.15\\textheight"
      logo-space-after: "1\\baselineskip"
      vrule-width: "2pt"
      vrule-align: "left"
      vrule-color: "black"

    toc: true
    lof: true
    lot: true
    lol: true
    top-level-division: chapter
    number-sections: true
    toc-depth: 3
    number-depth: 3
    keep-tex: true
    citation-package: natbib
    link-citations: true
    biblio-title: "References"
    cite-method: citeproc
    title-block-style: none
    indent: 0px
    fontsize: 9pt
    colorlinks: true
    reference-location: document
    citation-location: block
    fig-caption: true
    fig-cap-location: bottom
    tbl-cap-location: top
    tbl-colwidths: auto
    hyperrefoptions:
      - linktoc=all
      - pdfwindowui
      - pdfpagemode=FullScreen
      - pdfpagelayout=TwoPageRight
    include-in-header:
      - file: "tex/header-includes.tex"
      - text: |
          \usepackage{needspace}
          \let\Needspace\needspace
    include-before-body:
      - file: "tex/before-body-includes.tex"
    include-after-body:
      - file: "tex/after-body-includes.tex"
    listings: false
    highlight-style: assets/styles/custom-code.theme
