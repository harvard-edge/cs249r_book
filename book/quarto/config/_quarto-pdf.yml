# =============================================================================
# ACADEMIC PDF CONFIGURATION
# =============================================================================
# This configuration is optimized for professional academic PDF book output.
#
# Key Features:
# - Traditional book project type with linear chapter flow
# - Full LaTeX rendering with LuaLaTeX engine for advanced typography
# - Complete citation support and academic formatting
# - Professional part pages with custom TikZ designs
# - All Lua filters enabled (sidenotes, part summaries, cross-refs, etc.)
# - Traditional chapter numbering and book structure
# - Custom LaTeX includes for enhanced visual design
#
# Usage:
#   make build-pdf     # Uses this config automatically
#   make preview-pdf   # Uses this config for PDF development
#
# Part of the dual-configuration system:
#   _quarto-html.yml   # Website optimized
#   _quarto-pdf.yml    # This file (academic PDF optimized)
# =============================================================================

project:
  type: book
  output-dir: _build/pdf
  post-render:
    - scripts/clean_svgs.py
  preview:
    browser: true
    navigate: true

book:
  favicon: assets/images/icons/favicon.png
  cover-image: assets/images/covers/cover-hardcover-book.png
  cover-image-alt: "Cover image."

  title: "Machine Learning Systems"
  subtitle: "Principles and Practices of Engineering Artificially Intelligent Systems"

  date: today
  date-format: long

  author:
    name: Vijay Janapa Reddi
    email: vj@eecs.harvard.edu
    url: https://www.google.com/search?q=Vijay+Janapa+Reddi
    affiliations: Harvard University
    corresponding: true
    roles: "Author, editor and curator."

  abstract: |
    Machine Learning Systems presents a comprehensive approach to understanding and engineering machine learning (ML). While many resources focus on ML algorithms and model architectures, this book serves as a bridge between theoretical foundations and practical engineering. It emphasizes the systems context that engineers need to master when building AI solutions in the real world. The text progresses from foundational concepts to advanced system design, integrating topics such as data engineering, model optimization, hardware-aware training approaches, and inference acceleration strategies. Throughout the book, readers develop a principled understanding of ML systems engineering, learning to reason about system architectures and address critical challenges in areas including security, privacy, and reliability. While ML applications and tools evolve rapidly, the engineering principles for building ML systems remain largely consistent. This book distills these enduring concepts, making it a resource for anyone seeking to build flexible, efficient, and robust ML systems.

    ----

    üéô Listen to the **AI Podcast**,
    created using Google's Notebook LM and inspired by insights drawn from our
    [IEEE education viewpoint paper](https://web.eng.fiu.edu/gaquan/Papers/ESWEEK24Papers/CPS-Proceedings/pdfs/CODES-ISSS/563900a043/563900a043.pdf).
    This podcast provides an accessible overview of what this book is all about.

    &nbsp;
    <audio controls>
    <source src="assets/media/notebooklm_podcast_mlsysbookai.mp3" type="audio/mpeg">
    </audio>

    ----

  repo-url: https://github.com/harvard-edge/cs249r_book

  page-footer:
    left: |
      Written, edited and curated by Prof. Vijay Janapa Reddi (Harvard University)
    right: |
      This book was built with <a href="https://quarto.org/">Quarto</a>.

  chapters:
    - index.qmd

    # ==================================================
    # Frontmatter
    # ==================================================

    - contents/frontmatter/foreword.qmd
    - contents/frontmatter/about/about.qmd
    - contents/frontmatter/changelog/changelog.qmd
    - contents/frontmatter/acknowledgements/acknowledgements.qmd
    - contents/frontmatter/socratiq/socratiq.qmd

    # ==========================================================================
    # VOLUME I: INTRODUCTION TO ML SYSTEMS
    # ==========================================================================

    # --------------------------------------------------
    # Part I: ML Foundations
    # --------------------------------------------------

    - contents/vol1/introduction/introduction.qmd
    - contents/vol1/ml_systems/ml_systems.qmd
    - contents/vol1/dl_primer/dl_primer.qmd
    - contents/vol1/dnn_architectures/dnn_architectures.qmd

    # --------------------------------------------------
    # Part II: System Development
    # --------------------------------------------------

    - contents/vol1/workflow/workflow.qmd
    - contents/vol1/data_engineering/data_engineering.qmd
    - contents/vol1/frameworks/frameworks.qmd
    - contents/vol1/training/training.qmd

    # --------------------------------------------------
    # Part III: Model Optimization
    # --------------------------------------------------

    - contents/vol1/efficient_ai/efficient_ai.qmd
    - contents/vol1/optimizations/optimizations.qmd
    - contents/vol1/hw_acceleration/hw_acceleration.qmd
    - contents/vol1/benchmarking/benchmarking.qmd

    # --------------------------------------------------
    # Part IV: System Operations
    # --------------------------------------------------

    - contents/vol1/ops/ops.qmd
    - contents/vol1/responsible_engr/responsible_engr.qmd
    - contents/vol1/conclusion/conclusion.qmd

    # ==========================================================================
    # VOLUME II: ADVANCED ML SYSTEMS
    # ==========================================================================

    # --------------------------------------------------
    # Part V: Foundations of Scale
    # --------------------------------------------------

    - contents/vol2/introduction/introduction.qmd
    - contents/vol2/infrastructure/infrastructure.qmd
    - contents/vol2/storage/storage.qmd
    - contents/vol2/communication/communication.qmd

    # --------------------------------------------------
    # Part VI: Distributed Systems
    # --------------------------------------------------

    - contents/vol2/distributed_training/distributed_training.qmd
    - contents/vol2/inference/inference.qmd
    - contents/vol2/edge_intelligence/edge_intelligence.qmd
    - contents/vol2/fault_tolerance/fault_tolerance.qmd

    # --------------------------------------------------
    # Part VII: Production Challenges
    # --------------------------------------------------

    - contents/vol2/ondevice_learning/ondevice_learning.qmd
    - contents/vol2/privacy_security/privacy_security.qmd
    - contents/vol2/robust_ai/robust_ai.qmd
    - contents/vol2/ops_scale/ops_scale.qmd

    # --------------------------------------------------
    # Part VIII: Responsible Deployment
    # --------------------------------------------------

    - contents/vol2/responsible_ai/responsible_ai.qmd
    - contents/vol2/sustainable_ai/sustainable_ai.qmd
    - contents/vol2/ai_for_good/ai_for_good.qmd
    - contents/vol2/frontiers/frontiers.qmd
    - contents/vol2/conclusion/conclusion.qmd

    # ==================================================
    # Backmatter
    # ==================================================

    - contents/backmatter/glossary/glossary.qmd
    - contents/backmatter/references.qmd

bibliography:
  # Volume I chapters
  - contents/vol1/introduction/introduction.bib
  - contents/vol1/benchmarking/benchmarking.bib
  - contents/vol1/data_engineering/data_engineering.bib
  - contents/vol1/dl_primer/dl_primer.bib
  - contents/vol1/dnn_architectures/dnn_architectures.bib
  - contents/vol1/efficient_ai/efficient_ai.bib
  - contents/vol1/ml_systems/ml_systems.bib
  - contents/vol1/frameworks/frameworks.bib
  - contents/vol1/hw_acceleration/hw_acceleration.bib
  - contents/vol1/ops/ops.bib
  - contents/vol1/optimizations/optimizations.bib
  - contents/vol1/training/training.bib
  - contents/vol1/workflow/workflow.bib
  - contents/vol1/conclusion/conclusion.bib
  # Volume II chapters
  - contents/vol2/ondevice_learning/ondevice_learning.bib
  - contents/vol2/privacy_security/privacy_security.bib
  - contents/vol2/responsible_ai/responsible_ai.bib
  - contents/vol2/robust_ai/robust_ai.bib
  - contents/vol2/sustainable_ai/sustainable_ai.bib
  - contents/vol2/ai_for_good/ai_for_good.bib
  - contents/vol2/frontiers/frontiers.bib

crossref:
  appendix-title: "Appendix"
  appendix-delim: ":"

  custom:
    - kind: float
      key: vid
      latex-env: vid
      reference-prefix: Video

citation: true

license: CC-BY-NC-SA

filters:
  - filters/sidenote.lua
  - filters/inject_parts.lua
  - filters/inject_quizzes.lua
  - pandoc-ext/diagram
  - mlsysbook-ext/custom-numbered-blocks
  #- mlsysbook-ext/margin-video     ‚ö†Ô∏è Disabled for PDF builds
  #- filters/margin-connections.lua  # This filter must come after custom-numbered-blocks


# Filter configurations and metadata
filter-metadata:
  # Quiz configuration for inject_quizzes.lua filter
  quiz-config:
    file-pattern: "*_quizzes.json"          # Pattern for quiz file discovery in PDF builds
    scan-directory: "contents"         # Directory to scan for quiz files
    auto-discover-pdf: true                 # Whether to enable auto-discovery in PDF builds

  # Part summaries injection configuration for inject_parts.lua filter
  part-summaries:
    file: "contents/parts/summaries.yml"              # Path to part summaries YAML file
    enabled: true                           # Enable/disable part summary injection

  # Custom numbered blocks configuration for mlsysbook-ext/custom-numbered-blocks filter
  mlsysbook-ext/custom-numbered-blocks:
    icon-path: "assets/images/icons/callouts"  # Path to callout icons
    icon-format: "pdf"                         # Icon format for PDF builds
    groups:
      quiz-question:
        colors: ["F0F0F8", "5B4B8A"]  # Darker purple for quiz questions
        collapse: false
      quiz-answer:
        colors: ["E8F2EA", "4a7c59"]  # Forest green for quiz answers
        collapse: true
      resource-slides:
        colors: ["E0F2F1", "20B2AA"]  # Teal for resources
        collapse: true
        numbered: false
      resource-videos:
        colors: ["E0F2F1", "20B2AA"]  # Teal for resources
        collapse: true
        numbered: false
      resource-exercises:
        colors: ["E0F2F1", "20B2AA"]  # Teal for resources
        collapse: true
        numbered: false
      chapter-connection:
        colors: ["FDF2F7", "A51C30"]  # Harvard crimson for chapter connections
        boxstyle: foldbox.simple
        collapse: true
        numbered: false
      chapter-forward:
        colors: ["FDF2F7", "A51C30"]  # Harvard crimson for chapter connections
        boxstyle: foldbox.simple
        collapse: true
        numbered: false
      chapter-recall:
        colors: ["FFF4E6", "C06014"]  # Warm orange for chapter recall
        collapse: true
        numbered: false
      code-listing:
        colors: ["F2F4F8", "D1D7E0"]  # Light blue-gray background, slate border for code listings
        collapse: false
        numbered: false
      definition:
        colors: ["F0F4F8", "1B4F72"]  # Light navy background, deep navy border for definitions (Harvard-complementary)
        collapse: false
        numbered: false
      example:
        colors: ["F0F8F6", "148F77"]  # Light teal background, deep teal border for examples (Harvard-complementary)
        collapse: false
        numbered: false
      colab-interactive:
        colors: ["FFF5E6", "FF6B35"]  # Light peach background, vibrant orange border for interactive Colabs
        collapse: false
        numbered: false
    classes:
      callout-quiz-question:
        label: "Self-Check: Question"
        group: quiz-question
      callout-quiz-answer:
        label: "Self-Check: Answer"
        group: quiz-answer
      callout-resource-slides:
        label: "Listing"
        group: resource-slides
      callout-resource-videos:
        label: "Videos"
        group: resource-videos
      callout-resource-exercises:
        label: "Exercises"
        group: resource-exercises
      callout-chapter-connection:
        label: "Related Topics"
        group: chapter-connection
      callout-code:
        label: "Code"
        group: code-listing
      callout-definition:
        label: "Definition"
        group: definition
      callout-example:
        label: "Example"
        group: example
      callout-colab:
        label: "Interactive Colab"
        group: colab-interactive

diagram:
  engine:
    dot: false
    mermaid: false
    asymptote: false
    tikz:
      execpath: lualatex
      header-includes:
        - '\usepackage{tikz}'
        - '\usepackage{pgfplots}'
        - '\usepackage{pgf-pie}'
        - '\usepackage{amsmath}'
        - '\usepackage{amssymb}'
        - '\usepackage{xcolor}'
        - '\pgfplotsset{compat=1.9}'
        - '\usepgfplotslibrary{fillbetween}'
        - '\usetikzlibrary{angles}'
        - '\usetikzlibrary{arrows.meta}'
        - '\usetikzlibrary{arrows}'
        - '\usetikzlibrary{backgrounds}'
        - '\usetikzlibrary{bending}'
        - '\usetikzlibrary{calc}'
        - '\usetikzlibrary{shadows.blur}'
        - '\usetikzlibrary{fit}'
        - '\usetikzlibrary{intersections}'
        - '\usetikzlibrary{positioning}'
        - '\usetikzlibrary{shapes.geometric}'
        - '\usetikzlibrary{shapes}'
        - '\usetikzlibrary{quotes}'
        - '\usetikzlibrary{decorations.pathmorphing}'
        - '\usetikzlibrary{decorations.markings}'
        - '\usetikzlibrary{matrix}'
        - '\usepgfplotslibrary{dateplot}'
        - '\usepgfplotslibrary{polar}'
        - '\definecolor{Brown}{rgb}{0.65, 0.16, 0.16}'
        - '\definecolor{BrownL}{rgb}{0.6, 0.4, 0.2}'
        - '\definecolor{BrownLine}{rgb}{0.5, 0.3, 0.1}'
        - '\definecolor{BackColor}{RGB}{255,255,229}'
        - '\definecolor{BackLine}{RGB}{181,181,72}'
        - '\definecolor{BlueD}{RGB}{62,100,125}'
        - '\definecolor{BlueL}{RGB}{209,243,255}'
        - '\definecolor{BlueLine}{RGB}{34,148,189}'
        - '\definecolor{BrownL}{RGB}{233,222,220}'
        - '\definecolor{BrownLine}{RGB}{143,120,116}'
        - '\definecolor{Green}{rgb}{0.0, 0.5, 0.0}'
        - '\definecolor{GreenD}{RGB}{40,117,40}'
        - '\definecolor{GreenL}{RGB}{219,253,166}'
        - '\definecolor{GreenLine}{RGB}{73,89,56}'
        - '\definecolor{OliveL}{RGB}{230,227,191}'
        - '\definecolor{OliveLine}{RGB}{173,166,10}'
        - '\definecolor{OrangeL}{RGB}{250,212,175}'
        - '\definecolor{OrangeLine}{RGB}{255,127,76}'
        - '\definecolor{RedL}{RGB}{253,226,240}'
        - '\definecolor{RedLine}{RGB}{201,20,110}'
        - '\definecolor{Sepia}{rgb}{0.44, 0.26, 0.08}'
        - '\definecolor{TextColor}{RGB}{224,224,224}'
        - '\definecolor{VioletL}{RGB}{247,180,247}'
        - '\definecolor{VioletL2}{RGB}{243,243,255}'
        - '\definecolor{VioletLine}{RGB}{34,125,189}'
        - '\definecolor{VioletLine2}{RGB}{169,136,229}'

editor:
  render-on-save: true

format:
  # ------------------------------------------------------------------------------
  # PDF Format Specific Options
  # ------------------------------------------------------------------------------
  titlepage-pdf:
    pdf-engine: lualatex
    use-rsvg-convert: true
    documentclass: scrbook
    classoption: [abstract,titlepage]
    header-includes: |
      \usepackage{needspace}
      \let\Needspace\needspace

    coverpage: true
    coverpage-title: "Machine Learning Systems"
    coverpage-bg-image: "assets/images/covers/cover-image-transparent.png"
    coverpage-author: ["Vijay", "Janapa Reddi"]
    coverpage-footer: "Introduction to"
    coverpage-theme:
        page-text-align: "center"

        bg-image-left: "0.225\\paperwidth"
        bg-image-bottom: 7
        bg-image-rotate: 0
        bg-image-opacity: 1.0

        author-style: "plain"
        author-sep: "newline"
        author-fontsize: 20
        author-align: "right"
        author-bottom: "0.132\\paperwidth" #0.15
        author-left: 7in
        author-width: 6in

        header-style: "none"
        date-style: "none"

        title-fontsize: 57
        title-left: "0.075\\paperwidth"
        title-bottom: "0.31\\paperwidth" #0.35
        title-width: "0.9\\paperwidth"

        footer-fontsize: 25
        footer-left: "0.075\\paperwidth"
        footer-bottom: "0.38\\paperwidth" #0.42
        footer-width: "0.9\\paperwidth"
        footer-align: "left"

    titlepage: true
    titlepage-theme:
      elements: [ "\\titleblock",
                  "Prof. Vijay Janapa Reddi",
                  "School of Engineering and Applied Sciences",
                  "Harvard University",
                  "\\vspace{80mm}",
                  "With heartfelt gratitude to the community for their invaluable contributions and steadfast support.",
                  "\\vfill",
                  "{{< meta date >}}",
                  "\\vfill"]
      date: "today"
      date-format: long

      page-align: "left"
      title-style: "plain"
      title-fontstyle: ["huge", "bfseries"]
      title-space-after: "4\\baselineskip"
      title-subtitle-space-between: "0.05\\textheight"
      subtitle-fontstyle: ["large", "textit"]
      author-style: "superscript-with-and"
      author-fontstyle: "large"
      affiliation-style: "numbered-list-with-correspondence"
      affiliation-fontstyle: "large"
      affiliation-space-after: "0pt"
      footer-style: "plain"
      footer-fontstyle: "large"
      logo-size: "0.15\\textheight"
      logo-space-after: "1\\baselineskip"
      vrule-width: "2pt"
      vrule-align: "left"
      vrule-color: "black"

    toc: true
    lof: false
    lot: false
    top-level-division: chapter
    number-sections: true
    toc-depth: 3
    number-depth: 3
    keep-tex: true
    citation-package: natbib
    link-citations: true
    biblio-title: "References"
    cite-method: citeproc
    title-block-style: none
    indent: 0px
    fontsize: 9pt
    colorlinks: true

    reference-location: document
    citation-location: block

    fig-caption: true
    #cap-location: margin
    fig-cap-location: bottom
    tbl-cap-location: top
    tbl-colwidths: auto
    hyperrefoptions:
      - linktoc=all
      - pdfwindowui
      - pdfpagemode=FullScreen
      - pdfpagelayout=TwoPageRight
    include-in-header:
      - file: "tex/header-includes.tex"
      - text: |
          \usepackage{needspace}
          \let\Needspace\needspace
    listings: false
    highlight-style: assets/styles/custom-code.theme
