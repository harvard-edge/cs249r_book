<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <defs>
    <marker id="arrow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#555"/>
    </marker>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="#fff" rx="4"/>

  <!-- ── Column headers ── -->
  <text x="90" y="22" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Baseline DP</text>
  <text x="245" y="22" font-size="12" font-weight="700" fill="#333" text-anchor="middle">ZeRO Stage 1</text>
  <text x="415" y="22" font-size="12" font-weight="700" fill="#333" text-anchor="middle">ZeRO Stage 2</text>
  <text x="590" y="22" font-size="12" font-weight="700" fill="#333" text-anchor="middle">ZeRO Stage 3</text>

  <!-- ── Column sub-labels ── -->
  <text x="90" y="37" font-size="9" fill="#555" text-anchor="middle">(Full replication)</text>
  <text x="245" y="37" font-size="9" fill="#555" text-anchor="middle">(Shard optimizer)</text>
  <text x="415" y="37" font-size="9" fill="#555" text-anchor="middle">(Shard opt + grad)</text>
  <text x="590" y="37" font-size="9" fill="#555" text-anchor="middle">(Shard all state)</text>

  <!-- ── Column dividers ── -->
  <line x1="170" y1="12" x2="170" y2="405" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="335" y1="12" x2="335" y2="405" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="505" y1="12" x2="505" y2="405" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- ── GPU row labels (shared left margin) ── -->
  <text x="16" y="88" font-size="9" fill="#555" font-weight="600">GPU 0</text>
  <text x="16" y="164" font-size="9" fill="#555" font-weight="600">GPU 1</text>
  <text x="16" y="240" font-size="9" fill="#555" font-weight="600">GPU 2</text>
  <text x="16" y="316" font-size="9" fill="#555" font-weight="600">GPU 3</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Baseline DP: full P + G + O on each GPU ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- GPU 0 -->
  <rect x="38" y="54" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="56" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="76" y="54" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="94" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="114" y="54" width="42" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="135" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">O</text>

  <!-- GPU 1 -->
  <rect x="38" y="130" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="56" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="76" y="130" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="94" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="114" y="130" width="42" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="135" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">O</text>

  <!-- GPU 2 -->
  <rect x="38" y="206" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="56" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="76" y="206" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="94" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="114" y="206" width="42" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="135" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">O</text>

  <!-- GPU 3 -->
  <rect x="38" y="282" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="56" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="76" y="282" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="94" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="114" y="282" width="42" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="135" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">O</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── ZeRO Stage 1: Optimizer sharded ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- GPU 0 -->
  <rect x="192" y="54" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="210" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="230" y="54" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="248" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="268" y="54" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="275" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 1 -->
  <rect x="192" y="130" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="210" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="230" y="130" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="248" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="268" y="130" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="275" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 2 -->
  <rect x="192" y="206" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="210" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="230" y="206" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="248" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="268" y="206" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="275" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 3 -->
  <rect x="192" y="282" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="210" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="230" y="282" width="36" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="248" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">G</text>
  <rect x="268" y="282" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="275" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── ZeRO Stage 2: Optimizer + Gradients sharded ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- GPU 0 -->
  <rect x="358" y="54" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="376" y="88" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="396" y="54" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="402" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="410" y="54" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="417" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 1 -->
  <rect x="358" y="130" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="376" y="164" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="396" y="130" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="402" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="410" y="130" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="417" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 2 -->
  <rect x="358" y="206" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="376" y="240" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="396" y="206" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="402" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="410" y="206" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="417" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 3 -->
  <rect x="358" y="282" width="36" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="376" y="316" font-size="8" font-weight="700" fill="#333" text-anchor="middle">P</text>
  <rect x="396" y="282" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="402" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="410" y="282" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="417" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── ZeRO Stage 3: All state sharded ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- GPU 0 -->
  <rect x="538" y="54" width="12" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="544" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">P/4</text>
  <rect x="552" y="54" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="558" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="566" y="54" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="573" y="88" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 1 -->
  <rect x="538" y="130" width="12" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="544" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">P/4</text>
  <rect x="552" y="130" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="558" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="566" y="130" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="573" y="164" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 2 -->
  <rect x="538" y="206" width="12" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="544" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">P/4</text>
  <rect x="552" y="206" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="558" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="566" y="206" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="573" y="240" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- GPU 3 -->
  <rect x="538" y="282" width="12" height="60" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="544" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">P/4</text>
  <rect x="552" y="282" width="12" height="60" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="558" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">G/4</text>
  <rect x="566" y="282" width="14" height="60" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="573" y="316" font-size="7" font-weight="700" fill="#333" text-anchor="middle">O/4</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Memory formulas per GPU ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="22" y="368" width="126" height="28" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="85" y="386" font-size="9" font-weight="600" fill="#a31f34" text-anchor="middle">16M per GPU</text>

  <rect x="182" y="368" width="126" height="28" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="245" y="386" font-size="9" font-weight="600" fill="#333" text-anchor="middle">4M + 12M/N</text>

  <rect x="352" y="368" width="126" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="415" y="386" font-size="9" font-weight="600" fill="#333" text-anchor="middle">2M + 14M/N</text>

  <rect x="527" y="368" width="126" height="28" rx="3" fill="#e8f5e9" stroke="#2d7a2d" stroke-width="1"/>
  <text x="590" y="386" font-size="9" font-weight="600" fill="#2d7a2d" text-anchor="middle">16M/N</text>

  <!-- Reduction arrows -->
  <line x1="156" y1="382" x2="174" y2="382" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="316" y1="382" x2="344" y2="382" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="486" y1="382" x2="519" y2="382" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>

  <!-- ── Legend ── -->
  <rect x="22" y="418" width="14" height="12" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="42" y="428" font-size="9" fill="#555">P = Parameters (2M)</text>

  <rect x="200" y="418" width="14" height="12" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="220" y="428" font-size="9" fill="#555">G = Gradients (2M)</text>

  <rect x="385" y="418" width="14" height="12" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="405" y="428" font-size="9" fill="#555">O = Optimizer States (12M for Adam)</text>

  <!-- ── Bottom note ── -->
  <text x="340" y="452" font-size="9" fill="#999" font-style="italic" text-anchor="middle">M = model params. Adam: 2 moments + FP32 master copy. N = 4 GPUs. Memory in bytes (BF16 + FP32).</text>

</svg>
