<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="#fff" rx="4"/>

  <!-- ── Phase column headers ── -->
  <text x="56" y="24" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Input</text>
  <text x="168" y="24" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Split</text>
  <text x="312" y="24" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Forward + Backward</text>
  <text x="478" y="24" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Gradient Sync</text>
  <text x="612" y="24" font-size="12" font-weight="700" fill="#333" text-anchor="middle">Update</text>

  <!-- ── Phase separator lines ── -->
  <line x1="114" y1="32" x2="114" y2="430" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="228" y1="32" x2="228" y2="430" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="408" y1="32" x2="408" y2="430" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="546" y1="32" x2="546" y2="430" stroke="#e0e0e0" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- ── Input Batch ── -->
  <rect x="16" y="148" width="80" height="140" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="56" y="196" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Global</text>
  <text x="56" y="210" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Batch</text>
  <text x="56" y="232" font-size="9" fill="#555" text-anchor="middle">B = 128</text>
  <text x="56" y="246" font-size="9" fill="#555" text-anchor="middle">samples</text>

  <!-- ── Split arrows from batch to mini-batches ── -->
  <line x1="96" y1="180" x2="128" y2="80" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="96" y1="205" x2="128" y2="172" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="96" y1="230" x2="128" y2="268" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="96" y1="258" x2="128" y2="362" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 0 Swimlane ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="130" y="56" width="72" height="42" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="166" y="73" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">Mini-batch 0</text>
  <text x="166" y="86" font-size="8.5" fill="#555" text-anchor="middle">32 samples</text>

  <rect x="208" y="48" width="26" height="14" rx="2" fill="#a31f34"/>
  <text x="221" y="58" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 0</text>

  <!-- Forward -->
  <rect x="236" y="50" width="58" height="22" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="265" y="65" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Forward</text>
  <!-- Loss -->
  <rect x="298" y="50" width="36" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="316" y="65" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Loss</text>
  <!-- Backward -->
  <rect x="338" y="50" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="366" y="65" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Backward</text>

  <line x1="202" y1="77" x2="234" y2="63" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="294" y1="61" x2="296" y2="61" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="334" y1="61" x2="336" y2="61" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <!-- Gradient -->
  <rect x="236" y="76" width="158" height="18" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="315" y="89" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Gradient g&#x2080;</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 1 Swimlane ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="130" y="150" width="72" height="42" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="166" y="167" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">Mini-batch 1</text>
  <text x="166" y="180" font-size="8.5" fill="#555" text-anchor="middle">32 samples</text>

  <rect x="208" y="142" width="26" height="14" rx="2" fill="#a31f34"/>
  <text x="221" y="152" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 1</text>

  <rect x="236" y="144" width="58" height="22" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="265" y="159" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Forward</text>
  <rect x="298" y="144" width="36" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="316" y="159" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Loss</text>
  <rect x="338" y="144" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="366" y="159" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Backward</text>

  <line x1="202" y1="171" x2="234" y2="157" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="294" y1="155" x2="296" y2="155" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="334" y1="155" x2="336" y2="155" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <rect x="236" y="170" width="158" height="18" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="315" y="183" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Gradient g&#x2081;</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 2 Swimlane ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="130" y="246" width="72" height="42" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="166" y="263" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">Mini-batch 2</text>
  <text x="166" y="276" font-size="8.5" fill="#555" text-anchor="middle">32 samples</text>

  <rect x="208" y="238" width="26" height="14" rx="2" fill="#a31f34"/>
  <text x="221" y="248" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 2</text>

  <rect x="236" y="240" width="58" height="22" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="265" y="255" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Forward</text>
  <rect x="298" y="240" width="36" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="316" y="255" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Loss</text>
  <rect x="338" y="240" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="366" y="255" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Backward</text>

  <line x1="202" y1="267" x2="234" y2="253" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="294" y1="251" x2="296" y2="251" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="334" y1="251" x2="336" y2="251" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <rect x="236" y="266" width="158" height="18" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="315" y="279" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Gradient g&#x2082;</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 3 Swimlane ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="130" y="340" width="72" height="42" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="166" y="357" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">Mini-batch 3</text>
  <text x="166" y="370" font-size="8.5" fill="#555" text-anchor="middle">32 samples</text>

  <rect x="208" y="332" width="26" height="14" rx="2" fill="#a31f34"/>
  <text x="221" y="342" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 3</text>

  <rect x="236" y="334" width="58" height="22" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="265" y="349" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Forward</text>
  <rect x="298" y="334" width="36" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="316" y="349" font-size="9" font-weight="600" fill="#333" text-anchor="middle">Loss</text>
  <rect x="338" y="334" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="366" y="349" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Backward</text>

  <line x1="202" y1="361" x2="234" y2="347" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="294" y1="345" x2="296" y2="345" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="334" y1="345" x2="336" y2="345" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <rect x="236" y="360" width="158" height="18" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="315" y="373" font-size="8.5" font-weight="600" fill="#333" text-anchor="middle">Gradient g&#x2083;</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── AllReduce Sync Block ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <line x1="394" y1="85" x2="432" y2="166" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <line x1="394" y1="179" x2="432" y2="192" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <line x1="394" y1="275" x2="432" y2="242" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <line x1="394" y1="369" x2="432" y2="268" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>

  <rect x="424" y="156" width="104" height="124" rx="6" fill="#e8f5e9" stroke="#2d7a2d" stroke-width="1.5"/>
  <text x="476" y="184" font-size="11" font-weight="700" fill="#2d7a2d" text-anchor="middle">AllReduce</text>
  <text x="476" y="202" font-size="9" fill="#555" text-anchor="middle">g = (1/N) &#x03A3; g&#x2096;</text>
  <text x="476" y="222" font-size="8.5" fill="#555" text-anchor="middle">Ring topology</text>
  <text x="476" y="238" font-size="8.5" fill="#555" text-anchor="middle">2(N-1)/N volume</text>

  <!-- Ring icon -->
  <circle cx="476" cy="260" r="9" fill="none" stroke="#2d7a2d" stroke-width="1"/>
  <circle cx="467" cy="260" r="2" fill="#2d7a2d"/>
  <circle cx="485" cy="260" r="2" fill="#2d7a2d"/>
  <circle cx="476" cy="251" r="2" fill="#2d7a2d"/>
  <circle cx="476" cy="269" r="2" fill="#2d7a2d"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Update Phase ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <line x1="528" y1="185" x2="556" y2="78" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>
  <line x1="528" y1="200" x2="556" y2="172" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>
  <line x1="528" y1="240" x2="556" y2="268" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>
  <line x1="528" y1="258" x2="556" y2="362" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>

  <rect x="558" y="56" width="108" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="612" y="72" font-size="9" font-weight="700" fill="#333" text-anchor="middle">GPU 0: Update</text>
  <text x="612" y="85" font-size="8" fill="#555" text-anchor="middle">&#x03B8; &#x2190; &#x03B8; - &#x03B7;&#x00B7;g</text>

  <rect x="558" y="150" width="108" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="612" y="166" font-size="9" font-weight="700" fill="#333" text-anchor="middle">GPU 1: Update</text>
  <text x="612" y="179" font-size="8" fill="#555" text-anchor="middle">&#x03B8; &#x2190; &#x03B8; - &#x03B7;&#x00B7;g</text>

  <rect x="558" y="246" width="108" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="612" y="262" font-size="9" font-weight="700" fill="#333" text-anchor="middle">GPU 2: Update</text>
  <text x="612" y="275" font-size="8" fill="#555" text-anchor="middle">&#x03B8; &#x2190; &#x03B8; - &#x03B7;&#x00B7;g</text>

  <rect x="558" y="340" width="108" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="612" y="356" font-size="9" font-weight="700" fill="#333" text-anchor="middle">GPU 3: Update</text>
  <text x="612" y="369" font-size="8" fill="#555" text-anchor="middle">&#x03B8; &#x2190; &#x03B8; - &#x03B7;&#x00B7;g</text>

  <!-- ── Identical weights annotation ── -->
  <rect x="564" y="392" width="96" height="22" rx="3" fill="#e8f5e9" stroke="#2d7a2d" stroke-width="1"/>
  <text x="612" y="407" font-size="8.5" font-weight="600" fill="#2d7a2d" text-anchor="middle">All &#x03B8; identical</text>

  <!-- ── Bottom annotations ── -->
  <text x="312" y="430" font-size="9" fill="#999" font-style="italic" text-anchor="middle">Embarrassingly parallel compute; communication only at gradient sync (10-40% of step time)</text>
  <text x="312" y="446" font-size="9" fill="#999" font-style="italic" text-anchor="middle">N = 4 GPUs, global batch B = 128, per-GPU micro-batch = 32</text>

</svg>
