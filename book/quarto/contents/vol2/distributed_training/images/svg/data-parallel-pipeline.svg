<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <defs>
    <pattern id="bubble-hatch" patternUnits="userSpaceOnUse" width="6" height="6" patternTransform="rotate(45)">
      <line x1="0" y1="0" x2="0" y2="6" stroke="#ccc" stroke-width="0.8"/>
    </pattern>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="#fff" rx="4"/>

  <!-- ── Axes ── -->
  <line x1="90" y1="40" x2="90" y2="370" stroke="#333" stroke-width="1.2"/>
  <line x1="90" y1="370" x2="660" y2="370" stroke="#333" stroke-width="1.2"/>

  <!-- ── Axis titles ── -->
  <text x="18" y="210" font-size="11" font-weight="600" fill="#333" text-anchor="middle" transform="rotate(-90,18,210)">Pipeline Stage (GPU)</text>
  <text x="375" y="400" font-size="11" font-weight="600" fill="#333" text-anchor="middle">Time Step</text>

  <!-- ── Y-axis labels ── -->
  <text x="82" y="85" font-size="9.5" fill="#555" text-anchor="end" font-weight="600">Stage 0</text>
  <text x="82" y="97" font-size="8" fill="#999" text-anchor="end">Layers 1-6</text>

  <text x="82" y="160" font-size="9.5" fill="#555" text-anchor="end" font-weight="600">Stage 1</text>
  <text x="82" y="172" font-size="8" fill="#999" text-anchor="end">Layers 7-12</text>

  <text x="82" y="237" font-size="9.5" fill="#555" text-anchor="end" font-weight="600">Stage 2</text>
  <text x="82" y="249" font-size="8" fill="#999" text-anchor="end">Layers 13-18</text>

  <text x="82" y="314" font-size="9.5" fill="#555" text-anchor="end" font-weight="600">Stage 3</text>
  <text x="82" y="326" font-size="8" fill="#999" text-anchor="end">Layers 19-24</text>

  <!-- ── X-axis tick labels ── -->
  <text x="115" y="385" font-size="9" fill="#555" text-anchor="middle">1</text>
  <text x="160" y="385" font-size="9" fill="#555" text-anchor="middle">2</text>
  <text x="205" y="385" font-size="9" fill="#555" text-anchor="middle">3</text>
  <text x="250" y="385" font-size="9" fill="#555" text-anchor="middle">4</text>
  <text x="295" y="385" font-size="9" fill="#555" text-anchor="middle">5</text>
  <text x="340" y="385" font-size="9" fill="#555" text-anchor="middle">6</text>
  <text x="385" y="385" font-size="9" fill="#555" text-anchor="middle">7</text>
  <text x="430" y="385" font-size="9" fill="#555" text-anchor="middle">8</text>
  <text x="475" y="385" font-size="9" fill="#555" text-anchor="middle">9</text>
  <text x="520" y="385" font-size="9" fill="#555" text-anchor="middle">10</text>
  <text x="565" y="385" font-size="9" fill="#555" text-anchor="middle">11</text>

  <!-- ── Grid lines ── -->
  <line x1="90" y1="116" x2="660" y2="116" stroke="#e8e8e8" stroke-width="0.8"/>
  <line x1="90" y1="192" x2="660" y2="192" stroke="#e8e8e8" stroke-width="0.8"/>
  <line x1="90" y1="268" x2="660" y2="268" stroke="#e8e8e8" stroke-width="0.8"/>
  <line x1="90" y1="345" x2="660" y2="345" stroke="#e8e8e8" stroke-width="0.8"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Forward passes (F) — Blue ── -->
  <!-- Cell size: 42x40. Gap between cells: 3px -->
  <!-- Stage 0 row: y=68. Stage 1: y=144. Stage 2: y=220. Stage 3: y=296 -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- ── Stage 0: F0-F3 at t=1..4 ── -->
  <rect x="94" y="68" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="115" y="92" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F0</text>
  <rect x="139" y="68" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="160" y="92" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F1</text>
  <rect x="184" y="68" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="205" y="92" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F2</text>
  <rect x="229" y="68" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="250" y="92" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F3</text>

  <!-- ── Stage 1: F0-F3 at t=2..5 ── -->
  <rect x="139" y="144" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="160" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F0</text>
  <rect x="184" y="144" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="205" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F1</text>
  <rect x="229" y="144" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="250" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F2</text>
  <rect x="274" y="144" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="295" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F3</text>

  <!-- ── Stage 2: F0-F3 at t=3..6 ── -->
  <rect x="184" y="220" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="205" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F0</text>
  <rect x="229" y="220" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="250" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F1</text>
  <rect x="274" y="220" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="295" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F2</text>
  <rect x="319" y="220" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="340" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F3</text>

  <!-- ── Stage 3: F0-F3 at t=4..7 ── -->
  <rect x="229" y="296" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="250" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F0</text>
  <rect x="274" y="296" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="295" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F1</text>
  <rect x="319" y="296" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="340" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F2</text>
  <rect x="364" y="296" rx="3" width="42" height="40" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="385" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">F3</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Backward passes (B) — Orange ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- ── Stage 3: B3-B0 at t=8..11 ── -->
  <rect x="409" y="296" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="430" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B3</text>
  <rect x="454" y="296" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="475" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B2</text>
  <rect x="499" y="296" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="520" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B1</text>
  <rect x="544" y="296" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="565" y="320" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B0</text>

  <!-- ── Stage 2: B3-B1 at t=9..11 ── -->
  <rect x="454" y="220" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="475" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B3</text>
  <rect x="499" y="220" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="520" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B2</text>
  <rect x="544" y="220" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="565" y="244" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B1</text>

  <!-- ── Stage 1: B3-B2 at t=10..11 ── -->
  <rect x="499" y="144" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="520" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B3</text>
  <rect x="544" y="144" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="565" y="168" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B2</text>

  <!-- ── Stage 0: B3 at t=11 ── -->
  <rect x="544" y="68" rx="3" width="42" height="40" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="565" y="92" font-size="10" font-weight="700" fill="#333" text-anchor="middle">B3</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Bubble (idle) cells ── -->
  <!-- ═══════════════════════════════════════════════ -->

  <!-- Fill-phase bubbles -->
  <rect x="94" y="144" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="94" y="220" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="139" y="220" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="94" y="296" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="139" y="296" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="184" y="296" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>

  <!-- Mid/drain bubbles -->
  <!-- Stage 0: t=5..10 (6 slots) -->
  <rect x="274" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="319" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="364" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="409" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="454" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="499" y="68" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>

  <!-- Stage 1: t=6..9 (4 slots) -->
  <rect x="319" y="144" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="364" y="144" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="409" y="144" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="454" y="144" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>

  <!-- Stage 2: t=7..8 (2 slots) -->
  <rect x="364" y="220" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <rect x="409" y="220" rx="3" width="42" height="40" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>

  <!-- ── Legend ── -->
  <rect x="94" y="416" width="18" height="13" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="118" y="427" font-size="9" fill="#555">Forward (F)</text>

  <rect x="194" y="416" width="18" height="13" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="218" y="427" font-size="9" fill="#555">Backward (B)</text>

  <rect x="304" y="416" width="18" height="13" rx="2" fill="url(#bubble-hatch)" stroke="#bbb" stroke-width="1"/>
  <text x="328" y="427" font-size="9" fill="#555">Bubble (idle)</text>

  <!-- ── Bubble overhead formula ── -->
  <text x="538" y="427" font-size="9" fill="#999" font-style="italic" text-anchor="middle">Bubble fraction = (p-1)/m</text>
  <text x="538" y="443" font-size="9" fill="#999" font-style="italic" text-anchor="middle">p = 4 stages, m = 4 micro-batches</text>

</svg>
