<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <!-- Background -->
  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- ══════════════════════════════════════════════════════════ -->
  <!-- F1B1 (1F1B) pipeline schedule                             -->
  <!-- 4 stages (GPU 0–3), 12 time steps, 4 microbatches        -->
  <!-- Grid origin: left=80, top=60, cell W=46, cell H=46       -->
  <!-- ══════════════════════════════════════════════════════════ -->

  <!-- Grid dimensions -->
  <!-- left margin = 80, top margin = 76 -->
  <!-- cell width = 46, cell height = 46 -->
  <!-- 12 columns: x = 80 + col*46, col=0..11 -->
  <!-- 4 rows:    y = 76 + row*46, row=0..3  -->

  <!-- ── Column headers (time steps) ── -->
  <text x="56" y="66" font-size="9" fill="#888" text-anchor="middle">Stage</text>
  <text x="103" y="66" font-size="9" fill="#888" text-anchor="middle">t1</text>
  <text x="149" y="66" font-size="9" fill="#888" text-anchor="middle">t2</text>
  <text x="195" y="66" font-size="9" fill="#888" text-anchor="middle">t3</text>
  <text x="241" y="66" font-size="9" fill="#888" text-anchor="middle">t4</text>
  <text x="287" y="66" font-size="9" fill="#888" text-anchor="middle">t5</text>
  <text x="333" y="66" font-size="9" fill="#888" text-anchor="middle">t6</text>
  <text x="379" y="66" font-size="9" fill="#888" text-anchor="middle">t7</text>
  <text x="425" y="66" font-size="9" fill="#888" text-anchor="middle">t8</text>
  <text x="471" y="66" font-size="9" fill="#888" text-anchor="middle">t9</text>
  <text x="517" y="66" font-size="9" fill="#888" text-anchor="middle">t10</text>
  <text x="563" y="66" font-size="9" fill="#888" text-anchor="middle">t11</text>
  <text x="609" y="66" font-size="9" fill="#888" text-anchor="middle">t12</text>

  <!-- ── Row labels ── -->
  <text x="56" y="106" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">GPU 0</text>
  <text x="56" y="116" font-size="8" fill="#666" text-anchor="middle">(Stage 0)</text>
  <text x="56" y="152" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">GPU 1</text>
  <text x="56" y="162" font-size="8" fill="#666" text-anchor="middle">(Stage 1)</text>
  <text x="56" y="198" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">GPU 2</text>
  <text x="56" y="208" font-size="8" fill="#666" text-anchor="middle">(Stage 2)</text>
  <text x="56" y="244" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">GPU 3</text>
  <text x="56" y="254" font-size="8" fill="#666" text-anchor="middle">(Stage 3)</text>

  <!-- ════════════════════════════════════════════════════════ -->
  <!-- Schedule cells                                          -->
  <!-- F cells: fill=#cfe2f3, stroke=#4a90c4 (blue-forward)   -->
  <!-- B cells: fill=#fdebd0, stroke=#c87b2a (orange-backward) -->
  <!-- Bubble:  fill=#e8e8e8, stroke=#aaa    (gray)            -->
  <!-- cell(col, row) => x=80+col*46, y=76+row*46, w=44, h=44 -->
  <!-- ════════════════════════════════════════════════════════ -->

  <!-- Helper macro: define cells by (col, row) 0-indexed -->

  <!-- ── GPU 0 (row 0): F1 F2 F3 F4 _ _ _ _ B4 B3 B2 B1 ── -->
  <!-- F1 col=0 -->
  <rect x="81" y="77" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="103" y="96" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="103" y="110" font-size="9" fill="#2a6099" text-anchor="middle">m1</text>
  <!-- F2 col=1 -->
  <rect x="127" y="77" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="149" y="96" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="149" y="110" font-size="9" fill="#2a6099" text-anchor="middle">m2</text>
  <!-- F3 col=2 -->
  <rect x="173" y="77" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="195" y="96" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="195" y="110" font-size="9" fill="#2a6099" text-anchor="middle">m3</text>
  <!-- F4 col=3 -->
  <rect x="219" y="77" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="241" y="96" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="241" y="110" font-size="9" fill="#2a6099" text-anchor="middle">m4</text>
  <!-- Bubble col=4 -->
  <rect x="265" y="77" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="287" y="102" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- Bubble col=5 -->
  <rect x="311" y="77" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="333" y="102" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- Bubble col=6 -->
  <rect x="357" y="77" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="379" y="102" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- Bubble col=7 -->
  <rect x="403" y="77" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="425" y="102" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- B4 col=8 -->
  <rect x="449" y="77" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="471" y="96" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="471" y="110" font-size="9" fill="#7a4010" text-anchor="middle">m4</text>
  <!-- B3 col=9 -->
  <rect x="495" y="77" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="517" y="96" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="517" y="110" font-size="9" fill="#7a4010" text-anchor="middle">m3</text>
  <!-- B2 col=10 -->
  <rect x="541" y="77" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="563" y="96" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="563" y="110" font-size="9" fill="#7a4010" text-anchor="middle">m2</text>
  <!-- B1 col=11 -->
  <rect x="587" y="77" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="609" y="96" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="609" y="110" font-size="9" fill="#7a4010" text-anchor="middle">m1</text>

  <!-- ── GPU 1 (row 1): bubble F1 F2 F3 F4 _ _ B4 B3 B2 B1 idle ── -->
  <!-- Bubble col=0 -->
  <rect x="81" y="123" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="103" y="148" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- F1 col=1 -->
  <rect x="127" y="123" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="149" y="142" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="149" y="156" font-size="9" fill="#2a6099" text-anchor="middle">m1</text>
  <!-- F2 col=2 -->
  <rect x="173" y="123" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="195" y="142" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="195" y="156" font-size="9" fill="#2a6099" text-anchor="middle">m2</text>
  <!-- F3 col=3 -->
  <rect x="219" y="123" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="241" y="142" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="241" y="156" font-size="9" fill="#2a6099" text-anchor="middle">m3</text>
  <!-- F4 col=4 -->
  <rect x="265" y="123" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="287" y="142" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="287" y="156" font-size="9" fill="#2a6099" text-anchor="middle">m4</text>
  <!-- Bubble col=5 -->
  <rect x="311" y="123" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="333" y="148" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- Bubble col=6 -->
  <rect x="357" y="123" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="379" y="148" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- B4 col=7 -->
  <rect x="403" y="123" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="425" y="142" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="425" y="156" font-size="9" fill="#7a4010" text-anchor="middle">m4</text>
  <!-- B3 col=8 -->
  <rect x="449" y="123" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="471" y="142" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="471" y="156" font-size="9" fill="#7a4010" text-anchor="middle">m3</text>
  <!-- B2 col=9 -->
  <rect x="495" y="123" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="517" y="142" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="517" y="156" font-size="9" fill="#7a4010" text-anchor="middle">m2</text>
  <!-- B1 col=10 -->
  <rect x="541" y="123" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="563" y="142" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="563" y="156" font-size="9" fill="#7a4010" text-anchor="middle">m1</text>
  <!-- idle col=11 -->
  <rect x="587" y="123" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="609" y="148" font-size="9" fill="#999" text-anchor="middle">idle</text>

  <!-- ── GPU 2 (row 2): bubble bubble F1 F2 F3 F4 B4 B3 B2 B1 idle idle ── -->
  <!-- Bubbles col=0,1 -->
  <rect x="81" y="169" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="103" y="194" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <rect x="127" y="169" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="149" y="194" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- F1 col=2 -->
  <rect x="173" y="169" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="195" y="188" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="195" y="202" font-size="9" fill="#2a6099" text-anchor="middle">m1</text>
  <!-- F2 col=3 -->
  <rect x="219" y="169" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="241" y="188" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="241" y="202" font-size="9" fill="#2a6099" text-anchor="middle">m2</text>
  <!-- F3 col=4 -->
  <rect x="265" y="169" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="287" y="188" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="287" y="202" font-size="9" fill="#2a6099" text-anchor="middle">m3</text>
  <!-- F4 col=5 -->
  <rect x="311" y="169" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="333" y="188" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="333" y="202" font-size="9" fill="#2a6099" text-anchor="middle">m4</text>
  <!-- B4 col=6 -->
  <rect x="357" y="169" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="379" y="188" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="379" y="202" font-size="9" fill="#7a4010" text-anchor="middle">m4</text>
  <!-- B3 col=7 -->
  <rect x="403" y="169" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="425" y="188" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="425" y="202" font-size="9" fill="#7a4010" text-anchor="middle">m3</text>
  <!-- B2 col=8 -->
  <rect x="449" y="169" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="471" y="188" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="471" y="202" font-size="9" fill="#7a4010" text-anchor="middle">m2</text>
  <!-- B1 col=9 -->
  <rect x="495" y="169" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="517" y="188" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="517" y="202" font-size="9" fill="#7a4010" text-anchor="middle">m1</text>
  <!-- Idle col=10,11 -->
  <rect x="541" y="169" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="563" y="194" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <rect x="587" y="169" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="609" y="194" font-size="9" fill="#999" text-anchor="middle">idle</text>

  <!-- ── GPU 3 (row 3): bubbles×3 F1 F2 F3 F4 B4 B3 B2 B1 idle×2 ── -->
  <!-- Bubbles col=0,1,2 -->
  <rect x="81" y="215" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="103" y="240" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <rect x="127" y="215" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="149" y="240" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <rect x="173" y="215" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="195" y="240" font-size="9" fill="#999" text-anchor="middle">idle</text>
  <!-- F1 col=3 -->
  <rect x="219" y="215" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="241" y="234" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="241" y="248" font-size="9" fill="#2a6099" text-anchor="middle">m1</text>
  <!-- F2 col=4 -->
  <rect x="265" y="215" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="287" y="234" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="287" y="248" font-size="9" fill="#2a6099" text-anchor="middle">m2</text>
  <!-- F3 col=5 -->
  <rect x="311" y="215" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="333" y="234" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="333" y="248" font-size="9" fill="#2a6099" text-anchor="middle">m3</text>
  <!-- F4 col=6 -->
  <rect x="357" y="215" width="44" height="44" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="379" y="234" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">F</text>
  <text x="379" y="248" font-size="9" fill="#2a6099" text-anchor="middle">m4</text>
  <!-- B4 col=7 -->
  <rect x="403" y="215" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="425" y="234" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="425" y="248" font-size="9" fill="#7a4010" text-anchor="middle">m4</text>
  <!-- B3 col=8 -->
  <rect x="449" y="215" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="471" y="234" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="471" y="248" font-size="9" fill="#7a4010" text-anchor="middle">m3</text>
  <!-- B2 col=9 -->
  <rect x="495" y="215" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="517" y="234" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="517" y="248" font-size="9" fill="#7a4010" text-anchor="middle">m2</text>
  <!-- B1 col=10 -->
  <rect x="541" y="215" width="44" height="44" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.4"/>
  <text x="563" y="234" font-size="10" font-weight="700" fill="#7a4010" text-anchor="middle">B</text>
  <text x="563" y="248" font-size="9" fill="#7a4010" text-anchor="middle">m1</text>
  <!-- Idle col=11 -->
  <rect x="587" y="215" width="44" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="609" y="240" font-size="9" fill="#999" text-anchor="middle">idle</text>

  <!-- ── Bubble bracket annotations ── -->
  <!-- Left bubble bracket at GPU3, cols 0-2 -->
  <line x1="81" y1="270" x2="219" y2="270" stroke="#c44" stroke-width="1.2" stroke-dasharray="4,3"/>
  <text x="150" y="284" font-size="8.5" fill="#c44" text-anchor="middle" font-style="italic">startup bubble (p-1 steps)</text>

  <!-- ── Legend ── -->
  <rect x="80" y="308" width="540" height="56" rx="4" fill="#f2f2f2" stroke="#ccc" stroke-width="1"/>

  <rect x="96" y="322" width="22" height="22" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="125" y="337" font-size="10" fill="#333">Forward pass (F)</text>

  <rect x="224" y="322" width="22" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="253" y="337" font-size="10" fill="#333">Backward pass (B)</text>

  <rect x="360" y="322" width="22" height="22" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1.2"/>
  <text x="389" y="337" font-size="10" fill="#333">Pipeline bubble (idle)</text>

  <!-- ── Formula box ── -->
  <rect x="80" y="376" width="540" height="60" rx="4" fill="#e8f5e9" stroke="#3d9e5a" stroke-width="1.3"/>
  <text x="350" y="398" font-size="11" font-weight="700" fill="#2d7040" text-anchor="middle">
    Bubble fraction = (p &#x2212; 1) / (p + m &#x2212; 1)
  </text>
  <text x="350" y="420" font-size="9.5" fill="#555" text-anchor="middle">
    Here: p = 4 stages, m = 4 microbatches &#x27F9; bubble = 3/7 &#x2248; 43%. With m = 32: bubble &#x2248; 9%.
  </text>

</svg>
