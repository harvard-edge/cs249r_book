<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <defs>
    <marker id="arr" markerWidth="9" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#555"/>
    </marker>
    <marker id="arr-blue" markerWidth="9" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arr-green" markerWidth="9" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
    <marker id="arr-red" markerWidth="9" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#c44"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- ══════════════════════════════════════ -->
  <!-- Divider line between two panels        -->
  <!-- ══════════════════════════════════════ -->
  <line x1="340" y1="30" x2="340" y2="430" stroke="#ccc" stroke-width="1.5" stroke-dasharray="6,4"/>

  <!-- ══════════════════════════════════════ -->
  <!-- LEFT PANEL: Column Parallel           -->
  <!-- ══════════════════════════════════════ -->
  <text x="170" y="46" font-size="13" font-weight="700" fill="#333" text-anchor="middle">Column Parallel</text>

  <!-- Weight matrix W, split vertically into W1 | W2 -->
  <!-- W1: GPU 0 (blue) -->
  <rect x="96" y="70" width="72" height="100" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.8"/>
  <text x="132" y="108" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">W₁</text>
  <text x="132" y="126" font-size="9" fill="#2a6099" text-anchor="middle">GPU 0</text>
  <text x="132" y="140" font-size="8.5" fill="#5a7a99" text-anchor="middle">[d × h/2]</text>
  <!-- W2: GPU 1 (green) -->
  <rect x="172" y="70" width="72" height="100" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.8"/>
  <text x="208" y="108" font-size="10" font-weight="700" fill="#2d7040" text-anchor="middle">W₂</text>
  <text x="208" y="126" font-size="9" fill="#2d7040" text-anchor="middle">GPU 1</text>
  <text x="208" y="140" font-size="8.5" fill="#4a7a5a" text-anchor="middle">[d × h/2]</text>

  <!-- Matrix bracket label W = [W1 | W2] -->
  <text x="132" y="65" font-size="9" fill="#888" text-anchor="middle">W₁</text>
  <text x="208" y="65" font-size="9" fill="#888" text-anchor="middle">W₂</text>
  <text x="170" y="58" font-size="9.5" fill="#555" text-anchor="middle" font-style="italic">W = [W₁ | W₂]</text>

  <!-- Input x broadcasts to both GPUs -->
  <!-- x box -->
  <rect x="130" y="200" width="80" height="36" rx="3" fill="#f0f0f0" stroke="#888" stroke-width="1.4"/>
  <text x="170" y="223" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Input x</text>

  <!-- Arrow from x to W1 -->
  <line x1="148" y1="200" x2="132" y2="172" stroke="#555" stroke-width="1.4" marker-end="url(#arr)"/>
  <!-- Arrow from x to W2 -->
  <line x1="192" y1="200" x2="208" y2="172" stroke="#555" stroke-width="1.4" marker-end="url(#arr)"/>
  <text x="100" y="193" font-size="8.5" fill="#888" font-style="italic">broadcast</text>

  <!-- Output boxes -->
  <rect x="90" y="260" width="76" height="36" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="128" y="276" font-size="9.5" font-weight="700" fill="#2a6099" text-anchor="middle">xW₁</text>
  <text x="128" y="290" font-size="8" fill="#2a6099" text-anchor="middle">GPU 0</text>

  <rect x="174" y="260" width="76" height="36" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.4"/>
  <text x="212" y="276" font-size="9.5" font-weight="700" fill="#2d7040" text-anchor="middle">xW₂</text>
  <text x="212" y="290" font-size="8" fill="#2d7040" text-anchor="middle">GPU 1</text>

  <!-- Arrows from W blocks to output -->
  <line x1="132" y1="170" x2="128" y2="260" stroke="#4a90c4" stroke-width="1.2" marker-end="url(#arr-blue)"/>
  <line x1="208" y1="170" x2="212" y2="260" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arr-green)"/>

  <!-- Combined output -->
  <rect x="104" y="332" width="132" height="36" rx="3" fill="#f7f7f7" stroke="#999" stroke-width="1.4"/>
  <text x="170" y="348" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">[xW₁, xW₂]</text>
  <text x="170" y="362" font-size="8" fill="#666" text-anchor="middle">concatenated output</text>

  <!-- Arrows to combined output -->
  <line x1="128" y1="296" x2="152" y2="332" stroke="#555" stroke-width="1.2" marker-end="url(#arr)"/>
  <line x1="212" y1="296" x2="188" y2="332" stroke="#555" stroke-width="1.2" marker-end="url(#arr)"/>

  <!-- Communication labels -->
  <rect x="84" y="390" width="172" height="30" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="170" y="404" font-size="9" font-weight="700" fill="#7a4010" text-anchor="middle">No AllReduce in forward pass</text>
  <text x="170" y="416" font-size="8.5" fill="#7a4010" text-anchor="middle">AllReduce required in backward pass</text>

  <!-- ══════════════════════════════════════ -->
  <!-- RIGHT PANEL: Row Parallel             -->
  <!-- ══════════════════════════════════════ -->
  <text x="510" y="46" font-size="13" font-weight="700" fill="#333" text-anchor="middle">Row Parallel</text>

  <!-- Weight matrix W, split horizontally: W1 on top, W2 on bottom -->
  <!-- W1: GPU 0 (blue) -->
  <rect x="436" y="70" width="148" height="46" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.8"/>
  <text x="510" y="90" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">W₁  [h/2 × d]</text>
  <text x="510" y="107" font-size="9" fill="#2a6099" text-anchor="middle">GPU 0</text>
  <!-- W2: GPU 1 (green) -->
  <rect x="436" y="120" width="148" height="46" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.8"/>
  <text x="510" y="140" font-size="10" font-weight="700" fill="#2d7040" text-anchor="middle">W₂  [h/2 × d]</text>
  <text x="510" y="157" font-size="9" fill="#2d7040" text-anchor="middle">GPU 1</text>

  <!-- Matrix label -->
  <text x="510" y="58" font-size="9.5" fill="#555" text-anchor="middle" font-style="italic">W = [W₁ ; W₂]</text>

  <!-- Split input x1 and x2 -->
  <rect x="370" y="200" width="66" height="36" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="403" y="221" font-size="10" font-weight="700" fill="#2a6099" text-anchor="middle">x₁ → GPU 0</text>

  <rect x="450" y="200" width="66" height="36" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.4"/>
  <text x="483" y="221" font-size="10" font-weight="700" fill="#2d7040" text-anchor="middle">x₂ → GPU 1</text>

  <!-- Input split label -->
  <text x="510" y="196" font-size="8.5" fill="#888" text-anchor="middle" font-style="italic">x split along feature dim</text>

  <!-- Arrows from inputs to weights -->
  <line x1="403" y1="200" x2="480" y2="168" stroke="#4a90c4" stroke-width="1.2" marker-end="url(#arr-blue)"/>
  <line x1="483" y1="200" x2="510" y2="168" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arr-green)"/>

  <!-- Partial result boxes -->
  <rect x="380" y="264" width="108" height="36" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.4"/>
  <text x="434" y="280" font-size="9.5" font-weight="700" fill="#2a6099" text-anchor="middle">x₁W₁  (partial)</text>
  <text x="434" y="294" font-size="8" fill="#2a6099" text-anchor="middle">GPU 0</text>

  <rect x="498" y="264" width="108" height="36" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.4"/>
  <text x="552" y="280" font-size="9.5" font-weight="700" fill="#2d7040" text-anchor="middle">x₂W₂  (partial)</text>
  <text x="552" y="294" font-size="8" fill="#2d7040" text-anchor="middle">GPU 1</text>

  <!-- Arrows from weights to partials -->
  <line x1="480" y1="168" x2="434" y2="264" stroke="#4a90c4" stroke-width="1.2" marker-end="url(#arr-blue)"/>
  <line x1="510" y1="168" x2="552" y2="264" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arr-green)"/>

  <!-- AllReduce symbol -->
  <rect x="388" y="330" width="212" height="30" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
  <text x="494" y="349" font-size="10" font-weight="700" fill="#c44" text-anchor="middle">AllReduce: x₁W₁ + x₂W₂</text>

  <!-- Arrows from partials to AllReduce -->
  <line x1="434" y1="300" x2="450" y2="330" stroke="#c44" stroke-width="1.4" marker-end="url(#arr-red)"/>
  <line x1="552" y1="300" x2="534" y2="330" stroke="#c44" stroke-width="1.4" marker-end="url(#arr-red)"/>

  <!-- Final output -->
  <rect x="432" y="384" width="156" height="36" rx="3" fill="#f7f7f7" stroke="#999" stroke-width="1.4"/>
  <text x="510" y="400" font-size="9.5" font-weight="700" fill="#333" text-anchor="middle">xW  (full output)</text>
  <text x="510" y="414" font-size="8" fill="#666" text-anchor="middle">both GPUs hold result</text>
  <line x1="494" y1="360" x2="494" y2="384" stroke="#555" stroke-width="1.2" marker-end="url(#arr)"/>

  <!-- Communication label -->
  <rect x="358" y="428" width="280" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="498" y="444" font-size="9" font-weight="700" fill="#7a4010" text-anchor="middle">AllReduce in forward pass; no extra comm. in backward</text>

</svg>
