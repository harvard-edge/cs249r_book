<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">

  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="#fff" rx="4"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Math equation at top ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="100" y="12" width="480" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
  <text x="340" y="28" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Tensor Parallelism: Column-wise split of linear layer Y = XW</text>
  <text x="340" y="42" font-size="9" fill="#555" text-anchor="middle">Y = X[W&#x2080; | W&#x2081; | W&#x2082; | W&#x2083;] = [XW&#x2080; | XW&#x2081; | XW&#x2082; | XW&#x2083;] = [Y&#x2080; | Y&#x2081; | Y&#x2082; | Y&#x2083;]</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Input tensor (left) ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="20" y="120" width="70" height="100" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <text x="55" y="158" font-size="11" font-weight="700" fill="#333" text-anchor="middle">X</text>
  <text x="55" y="174" font-size="8" fill="#555" text-anchor="middle">Input</text>
  <text x="55" y="186" font-size="8" fill="#555" text-anchor="middle">[B, d]</text>

  <!-- ── Broadcast arrows from X to each GPU ── -->
  <text x="124" y="112" font-size="9" font-weight="600" fill="#555">Broadcast X</text>
  <line x1="90" y1="140" x2="148" y2="100" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="90" y1="155" x2="148" y2="165" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="90" y1="175" x2="148" y2="240" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="90" y1="195" x2="148" y2="312" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 0: Weight shard W0, partial output Y0 ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="150" y="72" width="130" height="50" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <rect x="152" y="62" width="30" height="14" rx="2" fill="#a31f34"/>
  <text x="167" y="72" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 0</text>
  <text x="215" y="92" font-size="9" font-weight="700" fill="#333" text-anchor="middle">W&#x2080;: [d, d/4]</text>
  <text x="215" y="106" font-size="8.5" fill="#555" text-anchor="middle">Y&#x2080; = X &#x00D7; W&#x2080;</text>

  <!-- Partial result -->
  <rect x="296" y="76" width="60" height="38" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="326" y="94" font-size="9" font-weight="700" fill="#333" text-anchor="middle">Y&#x2080;</text>
  <text x="326" y="106" font-size="7.5" fill="#555" text-anchor="middle">[B, d/4]</text>
  <line x1="280" y1="97" x2="294" y2="95" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 1 ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="150" y="142" width="130" height="50" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <rect x="152" y="132" width="30" height="14" rx="2" fill="#a31f34"/>
  <text x="167" y="142" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 1</text>
  <text x="215" y="162" font-size="9" font-weight="700" fill="#333" text-anchor="middle">W&#x2081;: [d, d/4]</text>
  <text x="215" y="176" font-size="8.5" fill="#555" text-anchor="middle">Y&#x2081; = X &#x00D7; W&#x2081;</text>

  <rect x="296" y="148" width="60" height="38" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="326" y="166" font-size="9" font-weight="700" fill="#333" text-anchor="middle">Y&#x2081;</text>
  <text x="326" y="178" font-size="7.5" fill="#555" text-anchor="middle">[B, d/4]</text>
  <line x1="280" y1="167" x2="294" y2="167" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 2 ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="150" y="215" width="130" height="50" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <rect x="152" y="205" width="30" height="14" rx="2" fill="#a31f34"/>
  <text x="167" y="215" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 2</text>
  <text x="215" y="235" font-size="9" font-weight="700" fill="#333" text-anchor="middle">W&#x2082;: [d, d/4]</text>
  <text x="215" y="249" font-size="8.5" fill="#555" text-anchor="middle">Y&#x2082; = X &#x00D7; W&#x2082;</text>

  <rect x="296" y="221" width="60" height="38" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="326" y="239" font-size="9" font-weight="700" fill="#333" text-anchor="middle">Y&#x2082;</text>
  <text x="326" y="251" font-size="7.5" fill="#555" text-anchor="middle">[B, d/4]</text>
  <line x1="280" y1="240" x2="294" y2="240" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── GPU 3 ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="150" y="288" width="130" height="50" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <rect x="152" y="278" width="30" height="14" rx="2" fill="#a31f34"/>
  <text x="167" y="288" font-size="7.5" font-weight="700" fill="#fff" text-anchor="middle">GPU 3</text>
  <text x="215" y="308" font-size="9" font-weight="700" fill="#333" text-anchor="middle">W&#x2083;: [d, d/4]</text>
  <text x="215" y="322" font-size="8.5" fill="#555" text-anchor="middle">Y&#x2083; = X &#x00D7; W&#x2083;</text>

  <rect x="296" y="294" width="60" height="38" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="326" y="312" font-size="9" font-weight="700" fill="#333" text-anchor="middle">Y&#x2083;</text>
  <text x="326" y="324" font-size="7.5" fill="#555" text-anchor="middle">[B, d/4]</text>
  <line x1="280" y1="313" x2="294" y2="313" stroke="#555" stroke-width="0.8" marker-end="url(#arrow)"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── AllReduce / Concatenation ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <line x1="356" y1="95" x2="406" y2="170" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="356" y1="167" x2="406" y2="186" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="356" y1="240" x2="406" y2="212" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="356" y1="313" x2="406" y2="228" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow)"/>

  <rect x="400" y="160" width="110" height="80" rx="6" fill="#e8f5e9" stroke="#2d7a2d" stroke-width="1.5"/>
  <text x="455" y="186" font-size="11" font-weight="700" fill="#2d7a2d" text-anchor="middle">AllGather</text>
  <text x="455" y="204" font-size="9" fill="#555" text-anchor="middle">Concatenate</text>
  <text x="455" y="220" font-size="9" fill="#555" text-anchor="middle">[Y&#x2080;|Y&#x2081;|Y&#x2082;|Y&#x2083;]</text>
  <text x="455" y="234" font-size="8.5" fill="#555" text-anchor="middle">via NVLink</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Output tensor ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <line x1="510" y1="200" x2="548" y2="200" stroke="#555" stroke-width="1.2" marker-end="url(#arrow)"/>

  <rect x="550" y="148" width="100" height="100" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <text x="600" y="186" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Y</text>
  <text x="600" y="204" font-size="9" fill="#555" text-anchor="middle">Output</text>
  <text x="600" y="218" font-size="8" fill="#555" text-anchor="middle">[B, d]</text>
  <text x="600" y="234" font-size="8" fill="#555" text-anchor="middle">= XW</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- ── Backward pass annotation ── -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="80" y="362" width="520" height="46" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
  <text x="340" y="378" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Backward Pass: AllReduce on gradients (not AllGather)</text>
  <text x="340" y="394" font-size="9" fill="#555" text-anchor="middle">Each GPU computes local dL/dW&#x1D62;. Input gradient dL/dX requires AllReduce across GPUs.</text>

  <!-- ── Hardware constraint annotation ── -->
  <rect x="120" y="420" width="440" height="30" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="340" y="434" font-size="9" font-weight="600" fill="#a31f34" text-anchor="middle">Requires NVLink (600 GB/s): communication happens every layer, not just at step boundary</text>
  <text x="340" y="446" font-size="8" fill="#555" text-anchor="middle">Confined to intra-node (8 GPUs). Inter-node TP is infeasible on Ethernet/InfiniBand.</text>

</svg>
