<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrowD" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#555"/>
    </marker>
    <marker id="arrowR" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#c44"/>
    </marker>
    <marker id="arrowB" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#4a90c4"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- Time arrow on left side -->
  <line x1="28" y1="60" x2="28" y2="390" stroke="#bbb" stroke-width="1.5" marker-end="url(#arrowD)"/>
  <text x="22" y="230" text-anchor="middle" font-size="10" fill="#999" transform="rotate(-90,22,230)">Time</text>

  <!-- ══════════ TOP SECTION: 4-node ring, all healthy ══════════ -->
  <rect x="55" y="42" width="576" height="34" rx="0" fill="none"/>
  <text x="340" y="58" text-anchor="middle" font-size="11" font-weight="700" fill="#3d9e5a">Phase 1: 4-Node Ring — All Healthy</text>

  <!-- Ring nodes: positioned in a horizontal arrangement with ring lines -->
  <!-- Node positions: N0=145, N1=260, N2=375, N3=490 at y=100 -->
  <rect x="110" y="78" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="145" y="100" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 0</text>
  <text x="145" y="113" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 0</text>

  <rect x="230" y="78" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="265" y="100" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 1</text>
  <text x="265" y="113" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 1</text>

  <rect x="350" y="78" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="385" y="100" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 2</text>
  <text x="385" y="113" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 2</text>

  <rect x="470" y="78" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="505" y="100" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 3</text>
  <text x="505" y="113" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 3</text>

  <!-- Ring links (bidirectional) -->
  <line x1="180" y1="101" x2="230" y2="101" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <line x1="300" y1="101" x2="350" y2="101" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <line x1="420" y1="101" x2="470" y2="101" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <!-- Close the ring: N3 back to N0 (arc below) -->
  <path d="M505,124 C505,148 145,148 145,124" fill="none" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowB)"/>

  <!-- Phase 1 status -->
  <text x="560" y="98" font-size="9" fill="#3d9e5a">AllReduce: active</text>
  <text x="560" y="110" font-size="9" fill="#3d9e5a">MFU: 82%</text>

  <!-- ══════════ MIDDLE SECTION: Node 3 fails ══════════ -->
  <line x1="55" y1="168" x2="631" y2="168" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="340" y="186" text-anchor="middle" font-size="11" font-weight="700" fill="#900">Phase 2: Node 3 Fails — Job Pauses</text>

  <rect x="110" y="200" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="145" y="222" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 0</text>
  <text x="145" y="235" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 0</text>

  <rect x="230" y="200" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="265" y="222" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 1</text>
  <text x="265" y="235" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 1</text>

  <rect x="350" y="200" width="70" height="46" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="385" y="222" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 2</text>
  <text x="385" y="235" text-anchor="middle" font-size="8.5" fill="#4a90c4">rank 2</text>

  <!-- Node 3: FAILED (red X, gray) -->
  <rect x="470" y="200" width="70" height="46" rx="6" fill="#e0e0e0" stroke="#999" stroke-width="2"/>
  <text x="505" y="220" text-anchor="middle" font-size="10" font-weight="600" fill="#888">Node 3</text>
  <text x="505" y="233" text-anchor="middle" font-size="8" fill="#999">FAILED</text>
  <!-- X mark -->
  <line x1="475" y1="204" x2="536" y2="242" stroke="#c44" stroke-width="2.5"/>
  <line x1="536" y1="204" x2="475" y2="242" stroke="#c44" stroke-width="2.5"/>

  <!-- Broken ring links -->
  <line x1="180" y1="223" x2="230" y2="223" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <line x1="300" y1="223" x2="350" y2="223" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <!-- Broken link to failed node -->
  <line x1="420" y1="223" x2="468" y2="223" stroke="#c44" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="444" y="218" font-size="8" fill="#c44">broken</text>

  <!-- Pause annotation -->
  <rect x="370" y="256" width="220" height="26" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="480" y="268" text-anchor="middle" font-size="9" fill="#900" font-weight="700">Training paused</text>
  <text x="480" y="278" text-anchor="middle" font-size="8" fill="#c44">Rendezvous barrier: ranks 0,1,2 wait</text>

  <!-- Checkpoint note -->
  <rect x="60" y="256" width="200" height="26" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="160" y="268" text-anchor="middle" font-size="9" fill="#8a4000" font-weight="700">Checkpoint loaded</text>
  <text x="160" y="278" text-anchor="middle" font-size="8" fill="#c87b2a">rollback to last consistent state</text>

  <!-- ══════════ BOTTOM SECTION: 3-node ring, reformed ══════════ -->
  <line x1="55" y1="296" x2="631" y2="296" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="340" y="314" text-anchor="middle" font-size="11" font-weight="700" fill="#3d9e5a">Phase 3: 3-Node Ring — Elastic Reconfiguration</text>

  <!-- 3 remaining nodes, repositioned and re-ranked -->
  <rect x="148" y="328" width="70" height="50" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="183" y="350" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 0</text>
  <text x="183" y="362" text-anchor="middle" font-size="8" fill="#4a90c4">rank 0 (new)</text>
  <text x="183" y="372" text-anchor="middle" font-size="7.5" fill="#3d9e5a">shard +33%</text>

  <rect x="305" y="328" width="70" height="50" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="340" y="350" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 1</text>
  <text x="340" y="362" text-anchor="middle" font-size="8" fill="#4a90c4">rank 1 (new)</text>
  <text x="340" y="372" text-anchor="middle" font-size="7.5" fill="#3d9e5a">shard +33%</text>

  <rect x="462" y="328" width="70" height="50" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="2"/>
  <text x="497" y="350" text-anchor="middle" font-size="10" font-weight="600" fill="#1a4a7a">Node 2</text>
  <text x="497" y="362" text-anchor="middle" font-size="8" fill="#4a90c4">rank 2 (new)</text>
  <text x="497" y="372" text-anchor="middle" font-size="7.5" fill="#3d9e5a">shard +33%</text>

  <!-- 3-node ring links -->
  <line x1="218" y1="353" x2="305" y2="353" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <line x1="375" y1="353" x2="462" y2="353" stroke="#4a90c4" stroke-width="1.5" marker-end="url(#arrowB)"/>
  <!-- Close ring arc -->
  <path d="M497,378 C497,408 183,408 183,378" fill="none" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowB)"/>

  <!-- Elastic reconfiguration label -->
  <text x="340" y="422" text-anchor="middle" font-size="9.5" font-weight="700" fill="#1a4a7a">Elastic Reconfiguration</text>
  <text x="340" y="435" text-anchor="middle" font-size="9" fill="#555">Failed node's data shards redistributed across remaining 3 nodes</text>
  <text x="340" y="447" text-anchor="middle" font-size="9" fill="#555">MFU drops ~25% (N=3 vs N=4) but training continues — no full restart required</text>

  <!-- Phase 3 status -->
  <text x="556" y="345" font-size="9" fill="#3d9e5a">AllReduce: active</text>
  <text x="556" y="357" font-size="9" fill="#c87b2a">MFU: ~62%</text>
  <text x="556" y="369" font-size="9" fill="#888">(75% of prior)</text>
</svg>
