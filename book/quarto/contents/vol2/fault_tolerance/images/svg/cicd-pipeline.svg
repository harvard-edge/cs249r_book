<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#333"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="white"/>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── CI Section ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <rect x="20" y="30" width="310" height="80" rx="6" fill="none" stroke="#4a90c4" stroke-width="1.2" stroke-dasharray="6,4"/>
  <text x="175" y="22" text-anchor="middle" font-size="10" font-weight="700" fill="#4a90c4">Continuous Integration (CI)</text>

  <!-- ── CD Section ── -->
  <rect x="350" y="30" width="310" height="80" rx="6" fill="none" stroke="#3d9e5a" stroke-width="1.2" stroke-dasharray="6,4"/>
  <text x="505" y="22" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">Continuous Delivery (CD)</text>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── Pipeline Stages (main flow) ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->

  <!-- ── Stage 1: Code Commit ── -->
  <rect x="30" y="45" width="75" height="50" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="67" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Code</text>
  <text x="67" y="79" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Commit</text>

  <!-- Arrow -->
  <line x1="105" y1="70" x2="120" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 2: Unit Tests ── -->
  <rect x="122" y="45" width="75" height="50" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="159" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Unit</text>
  <text x="159" y="79" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Tests</text>

  <!-- Arrow -->
  <line x1="197" y1="70" x2="212" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 3: Integration Tests ── -->
  <rect x="214" y="45" width="75" height="50" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="251" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Integration</text>
  <text x="251" y="79" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Tests</text>

  <!-- Arrow (crossing into CD) -->
  <line x1="289" y1="70" x2="360" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 4: Chaos Tests (fault injection) ── -->
  <rect x="362" y="45" width="80" height="50" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
  <text x="402" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Chaos</text>
  <text x="402" y="79" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Tests</text>

  <!-- Arrow -->
  <line x1="442" y1="70" x2="457" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 5: Staging ── -->
  <rect x="459" y="45" width="75" height="50" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="496" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">Staging</text>
  <text x="496" y="79" text-anchor="middle" font-size="9" fill="#555">Shadow</text>

  <!-- Arrow -->
  <line x1="534" y1="70" x2="549" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 6: Canary ── -->
  <rect x="551" y="45" width="50" height="50" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="576" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="#3d9e5a">Canary</text>
  <text x="576" y="79" text-anchor="middle" font-size="8" fill="#555">1%</text>

  <!-- Arrow -->
  <line x1="601" y1="70" x2="611" y2="70" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Stage 7: Production ── -->
  <rect x="613" y="45" width="47" height="50" rx="5" fill="#3d9e5a" stroke="#2d7a3a" stroke-width="1.2"/>
  <text x="636" y="66" text-anchor="middle" font-size="9" font-weight="700" fill="white">Prod</text>
  <text x="636" y="79" text-anchor="middle" font-size="8" fill="#d4edda">100%</text>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── Fault Injection Detail (expanded Chaos Tests stage) ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <rect x="30" y="130" width="620" height="170" rx="6" fill="white" stroke="#c44" stroke-width="1.2"/>
  <text x="340" y="152" text-anchor="middle" font-size="12" font-weight="700" fill="#c44">Chaos / Fault Injection Stage (Detail)</text>

  <!-- ── Connection line from Chaos Tests stage ── -->
  <line x1="402" y1="95" x2="402" y2="128" stroke="#c44" stroke-width="1.2" stroke-dasharray="4,3"/>

  <!-- ── Fault type 1: Kill GPU ── -->
  <rect x="50" y="170" width="130" height="55" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="115" y="188" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Kill Random GPU</text>
  <text x="115" y="203" text-anchor="middle" font-size="8.5" fill="#555">Simulate hardware death;</text>
  <text x="115" y="215" text-anchor="middle" font-size="8.5" fill="#555">verify checkpoint recovery</text>

  <!-- ── Fault type 2: Network Partition ── -->
  <rect x="195" y="170" width="130" height="55" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="260" y="188" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Network Partition</text>
  <text x="260" y="203" text-anchor="middle" font-size="8.5" fill="#555">Split cluster into partitions;</text>
  <text x="260" y="215" text-anchor="middle" font-size="8.5" fill="#555">test collective comm failure</text>

  <!-- ── Fault type 3: Disk Full ── -->
  <rect x="340" y="170" width="130" height="55" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="405" y="188" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Disk Full</text>
  <text x="405" y="203" text-anchor="middle" font-size="8.5" fill="#555">Fill checkpoint storage;</text>
  <text x="405" y="215" text-anchor="middle" font-size="8.5" fill="#555">test graceful degradation</text>

  <!-- ── Fault type 4: Bit Corruption ── -->
  <rect x="485" y="170" width="150" height="55" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="560" y="188" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Inject Bit Corruption</text>
  <text x="560" y="203" text-anchor="middle" font-size="8.5" fill="#555">Flip bits in weights/grads;</text>
  <text x="560" y="215" text-anchor="middle" font-size="8.5" fill="#555">test SDC detection pipeline</text>

  <!-- ── Gate checks ── -->
  <rect x="50" y="240" width="585" height="44" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
  <text x="340" y="258" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Gate Checks (must all pass to proceed)</text>
  <text x="155" y="274" text-anchor="middle" font-size="8.5" fill="#555">Recovery &lt; SLA timeout</text>
  <text x="310" y="274" text-anchor="middle" font-size="8.5" fill="#555">No data loss beyond last ckpt</text>
  <text x="480" y="274" text-anchor="middle" font-size="8.5" fill="#555">Accuracy within tolerance</text>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── Staging and Canary Detail ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <rect x="30" y="318" width="300" height="105" rx="6" fill="white" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="180" y="338" text-anchor="middle" font-size="11" font-weight="700" fill="#c87b2a">Staging (Shadow Traffic)</text>

  <text x="50" y="358" font-size="9" fill="#555">&#x2022; Mirror production requests to new model</text>
  <text x="50" y="374" font-size="9" fill="#555">&#x2022; Compare responses (no user-visible impact)</text>
  <text x="50" y="390" font-size="9" fill="#555">&#x2022; Measure latency, throughput, accuracy drift</text>
  <text x="50" y="406" font-size="9" fill="#555">&#x2022; Validate checkpoint load and failover paths</text>

  <!-- ── Connection line from Staging stage ── -->
  <line x1="496" y1="95" x2="180" y2="316" stroke="#c87b2a" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- ── Canary / Production Detail ── -->
  <rect x="350" y="318" width="300" height="105" rx="6" fill="white" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="500" y="338" text-anchor="middle" font-size="11" font-weight="700" fill="#3d9e5a">Canary &#x2192; Production</text>

  <text x="370" y="358" font-size="9" fill="#555">&#x2022; Route 1% traffic to new model (canary)</text>
  <text x="370" y="374" font-size="9" fill="#555">&#x2022; Monitor error rate, p99 latency, loss</text>
  <text x="370" y="390" font-size="9" fill="#555">&#x2022; Auto-rollback if metrics degrade</text>
  <text x="370" y="406" font-size="9" fill="#555">&#x2022; Gradual ramp: 1% &#x2192; 5% &#x2192; 25% &#x2192; 100%</text>

  <!-- ── Connection line from Canary stage ── -->
  <line x1="576" y1="95" x2="500" y2="316" stroke="#3d9e5a" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- ── Footnote ── -->
  <text x="340" y="450" text-anchor="middle" font-size="9" fill="#999" font-style="italic">
    ML systems CI/CD pipeline with dedicated fault injection and progressive rollout stages
  </text>
</svg>
