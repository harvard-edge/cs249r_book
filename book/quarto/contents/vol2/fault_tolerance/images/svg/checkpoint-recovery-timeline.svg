<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrowB" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arrowR" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#c44"/>
    </marker>
    <marker id="arrowO" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#c87b2a"/>
    </marker>
    <marker id="arrowG" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#3d9e5a"/>
    </marker>
    <marker id="arrowGray" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#888"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- ─── TIMELINE AXIS ─── -->
  <!-- axis line at y=200 -->
  <line x1="50" y1="200" x2="645" y2="200" stroke="#ccc" stroke-width="1.5"/>
  <!-- Time arrow -->
  <line x1="640" y1="200" x2="655" y2="200" stroke="#888" stroke-width="1.5" marker-end="url(#arrowGray)"/>
  <text x="658" y="204" font-size="10" fill="#888">t</text>

  <!-- ─── SEGMENT 1: Compute (productive work) x=50..210 ─── -->
  <rect x="52" y="160" width="158" height="40" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
  <text x="131" y="182" text-anchor="middle" font-size="11" font-weight="600" fill="#1a4a7a">Compute</text>
  <text x="131" y="195" text-anchor="middle" font-size="8.5" fill="#4a90c4">productive training steps</text>

  <!-- ─── SEGMENT 2: Checkpoint Save x=210..275 ─── -->
  <rect x="210" y="160" width="65" height="40" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <text x="242" y="181" text-anchor="middle" font-size="9" font-weight="600" fill="#8a4000">Save</text>
  <text x="242" y="192" text-anchor="middle" font-size="7.5" fill="#c87b2a">Checkpoint</text>

  <!-- ─── SEGMENT 3: More Compute x=275..400 ─── -->
  <rect x="275" y="160" width="125" height="40" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
  <text x="337" y="182" text-anchor="middle" font-size="11" font-weight="600" fill="#1a4a7a">Compute</text>
  <text x="337" y="195" text-anchor="middle" font-size="8.5" fill="#4a90c4">productive training steps</text>

  <!-- ─── FAILURE LIGHTNING BOLT at x=400 ─── -->
  <!-- Lightning polygon -->
  <polygon points="400,145 393,178 402,178 395,215 413,175 403,175 412,145" fill="#c44" stroke="#900" stroke-width="1"/>
  <text x="420" y="157" font-size="9.5" font-weight="700" fill="#900">FAILURE</text>

  <!-- ─── SEGMENT 4: Recovery/Restart x=400..520 red hatched ─── -->
  <!-- Red wasted / rework region (behind) -->
  <rect x="275" y="160" width="125" height="40" rx="0" fill="#f9d6d5" fill-opacity="0.55" stroke="none"/>
  <!-- Hatch lines for rework -->
  <clipPath id="reworkClip">
    <rect x="275" y="160" width="125" height="40"/>
  </clipPath>
  <g clip-path="url(#reworkClip)" stroke="#c44" stroke-width="0.8" opacity="0.4">
    <line x1="275" y1="160" x2="400" y2="200"/>
    <line x1="290" y1="160" x2="400" y2="190"/>
    <line x1="305" y1="160" x2="400" y2="180"/>
    <line x1="320" y1="160" x2="400" y2="170"/>
    <line x1="335" y1="160" x2="400" y2="162"/>
    <line x1="275" y1="175" x2="390" y2="200"/>
    <line x1="275" y1="190" x2="380" y2="200"/>
    <line x1="350" y1="160" x2="400" y2="173"/>
    <line x1="365" y1="160" x2="400" y2="181"/>
    <line x1="380" y1="160" x2="400" y2="189"/>
  </g>

  <!-- Recovery block -->
  <rect x="402" y="160" width="118" height="40" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
  <text x="461" y="179" text-anchor="middle" font-size="10" font-weight="600" fill="#900">Recovery</text>
  <text x="461" y="192" text-anchor="middle" font-size="8" fill="#c44">load checkpoint + restart</text>

  <!-- ─── SEGMENT 5: Resume x=520..640 ─── -->
  <rect x="520" y="160" width="120" height="40" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.5"/>
  <text x="580" y="180" text-anchor="middle" font-size="11" font-weight="600" fill="#1a5c35">Resume</text>
  <text x="580" y="194" text-anchor="middle" font-size="8.5" fill="#3d9e5a">training continues</text>

  <!-- ─────────────────────────────── -->
  <!-- ANNOTATIONS -->
  <!-- ─────────────────────────────── -->

  <!-- Brace: Checkpoint Interval τ (below timeline, from x=52 to x=210) -->
  <path d="M52,215 L52,224 L130,224 L130,230 L130,224 L208,224 L208,215" fill="none" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="131" y="242" text-anchor="middle" font-size="9.5" fill="#4a90c4" font-weight="700">Checkpoint Interval τ</text>
  <text x="131" y="254" text-anchor="middle" font-size="8.5" fill="#4a90c4">(Young-Daly: τ = √(2·T_write·MTBF))</text>

  <!-- Brace: Checkpoint overhead (below, from x=210 to x=275) -->
  <path d="M210,215 L210,224 L241,224 L241,230 L241,224 L273,224 L273,215" fill="none" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="241" y="242" text-anchor="middle" font-size="8.5" fill="#c87b2a" font-weight="700">T_write</text>
  <text x="241" y="254" text-anchor="middle" font-size="8" fill="#c87b2a">I/O overhead</text>

  <!-- Brace: Recovery Cost (below, from x=402 to x=520) -->
  <path d="M402,215 L402,270 L461,270 L461,276 L461,270 L519,270 L519,215" fill="none" stroke="#c44" stroke-width="1.2"/>
  <text x="461" y="289" text-anchor="middle" font-size="9.5" fill="#c44" font-weight="700">Recovery Cost</text>
  <text x="461" y="301" text-anchor="middle" font-size="8.5" fill="#c44">T_recover = T_read + T_restart</text>

  <!-- Brace / label: Wasted Compute (rework) from x=275 to x=400 -->
  <path d="M275,215 L275,256 L337,256 L337,262 L337,256 L399,256 L399,215" fill="none" stroke="#c44" stroke-width="1.2" stroke-dasharray="4,3"/>
  <text x="337" y="274" text-anchor="middle" font-size="9.5" fill="#c44" font-weight="700">Wasted Compute</text>
  <text x="337" y="286" text-anchor="middle" font-size="8.5" fill="#c44">(rework since last checkpoint)</text>

  <!-- ─── VERTICAL markers ─── -->
  <!-- Checkpoint save marker -->
  <line x1="210" y1="148" x2="210" y2="205" stroke="#c87b2a" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="210" y="145" text-anchor="middle" font-size="8" fill="#c87b2a" font-style="italic">ckpt saved</text>

  <!-- Second checkpoint marker (x=275) -->
  <line x1="275" y1="148" x2="275" y2="205" stroke="#c87b2a" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="275" y="145" text-anchor="middle" font-size="8" fill="#c87b2a" font-style="italic">ckpt saved</text>

  <!-- Failure marker -->
  <line x1="400" y1="140" x2="400" y2="205" stroke="#c44" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- Resume marker -->
  <line x1="520" y1="148" x2="520" y2="205" stroke="#3d9e5a" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="520" y="145" text-anchor="middle" font-size="8" fill="#3d9e5a" font-style="italic">training resumes</text>

  <!-- ─── TOP-LEVEL KEY ─── -->
  <rect x="52" y="318" width="576" height="76" rx="5" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
  <text x="340" y="337" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Fault Tolerance Cost Components</text>

  <!-- Legend items -->
  <rect x="68" y="348" width="18" height="12" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="94" y="359" font-size="9" fill="#333">Productive compute</text>

  <rect x="200" y="348" width="18" height="12" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="226" y="359" font-size="9" fill="#333">Checkpoint I/O overhead</text>

  <rect x="368" y="348" width="18" height="12" rx="2" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="394" y="359" font-size="9" fill="#333">Wasted / rework compute</text>

  <rect x="534" y="348" width="18" height="12" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="560" y="359" font-size="9" fill="#333">Resume</text>

  <text x="340" y="382" text-anchor="middle" font-size="8.5" fill="#555" font-style="italic">Total overhead = T_write/τ + τ/(2·MTBF) — minimized at τ_opt by the Young-Daly formula</text>

  <text x="340" y="445" text-anchor="middle" font-size="9" fill="#aaa" font-style="italic">Checkpoint must capture all distributed state: model weights, optimizer moments, RNG seeds, dataloader position</text>
</svg>
