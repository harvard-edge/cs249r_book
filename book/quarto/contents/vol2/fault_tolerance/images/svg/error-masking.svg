<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460"
     font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#333"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <!-- ── Background ── -->
  <rect width="680" height="460" fill="white"/>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── TMR (Triple Modular Redundancy) — Top Section ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <text x="245" y="26" text-anchor="middle" font-size="12" font-weight="700" fill="#333">Triple Modular Redundancy (TMR)</text>

  <!-- ── Input ── -->
  <rect x="20" y="105" width="80" height="40" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="60" y="128" text-anchor="middle" font-size="10" font-weight="700" fill="#4a90c4">Input X</text>

  <!-- ── Fanout arrows from input to 3 units ── -->
  <line x1="100" y1="115" x2="138" y2="65"  stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="100" y1="125" x2="138" y2="125" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="100" y1="135" x2="138" y2="185" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Compute Unit A (correct) ── -->
  <rect x="140" y="40" width="110" height="50" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="195" y="60" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">Unit A</text>
  <text x="195" y="76" text-anchor="middle" font-size="9" fill="#555">f(X) = 42</text>

  <!-- ── Compute Unit B (CORRUPTED) ── -->
  <rect x="140" y="100" width="110" height="50" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.8"/>
  <text x="195" y="120" text-anchor="middle" font-size="10" font-weight="700" fill="#c44">Unit B</text>
  <text x="195" y="136" text-anchor="middle" font-size="9" fill="#c44">f(X) = 99 (fault!)</text>

  <!-- ── Compute Unit C (correct) ── -->
  <rect x="140" y="160" width="110" height="50" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="195" y="180" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">Unit C</text>
  <text x="195" y="196" text-anchor="middle" font-size="9" fill="#555">f(X) = 42</text>

  <!-- ── Arrows to voter ── -->
  <line x1="250" y1="65"  x2="308" y2="115" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>
  <line x1="250" y1="125" x2="308" y2="125" stroke="#c44"  stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#arrow)"/>
  <line x1="250" y1="185" x2="308" y2="135" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ── Voter ── -->
  <rect x="310" y="100" width="90" height="50" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <text x="355" y="120" text-anchor="middle" font-size="10" font-weight="700" fill="#c87b2a">Voter</text>
  <text x="355" y="136" text-anchor="middle" font-size="9" font-weight="700" fill="#555">2/3 majority</text>

  <!-- ── Arrow from voter to output ── -->
  <line x1="400" y1="125" x2="430" y2="125" stroke="#3d9e5a" stroke-width="2" marker-end="url(#arrow-green)"/>

  <!-- ── Correct Output ── -->
  <rect x="432" y="105" width="90" height="40" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.5"/>
  <text x="477" y="122" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">Output</text>
  <text x="477" y="136" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">= 42</text>

  <!-- ── TMR annotation ── -->
  <rect x="310" y="40" width="212" height="40" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
  <text x="416" y="56" text-anchor="middle" font-size="9" font-weight="700" fill="#a31f34">Single-fault correction</text>
  <text x="416" y="70" text-anchor="middle" font-size="9" fill="#555">200% hardware overhead</text>

  <!-- ── Corrupted value annotation ── -->
  <rect x="268" y="160" width="130" height="32" rx="4" fill="white" stroke="#c44" stroke-width="1"/>
  <text x="333" y="176" text-anchor="middle" font-size="8" fill="#c44">Faulty value 99 is</text>
  <text x="333" y="186" text-anchor="middle" font-size="8" fill="#c44">outvoted by correct 42</text>

  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <!-- ── ECC MEMORY — Bottom Section (inset) ── -->
  <!-- ══════════════════════════════════════════════════════════════════════ -->
  <text x="340" y="240" text-anchor="middle" font-size="12" font-weight="700" fill="#333">ECC Memory Error Correction</text>

  <!-- ── Outer container ── -->
  <rect x="30" y="255" width="620" height="180" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>

  <!-- ── Data bits (original) ── -->
  <text x="85" y="280" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Data Bits</text>
  <g fill="#cfe2f3" stroke="#4a90c4" stroke-width="1">
    <rect x="42"  y="288" width="22" height="22" rx="2"/>
    <rect x="66"  y="288" width="22" height="22" rx="2"/>
    <rect x="90"  y="288" width="22" height="22" rx="2"/>
    <rect x="114" y="288" width="22" height="22" rx="2"/>
  </g>
  <g font-size="9" fill="#4a90c4" text-anchor="middle" font-weight="700">
    <text x="53"  y="303">1</text>
    <text x="77"  y="303">0</text>
    <text x="101" y="303">1</text>
    <text x="125" y="303">1</text>
  </g>

  <!-- ── Parity bits ── -->
  <text x="178" y="280" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Parity</text>
  <g fill="#fdebd0" stroke="#c87b2a" stroke-width="1">
    <rect x="150" y="288" width="22" height="22" rx="2"/>
    <rect x="174" y="288" width="22" height="22" rx="2"/>
    <rect x="198" y="288" width="22" height="22" rx="2"/>
  </g>
  <g font-size="9" fill="#c87b2a" text-anchor="middle" font-weight="700">
    <text x="161" y="303">P1</text>
    <text x="185" y="303">P2</text>
    <text x="209" y="303">P3</text>
  </g>

  <!-- ── Arrow: store ── -->
  <line x1="230" y1="299" x2="255" y2="299" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>
  <text x="243" y="290" text-anchor="middle" font-size="8" fill="#555">store</text>

  <!-- ── Memory (with corruption) ── -->
  <text x="305" y="280" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Stored (with bit error)</text>
  <g fill="#cfe2f3" stroke="#4a90c4" stroke-width="1">
    <rect x="260" y="288" width="22" height="22" rx="2"/>
    <rect x="308" y="288" width="22" height="22" rx="2"/>
    <rect x="332" y="288" width="22" height="22" rx="2"/>
  </g>
  <!-- Corrupted bit (red) -->
  <rect x="284" y="288" width="22" height="22" rx="2" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
  <g font-size="9" text-anchor="middle" font-weight="700">
    <text x="271" y="303" fill="#4a90c4">1</text>
    <text x="295" y="303" fill="#c44">1</text>
    <text x="319" y="303" fill="#4a90c4">1</text>
    <text x="343" y="303" fill="#4a90c4">1</text>
  </g>
  <!-- Parity bits (stored) -->
  <g fill="#fdebd0" stroke="#c87b2a" stroke-width="1">
    <rect x="356" y="288" width="22" height="22" rx="2"/>
    <rect x="380" y="288" width="22" height="22" rx="2"/>
    <rect x="404" y="288" width="22" height="22" rx="2"/>
  </g>
  <g font-size="9" fill="#c87b2a" text-anchor="middle" font-weight="700">
    <text x="367" y="303">P1</text>
    <text x="391" y="303">P2</text>
    <text x="415" y="303">P3</text>
  </g>

  <!-- ── Error annotation ── -->
  <line x1="295" y1="314" x2="295" y2="330" stroke="#c44" stroke-width="1.2"/>
  <text x="295" y="342" text-anchor="middle" font-size="8" font-weight="700" fill="#c44">Bit flip!</text>
  <text x="295" y="352" text-anchor="middle" font-size="8" fill="#c44">0 &#x2192; 1</text>

  <!-- ── Arrow: read + check ── -->
  <line x1="430" y1="299" x2="455" y2="299" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>
  <text x="443" y="290" text-anchor="middle" font-size="8" fill="#555">read</text>

  <!-- ── Syndrome Calculator ── -->
  <rect x="458" y="280" width="85" height="40" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="500" y="296" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">Syndrome</text>
  <text x="500" y="310" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">Calculator</text>

  <!-- ── Arrow to corrected output ── -->
  <line x1="543" y1="299" x2="568" y2="299" stroke="#3d9e5a" stroke-width="1.5" marker-end="url(#arrow-green)"/>

  <!-- ── Corrected output ── -->
  <text x="590" y="280" text-anchor="middle" font-size="9.5" font-weight="700" fill="#3d9e5a">Corrected</text>
  <g fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2">
    <rect x="552" y="288" width="22" height="22" rx="2"/>
    <rect x="576" y="288" width="22" height="22" rx="2"/>
    <rect x="600" y="288" width="22" height="22" rx="2"/>
    <rect x="624" y="288" width="22" height="22" rx="2"/>
  </g>
  <g font-size="9" fill="#3d9e5a" text-anchor="middle" font-weight="700">
    <text x="563" y="303">1</text>
    <text x="587" y="303">0</text>
    <text x="611" y="303">1</text>
    <text x="635" y="303">1</text>
  </g>

  <!-- ── Syndrome result annotation ── -->
  <rect x="455" y="330" width="90" height="28" rx="4" fill="white" stroke="#3d9e5a" stroke-width="1"/>
  <text x="500" y="344" text-anchor="middle" font-size="8" font-weight="700" fill="#3d9e5a">Syndrome = 010</text>
  <text x="500" y="354" text-anchor="middle" font-size="8" fill="#555">Locates bit 2 error</text>

  <!-- ── ECC annotation ── -->
  <rect x="130" y="370" width="420" height="30" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
  <text x="340" y="386" text-anchor="middle" font-size="9" fill="#555">
    SECDED (Single Error Correct, Double Error Detect): corrects 1-bit errors, detects 2-bit errors
  </text>
  <text x="340" y="398" text-anchor="middle" font-size="9" fill="#555">
    Standard in all datacenter GPU HBM memory (e.g., A100, H100)
  </text>

  <!-- ── Legend (moved below box bottom at y=435, with 10px clearance) ── -->
  <g transform="translate(50, 445)">
    <rect x="0" y="0" width="14" height="10" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
    <text x="20" y="9" font-size="9" fill="#555">Correct</text>

    <rect x="85" y="0" width="14" height="10" rx="2" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
    <text x="105" y="9" font-size="9" fill="#555">Corrupted</text>

    <rect x="175" y="0" width="14" height="10" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
    <text x="195" y="9" font-size="9" fill="#555">Parity / Voter</text>

    <rect x="275" y="0" width="14" height="10" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
    <text x="295" y="9" font-size="9" fill="#555">Data input</text>
  </g>

  <!-- ── Footnote ── -->
  <text x="340" y="458" text-anchor="middle" font-size="9" fill="#999" font-style="italic">
    Error masking: TMR voting (top) and ECC memory correction (bottom)
  </text>
</svg>
