<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrowDark" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- STATE: CLOSED (green, top-left) -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="55" y="130" width="160" height="96" rx="10" fill="#d4edda" stroke="#3d9e5a" stroke-width="2.5"/>
  <text x="135" y="168" text-anchor="middle" font-size="16" font-weight="700" fill="#1a5c35">CLOSED</text>
  <text x="135" y="185" text-anchor="middle" font-size="9.5" fill="#1a5c35">Normal operation</text>
  <text x="135" y="200" text-anchor="middle" font-size="9" fill="#3d9e5a">Requests pass through</text>
  <text x="135" y="213" text-anchor="middle" font-size="9" fill="#3d9e5a">Failure counter active</text>

  <!-- State indicator dot (green) -->
  <circle cx="84" cy="150" r="8" fill="#3d9e5a"/>
  <text x="84" y="153.5" text-anchor="middle" font-size="9" fill="white" font-weight="700">✓</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- STATE: OPEN (red, top-right) -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="465" y="130" width="160" height="96" rx="10" fill="#f9d6d5" stroke="#c44" stroke-width="2.5"/>
  <text x="545" y="168" text-anchor="middle" font-size="16" font-weight="700" fill="#900">OPEN</text>
  <text x="545" y="185" text-anchor="middle" font-size="9.5" fill="#900">Fail-fast mode</text>
  <text x="545" y="200" text-anchor="middle" font-size="9" fill="#c44">Requests rejected immediately</text>
  <text x="545" y="213" text-anchor="middle" font-size="9" fill="#c44">No calls to downstream</text>

  <!-- State indicator dot (red) -->
  <circle cx="494" cy="150" r="8" fill="#c44"/>
  <text x="494" y="154" text-anchor="middle" font-size="11" fill="white" font-weight="700">✕</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- STATE: HALF-OPEN (orange, bottom-center) -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="260" y="305" width="160" height="96" rx="10" fill="#fdebd0" stroke="#c87b2a" stroke-width="2.5"/>
  <text x="340" y="337" text-anchor="middle" font-size="13" font-weight="700" fill="#8a4000">HALF-OPEN</text>
  <text x="340" y="353" text-anchor="middle" font-size="9.5" fill="#8a4000">Recovery probe mode</text>
  <text x="340" y="369" text-anchor="middle" font-size="9" fill="#c87b2a">One probe request allowed</text>
  <text x="340" y="382" text-anchor="middle" font-size="9" fill="#c87b2a">Success rate monitored</text>

  <!-- State indicator dot (orange) -->
  <circle cx="287" cy="322" r="8" fill="#c87b2a"/>
  <text x="287" y="326" text-anchor="middle" font-size="10" fill="white" font-weight="700">?</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- TRANSITIONS -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- CLOSED → OPEN (top, failure threshold exceeded) -->
  <path d="M215,165 C320,110 420,110 465,155" fill="none" stroke="#c44" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowDark)"/>
  <rect x="272" y="88" width="136" height="34" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="340" y="104" text-anchor="middle" font-size="9.5" fill="#900" font-weight="700">failure threshold exceeded</text>
  <text x="340" y="116" text-anchor="middle" font-size="8.5" fill="#c44">e.g., 5 failures in 30 seconds</text>

  <!-- OPEN → HALF-OPEN (right side, timeout expires) -->
  <path d="M545,226 C545,270 470,290 420,310" fill="none" stroke="#c87b2a" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowDark)"/>
  <rect x="450" y="252" width="118" height="28" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="509" y="266" text-anchor="middle" font-size="9" fill="#8a4000" font-weight="700">timeout expires</text>
  <text x="509" y="276" text-anchor="middle" font-size="8" fill="#c87b2a">e.g., after 60 seconds</text>

  <!-- HALF-OPEN → CLOSED (left side, probe succeeds) -->
  <path d="M260,340 C200,310 145,280 135,226" fill="none" stroke="#3d9e5a" stroke-width="2" marker-end="url(#arrowDark)"/>
  <rect x="112" y="268" width="108" height="28" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="166" y="282" text-anchor="middle" font-size="9" fill="#1a5c35" font-weight="700">probe succeeds</text>
  <text x="166" y="292" text-anchor="middle" font-size="8" fill="#3d9e5a">circuit resets, normal traffic</text>

  <!-- HALF-OPEN → OPEN (bottom, probe fails) -->
  <path d="M420,340 C470,310 530,280 540,226" fill="none" stroke="#c44" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#arrowDark)"/>
  <rect x="468" y="262" width="96" height="22" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="516" y="277" text-anchor="middle" font-size="9" fill="#900" font-weight="700">probe fails</text>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- LEGEND / CONTEXT BOX -->
  <!-- ═══════════════════════════════════════════════ -->
  <rect x="55" y="415" width="570" height="30" rx="4" fill="#f0f0f0" stroke="#ccc" stroke-width="0.8"/>
  <text x="340" y="427" text-anchor="middle" font-size="9" fill="#666">ML system context: wraps calls to downstream model servers, feature stores, or dependent microservices</text>
  <text x="340" y="439" text-anchor="middle" font-size="9" fill="#666">Prevents cascading failures from propagating through the serving stack</text>

  <!-- ML Context labels: what each state means for an ML pipeline -->
  <text x="135" y="246" text-anchor="middle" font-size="8" fill="#3d9e5a" font-style="italic">ML: full inference path active</text>
  <text x="545" y="246" text-anchor="middle" font-size="8" fill="#c44" font-style="italic">ML: serve fallback / cached response</text>
  <text x="340" y="418" text-anchor="middle" font-size="8" fill="#8a4000" font-style="italic"></text>
</svg>
