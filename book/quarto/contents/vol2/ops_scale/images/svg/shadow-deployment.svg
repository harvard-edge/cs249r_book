<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="prod-arr" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5" fill="#4a90c4"/>
    </marker>
    <marker id="shadow-arr" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5" fill="#bbb"/>
    </marker>
    <marker id="canary-arr" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5" fill="#3d9e5a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fafafa" rx="3"/>

  <!-- Section A: Shadow Deployment -->
  <text x="340" y="28" text-anchor="middle" font-size="11" font-weight="700" fill="#333">(a) Shadow Deployment: Zero-Risk Validation</text>

  <!-- Production Traffic -->
  <rect x="30" y="70" width="100" height="44" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="80" y="88" text-anchor="middle" font-size="9" font-weight="700" fill="#333">Production</text>
  <text x="80" y="102" text-anchor="middle" font-size="8" fill="#555">Traffic</text>

  <!-- Load Balancer -->
  <rect x="170" y="60" width="70" height="64" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="205" y="82" text-anchor="middle" font-size="8" font-weight="700" fill="#333">Load</text>
  <text x="205" y="94" text-anchor="middle" font-size="8" font-weight="700" fill="#333">Balancer</text>
  <text x="205" y="114" text-anchor="middle" font-size="7" fill="#888">duplicates</text>

  <!-- Arrow: Traffic -> LB -->
  <line x1="130" y1="92" x2="168" y2="92" stroke="#555" stroke-width="1.4" marker-end="url(#prod-arr)"/>
  <text x="149" y="86" text-anchor="middle" font-size="7" fill="#555">100%</text>

  <!-- Production Model -->
  <rect x="290" y="50" width="130" height="44" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="355" y="68" text-anchor="middle" font-size="10" font-weight="700" fill="#1a3a5c">Production Model</text>
  <text x="355" y="82" text-anchor="middle" font-size="8" fill="#555">v1.3 (stable)</text>

  <!-- Arrow: LB -> Production -->
  <line x1="240" y1="78" x2="288" y2="72" stroke="#4a90c4" stroke-width="1.4" marker-end="url(#prod-arr)"/>
  <text x="264" y="68" text-anchor="middle" font-size="7" fill="#4a90c4" font-weight="600">100%</text>

  <!-- Shadow Model -->
  <rect x="290" y="110" width="130" height="44" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.0" stroke-dasharray="4,3"/>
  <text x="355" y="128" text-anchor="middle" font-size="10" font-weight="700" fill="#bbb">Shadow Model</text>
  <text x="355" y="142" text-anchor="middle" font-size="8" fill="#bbb">v2.0 (candidate)</text>

  <!-- Arrow: LB -> Shadow (dashed) -->
  <line x1="240" y1="106" x2="288" y2="120" stroke="#bbb" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#shadow-arr)"/>
  <text x="264" y="118" text-anchor="middle" font-size="7" fill="#bbb">copy</text>

  <!-- User Response (from production only) -->
  <rect x="470" y="50" width="80" height="44" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.0"/>
  <text x="510" y="68" text-anchor="middle" font-size="8" font-weight="700" fill="#1a4a2a">User</text>
  <text x="510" y="82" text-anchor="middle" font-size="8" fill="#555">Response</text>

  <!-- Arrow: Production -> User -->
  <line x1="420" y1="72" x2="468" y2="72" stroke="#4a90c4" stroke-width="1.4" marker-end="url(#prod-arr)"/>

  <!-- Shadow response discarded -->
  <rect x="470" y="116" width="80" height="32" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="0.8"/>
  <text x="510" y="136" text-anchor="middle" font-size="8" fill="#8b1a1a" font-weight="600">Discarded</text>

  <!-- Arrow: Shadow -> Discarded -->
  <line x1="420" y1="132" x2="468" y2="132" stroke="#bbb" stroke-width="1.0" stroke-dasharray="4,3" marker-end="url(#shadow-arr)"/>

  <!-- Quality Comparison -->
  <rect x="570" y="80" width="86" height="56" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.0"/>
  <text x="613" y="100" text-anchor="middle" font-size="8" font-weight="700" fill="#5a3a10">Quality</text>
  <text x="613" y="114" text-anchor="middle" font-size="8" fill="#5a3a10" font-weight="600">Comparison</text>
  <text x="613" y="128" text-anchor="middle" font-size="7" fill="#555">v1.3 vs v2.0</text>

  <!-- Lines to comparison -->
  <line x1="550" y1="72" x2="570" y2="96" stroke="#c87b2a" stroke-width="0.8"/>
  <line x1="550" y1="132" x2="570" y2="120" stroke="#c87b2a" stroke-width="0.8"/>

  <!-- Divider -->
  <line x1="30" y1="180" x2="650" y2="180" stroke="#ddd" stroke-width="1.0"/>

  <!-- Section B: Canary Deployment -->
  <text x="340" y="208" text-anchor="middle" font-size="11" font-weight="700" fill="#333">(b) Canary Deployment: Gradual Traffic Shift</text>

  <!-- Production Traffic -->
  <rect x="30" y="240" width="100" height="44" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="80" y="258" text-anchor="middle" font-size="9" font-weight="700" fill="#333">Production</text>
  <text x="80" y="272" text-anchor="middle" font-size="8" fill="#555">Traffic</text>

  <!-- Load Balancer -->
  <rect x="170" y="230" width="70" height="64" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="205" y="252" text-anchor="middle" font-size="8" font-weight="700" fill="#333">Traffic</text>
  <text x="205" y="264" text-anchor="middle" font-size="8" font-weight="700" fill="#333">Splitter</text>
  <text x="205" y="284" text-anchor="middle" font-size="7" fill="#888">weighted</text>

  <!-- Arrow: Traffic -> Splitter -->
  <line x1="130" y1="262" x2="168" y2="262" stroke="#555" stroke-width="1.4" marker-end="url(#prod-arr)"/>

  <!-- Current Model -->
  <rect x="290" y="224" width="130" height="40" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="355" y="242" text-anchor="middle" font-size="9" font-weight="700" fill="#1a3a5c">Current Model</text>
  <text x="355" y="256" text-anchor="middle" font-size="8" fill="#555">v1.3 (stable)</text>

  <!-- Canary Model -->
  <rect x="290" y="278" width="130" height="40" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="355" y="296" text-anchor="middle" font-size="9" font-weight="700" fill="#1a4a2a">Canary Model</text>
  <text x="355" y="310" text-anchor="middle" font-size="8" fill="#555">v2.0 (candidate)</text>

  <!-- Arrow: Splitter -> Current -->
  <line x1="240" y1="250" x2="288" y2="244" stroke="#4a90c4" stroke-width="1.4" marker-end="url(#prod-arr)"/>
  <text x="264" y="240" text-anchor="middle" font-size="7" fill="#4a90c4" font-weight="600">95%</text>

  <!-- Arrow: Splitter -> Canary -->
  <line x1="240" y1="274" x2="288" y2="290" stroke="#3d9e5a" stroke-width="1.4" marker-end="url(#canary-arr)"/>
  <text x="264" y="290" text-anchor="middle" font-size="7" fill="#3d9e5a" font-weight="600">5%</text>

  <!-- Canary progression timeline -->
  <g transform="translate(470, 232)">
    <text x="0" y="0" font-size="8.5" fill="#555" font-weight="600">Canary Progression:</text>

    <!-- Timeline -->
    <line x1="0" y1="14" x2="180" y2="14" stroke="#ddd" stroke-width="1.0"/>

    <!-- Stage dots -->
    <circle cx="0" cy="14" r="4" fill="#3d9e5a"/>
    <text x="0" y="30" text-anchor="middle" font-size="7" fill="#555">5%</text>

    <circle cx="45" cy="14" r="4" fill="#3d9e5a"/>
    <text x="45" y="30" text-anchor="middle" font-size="7" fill="#555">10%</text>

    <circle cx="90" cy="14" r="4" fill="#3d9e5a"/>
    <text x="90" y="30" text-anchor="middle" font-size="7" fill="#555">25%</text>

    <circle cx="135" cy="14" r="4" fill="#3d9e5a"/>
    <text x="135" y="30" text-anchor="middle" font-size="7" fill="#555">50%</text>

    <circle cx="180" cy="14" r="4" fill="#3d9e5a" stroke="#1a4a2a" stroke-width="1.2"/>
    <text x="180" y="30" text-anchor="middle" font-size="7" fill="#1a4a2a" font-weight="600">100%</text>

    <!-- Rollback indicator -->
    <line x1="90" y1="36" x2="90" y2="56" stroke="#c44" stroke-width="0.8"/>
    <text x="90" y="66" text-anchor="middle" font-size="7" fill="#c44" font-style="italic">auto-rollback</text>
    <text x="90" y="76" text-anchor="middle" font-size="7" fill="#c44" font-style="italic">if metrics degrade</text>

    <!-- Time labels -->
    <text x="0" y="-8" text-anchor="middle" font-size="6.5" fill="#888">t=0</text>
    <text x="45" y="-8" text-anchor="middle" font-size="6.5" fill="#888">+1h</text>
    <text x="90" y="-8" text-anchor="middle" font-size="6.5" fill="#888">+6h</text>
    <text x="135" y="-8" text-anchor="middle" font-size="6.5" fill="#888">+24h</text>
    <text x="180" y="-8" text-anchor="middle" font-size="6.5" fill="#888">+48h</text>
  </g>

  <!-- Comparison box -->
  <rect x="30" y="340" width="290" height="46" rx="3" fill="white" stroke="#bbb" stroke-width="0.8"/>
  <text x="175" y="357" text-anchor="middle" font-size="9" fill="#333" font-weight="600">Shadow vs Canary</text>
  <text x="42" y="374" font-size="8" fill="#555">Shadow: zero risk, no real user feedback</text>
  <text x="42" y="384" font-size="8" fill="#555">Canary: real traffic, bounded blast radius</text>

  <!-- Bottom callout -->
  <rect x="100" y="410" width="480" height="36" rx="3" fill="white" stroke="#a31f34" stroke-width="1.0"/>
  <text x="340" y="426" text-anchor="middle" font-size="9" fill="#a31f34" font-weight="600">Safe deployment requires both: shadow validates correctness, canary validates performance</text>
  <text x="340" y="438" text-anchor="middle" font-size="8.5" fill="#555">Auto-rollback triggers if error rate, latency, or business metrics exceed thresholds</text>
</svg>
