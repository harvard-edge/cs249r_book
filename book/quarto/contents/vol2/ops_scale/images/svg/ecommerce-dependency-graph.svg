<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <rect width="680" height="460" fill="#fafafa" rx="3"/>
  <rect x="10" y="10" width="660" height="440" fill="#fafafa" stroke="#e0e0e0" stroke-width="1" rx="4"/>

  <!-- Layer labels on left side -->
  <text x="28" y="72" font-size="10" fill="#999" font-weight="bold">LAYER 0</text>
  <text x="28" y="84" font-size="10" fill="#999">Data Sources</text>

  <text x="28" y="162" font-size="10" fill="#999" font-weight="bold">LAYER 1</text>
  <text x="28" y="174" font-size="10" fill="#999">Embeddings</text>

  <text x="28" y="252" font-size="10" fill="#999" font-weight="bold">LAYER 2</text>
  <text x="28" y="264" font-size="10" fill="#999">Retrieval</text>

  <text x="28" y="342" font-size="10" fill="#999" font-weight="bold">LAYER 3</text>
  <text x="28" y="354" font-size="10" fill="#999">Ranking</text>

  <text x="28" y="420" font-size="10" fill="#999" font-weight="bold">LAYER 4</text>
  <text x="28" y="432" font-size="10" fill="#999">Rules</text>

  <!-- ── LAYER 0: Data sources (gray) ── -->
  <rect x="130" y="50" width="175" height="46" rx="5" fill="#e0e0e0" stroke="#999" stroke-width="1.5"/>
  <text x="218" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#444">User Behavior Logs</text>
  <text x="218" y="87" text-anchor="middle" font-size="10" fill="#777">clicks, sessions, dwell time</text>

  <rect x="375" y="50" width="175" height="46" rx="5" fill="#e0e0e0" stroke="#999" stroke-width="1.5"/>
  <text x="462" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#444">Product Catalog</text>
  <text x="462" y="87" text-anchor="middle" font-size="10" fill="#777">titles, categories, attributes</text>

  <!-- ── LAYER 1: Embeddings (blue) ── -->
  <!-- User Embedding — CRITICAL NODE (bold border, double stroke) -->
  <rect x="120" y="140" width="195" height="46" rx="5" fill="#cfe2f3" stroke="#1a4f7a" stroke-width="3.5"/>
  <rect x="122" y="142" width="191" height="42" rx="4" fill="none" stroke="#4a90c4" stroke-width="1"/>
  <text x="218" y="160" text-anchor="middle" font-size="12" font-weight="bold" fill="#1a4f7a">User Embedding</text>
  <text x="218" y="177" text-anchor="middle" font-size="10" fill="#4a90c4">★ Critical Node — feeds 2 paths</text>

  <rect x="365" y="140" width="195" height="46" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.8"/>
  <text x="462" y="160" text-anchor="middle" font-size="12" font-weight="bold" fill="#1a4f7a">Product Embedding</text>
  <text x="462" y="177" text-anchor="middle" font-size="10" fill="#4a90c4">item vectors, semantic similarity</text>

  <!-- ── LAYER 2: Retrieval & Sensitivity (green) ── -->
  <rect x="120" y="230" width="195" height="46" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.8"/>
  <text x="218" y="250" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e5e35">Candidate Retrieval</text>
  <text x="218" y="267" text-anchor="middle" font-size="10" fill="#3d9e5a">ANN search, top-k items</text>

  <rect x="365" y="230" width="195" height="46" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.8"/>
  <text x="462" y="250" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e5e35">Price Sensitivity Model</text>
  <text x="462" y="267" text-anchor="middle" font-size="10" fill="#3d9e5a">willingness-to-pay estimates</text>

  <!-- ── LAYER 3: Ranking (orange) ── -->
  <rect x="242" y="320" width="195" height="46" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.8"/>
  <text x="340" y="340" text-anchor="middle" font-size="12" font-weight="bold" fill="#7a3f00">Ranking Model</text>
  <text x="340" y="357" text-anchor="middle" font-size="10" fill="#c87b2a">joint optimization, pCTR × pBuy</text>

  <!-- ── LAYER 4: Business Rules (red) ── -->
  <rect x="242" y="400" width="195" height="44" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.8"/>
  <text x="340" y="420" text-anchor="middle" font-size="12" font-weight="bold" fill="#a31f34">Business Rules Engine</text>
  <text x="340" y="437" text-anchor="middle" font-size="10" fill="#c44">inventory, promotions, compliance</text>

  <!-- ── ARROWS ── -->
  <!-- L0 → L1 -->
  <line x1="218" y1="96" x2="218" y2="138" stroke="#999" stroke-width="1.5"/>
  <polygon points="218,140 213,128 223,128" fill="#999"/>

  <line x1="462" y1="96" x2="462" y2="138" stroke="#999" stroke-width="1.5"/>
  <polygon points="462,140 457,128 467,128" fill="#999"/>

  <!-- L1 User Embedding → L2 Candidate Retrieval -->
  <line x1="218" y1="186" x2="218" y2="228" stroke="#4a90c4" stroke-width="1.8"/>
  <polygon points="218,230 213,218 223,218" fill="#4a90c4"/>

  <!-- L1 User Embedding → L2 Price Sensitivity (cross) -->
  <line x1="300" y1="163" x2="375" y2="253" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="377,255 369,244 378,242" fill="#4a90c4"/>

  <!-- L1 Product Embedding → L2 Candidate Retrieval (cross) -->
  <line x1="380" y1="163" x2="300" y2="253" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="298,255 302,242 312,244" fill="#4a90c4"/>

  <!-- L1 Product Embedding → L2 Price Sensitivity -->
  <line x1="462" y1="186" x2="462" y2="228" stroke="#4a90c4" stroke-width="1.8"/>
  <polygon points="462,230 457,218 467,218" fill="#4a90c4"/>

  <!-- L2 → L3 -->
  <line x1="250" y1="276" x2="310" y2="318" stroke="#3d9e5a" stroke-width="1.8"/>
  <polygon points="312,320 303,308 314,306" fill="#3d9e5a"/>

  <line x1="430" y1="276" x2="370" y2="318" stroke="#3d9e5a" stroke-width="1.8"/>
  <polygon points="368,320 366,306 377,308" fill="#3d9e5a"/>

  <!-- L3 → L4 -->
  <line x1="340" y1="366" x2="340" y2="398" stroke="#c87b2a" stroke-width="1.8"/>
  <polygon points="340,400 335,388 345,388" fill="#c87b2a"/>
</svg>
