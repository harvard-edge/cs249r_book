<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <path d="M0,0 L6,2 L0,4 Z" fill="#555"/>
    </marker>
    <marker id="arrow-red" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <path d="M0,0 L6,2 L0,4 Z" fill="#c44"/>
    </marker>
    <marker id="arrow-green" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <path d="M0,0 L6,2 L0,4 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="white"/>

  <!-- ===== LEFT: Topology-Unaware Placement ===== -->
  <text x="170" y="22" text-anchor="middle" font-size="12" font-weight="700" fill="#c44">(a) Topology-Unaware</text>
  <text x="170" y="38" text-anchor="middle" font-size="9" fill="#555">Job spread across racks</text>

  <!-- Top-of-Rack (spine) switch -->
  <rect x="110" y="50" width="120" height="26" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="170" y="67" text-anchor="middle" font-size="9.5" font-weight="700" fill="#c44">Spine Switch</text>

  <!-- Rack A (left) -->
  <rect x="20" y="108" width="130" height="166" rx="5" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="85" y="102" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Rack A</text>

  <!-- Leaf switch A -->
  <rect x="40" y="118" width="90" height="22" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="85" y="133" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Leaf-A</text>

  <!-- GPUs in Rack A: 4 slots, 2 job (green), 2 other -->
  <rect x="32" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="56" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G0</text>
  <text x="56" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="90" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="114" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G1</text>
  <text x="114" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="32" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="56" y="224" text-anchor="middle" font-size="9" fill="#999">busy</text>

  <rect x="90" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="114" y="224" text-anchor="middle" font-size="9" fill="#999">busy</text>

  <!-- Link Rack A leaf to spine -->
  <line x1="85" y1="118" x2="140" y2="76" stroke="#c44" stroke-width="1.5"/>

  <!-- Rack B (right) -->
  <rect x="190" y="108" width="130" height="166" rx="5" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="255" y="102" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Rack B</text>

  <!-- Leaf switch B -->
  <rect x="210" y="118" width="90" height="22" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="255" y="133" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Leaf-B</text>

  <!-- GPUs in Rack B: 2 job, 2 other -->
  <rect x="202" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="226" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G2</text>
  <text x="226" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="260" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="284" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G3</text>
  <text x="284" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="202" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="226" y="224" text-anchor="middle" font-size="9" fill="#999">busy</text>

  <rect x="260" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="284" y="224" text-anchor="middle" font-size="9" fill="#999">busy</text>

  <!-- Link Rack B leaf to spine -->
  <line x1="255" y1="118" x2="200" y2="76" stroke="#c44" stroke-width="1.5"/>

  <!-- Cross-rack communication arrows (red, expensive) -->
  <!-- Control points offset horizontally near endpoints so arrowhead arrives at a diagonal angle -->
  <path d="M 56,152 C 80,80 202,80 226,152" fill="none" stroke="#c44" stroke-width="1.8" stroke-dasharray="6,3" marker-end="url(#arrow-red)"/>
  <path d="M 114,152 C 134,90 264,90 284,152" fill="none" stroke="#c44" stroke-width="1.8" stroke-dasharray="6,3" marker-end="url(#arrow-red)"/>

  <!-- Cross-rack label (moved above arcs to avoid overlapping the curves) -->
  <text x="170" y="68" text-anchor="middle" font-size="8" fill="#c44" font-weight="700">3 hops, slow</text>

  <!-- Metrics unaware -->
  <rect x="30" y="284" width="280" height="34" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="0.8"/>
  <text x="170" y="298" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Effective BW: ~12 GB/s (spine-limited)</text>
  <text x="170" y="312" text-anchor="middle" font-size="9" fill="#c44">3 switch hops per AllReduce message</text>

  <!-- ===== DIVIDER ===== -->
  <line x1="340" y1="14" x2="340" y2="330" stroke="#e0e0e0" stroke-width="1"/>

  <!-- ===== RIGHT: Topology-Aware Placement ===== -->
  <text x="510" y="22" text-anchor="middle" font-size="12" font-weight="700" fill="#3d9e5a">(b) Topology-Aware</text>
  <text x="510" y="38" text-anchor="middle" font-size="9" fill="#555">Job packed within one rack</text>

  <!-- Spine switch (not used by job traffic) -->
  <rect x="450" y="50" width="120" height="26" rx="5" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
  <text x="510" y="67" text-anchor="middle" font-size="9.5" fill="#bbb">Spine (unused by job)</text>

  <!-- Rack A with all job GPUs -->
  <rect x="360" y="108" width="130" height="166" rx="5" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="425" y="102" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Rack A</text>

  <!-- Leaf switch A -->
  <rect x="380" y="118" width="90" height="22" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="425" y="133" text-anchor="middle" font-size="9" font-weight="700" fill="#3d9e5a">Leaf-A</text>

  <!-- All 4 GPUs for the job -->
  <rect x="372" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="396" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G0</text>
  <text x="396" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="430" y="152" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="454" y="170" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G1</text>
  <text x="454" y="190" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="372" y="206" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="396" y="224" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G2</text>
  <text x="396" y="244" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <rect x="430" y="206" width="48" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="454" y="224" text-anchor="middle" font-size="9" font-weight="700" fill="#333">G3</text>
  <text x="454" y="244" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Job</text>

  <!-- Link Rack A leaf to spine (faded, not used) -->
  <line x1="425" y1="118" x2="480" y2="76" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Rack B (other jobs) -->
  <rect x="530" y="108" width="130" height="166" rx="5" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="595" y="102" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Rack B</text>

  <rect x="550" y="118" width="90" height="22" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="595" y="133" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Leaf-B</text>

  <rect x="542" y="152" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="566" y="170" text-anchor="middle" font-size="9" fill="#999">other</text>
  <rect x="600" y="152" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="624" y="170" text-anchor="middle" font-size="9" fill="#999">other</text>
  <rect x="542" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="566" y="224" text-anchor="middle" font-size="9" fill="#999">other</text>
  <rect x="600" y="206" width="48" height="28" rx="3" fill="#e8e8e8" stroke="#bbb" stroke-width="0.8"/>
  <text x="624" y="224" text-anchor="middle" font-size="9" fill="#999">other</text>

  <line x1="595" y1="118" x2="540" y2="76" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Intra-rack communication arrows (green, fast) -->
  <path d="M 396,152 L 425,140 L 454,152" fill="none" stroke="#3d9e5a" stroke-width="1.8" marker-end="url(#arrow-green)"/>
  <path d="M 396,206 L 425,218 L 454,206" fill="none" stroke="#3d9e5a" stroke-width="1.8" marker-end="url(#arrow-green)"/>
  <line x1="396" y1="180" x2="396" y2="206" stroke="#3d9e5a" stroke-width="1.5" marker-end="url(#arrow-green)"/>
  <line x1="454" y1="180" x2="454" y2="206" stroke="#3d9e5a" stroke-width="1.5" marker-end="url(#arrow-green)"/>

  <!-- Label -->
  <text x="425" y="260" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">1 hop, all local</text>

  <!-- Metrics aware -->
  <rect x="370" y="284" width="280" height="34" rx="4" fill="#f0fff0" stroke="#3d9e5a" stroke-width="0.8"/>
  <text x="510" y="298" text-anchor="middle" font-size="9" font-weight="700" fill="#3d9e5a">Effective BW: ~50 GB/s (leaf only)</text>
  <text x="510" y="312" text-anchor="middle" font-size="9" fill="#3d9e5a">1 switch hop per AllReduce message</text>

  <!-- ===== BOTTOM: Comparison summary ===== -->
  <rect x="30" y="338" width="620" height="90" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.0"/>
  <text x="340" y="358" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Quantitative Impact</text>

  <!-- Comparison table -->
  <text x="140" y="378" text-anchor="middle" font-size="9.5" font-weight="700" fill="#555">Metric</text>
  <text x="310" y="378" text-anchor="middle" font-size="9.5" font-weight="700" fill="#c44">Unaware</text>
  <text x="480" y="378" text-anchor="middle" font-size="9.5" font-weight="700" fill="#3d9e5a">Aware</text>

  <line x1="50" y1="383" x2="630" y2="383" stroke="#e0e0e0" stroke-width="0.6"/>

  <text x="140" y="398" text-anchor="middle" font-size="9" fill="#555">Switch hops</text>
  <text x="310" y="398" text-anchor="middle" font-size="9" fill="#c44" font-weight="700">3 (leaf-spine-leaf)</text>
  <text x="480" y="398" text-anchor="middle" font-size="9" fill="#3d9e5a" font-weight="700">1 (leaf only)</text>

  <text x="140" y="414" text-anchor="middle" font-size="9" fill="#555">Effective bandwidth</text>
  <text x="310" y="414" text-anchor="middle" font-size="9" fill="#c44" font-weight="700">~12 GB/s</text>
  <text x="480" y="414" text-anchor="middle" font-size="9" fill="#3d9e5a" font-weight="700">~50 GB/s (4x faster)</text>

  <!-- Footnote -->
  <text x="340" y="446" text-anchor="middle" font-size="9" fill="#999" font-style="italic">Topology-aware placement reduces AllReduce latency by 2-4x and eliminates spine contention.</text>

</svg>
