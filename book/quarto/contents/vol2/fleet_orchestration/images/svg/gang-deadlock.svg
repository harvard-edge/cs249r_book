<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#555"/>
    </marker>
    <marker id="arrow-red" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#c44"/>
    </marker>
    <marker id="arrow-green" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="white"/>

  <!-- ===== LEFT SIDE: DEADLOCK SCENARIO ===== -->
  <text x="200" y="22" text-anchor="middle" font-size="12" font-weight="700" fill="#a31f34">Deadlock: Non-Gang Scheduler</text>

  <!-- GPU Pool: 8 GPUs -->
  <text x="200" y="46" text-anchor="middle" font-size="9.5" fill="#555">8 GPUs available, 3 jobs each need 4 GPUs</text>

  <!-- GPU row -->
  <g>
    <!-- J1 holds 4 GPUs (blue) -->
    <rect x="30" y="60" width="38" height="30" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
    <text x="49" y="79" text-anchor="middle" font-size="9" font-weight="700">G0</text>
    <rect x="74" y="60" width="38" height="30" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
    <text x="93" y="79" text-anchor="middle" font-size="9" font-weight="700">G1</text>
    <rect x="118" y="60" width="38" height="30" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
    <text x="137" y="79" text-anchor="middle" font-size="9" font-weight="700">G2</text>
    <rect x="162" y="60" width="38" height="30" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
    <text x="181" y="79" text-anchor="middle" font-size="9" font-weight="700">G3</text>

    <!-- J2 holds 4 GPUs (pink) -->
    <rect x="206" y="60" width="38" height="30" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
    <text x="225" y="79" text-anchor="middle" font-size="9" font-weight="700">G4</text>
    <rect x="250" y="60" width="38" height="30" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
    <text x="269" y="79" text-anchor="middle" font-size="9" font-weight="700">G5</text>
    <rect x="294" y="60" width="38" height="30" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
    <text x="313" y="79" text-anchor="middle" font-size="9" font-weight="700">G6</text>
    <rect x="338" y="60" width="38" height="30" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
    <text x="357" y="79" text-anchor="middle" font-size="9" font-weight="700">G7</text>
  </g>

  <!-- Labels -->
  <text x="115" y="104" text-anchor="middle" font-size="9" fill="#4a90c4" font-weight="700">J1 holds G0-G3</text>
  <text x="291" y="104" text-anchor="middle" font-size="9" fill="#c44" font-weight="700">J2 holds G4-G7</text>

  <!-- Job boxes showing what each job wants -->
  <rect x="35" y="120" width="140" height="50" rx="5" fill="none" stroke="#4a90c4" stroke-width="1.2" stroke-dasharray="5,3"/>
  <text x="105" y="138" text-anchor="middle" font-size="10" font-weight="700" fill="#4a90c4">Job J1</text>
  <text x="105" y="152" text-anchor="middle" font-size="9" fill="#555">Has 4, needs 4 more</text>
  <text x="105" y="164" text-anchor="middle" font-size="9" fill="#c44">Progress: 0%</text>

  <rect x="225" y="120" width="140" height="50" rx="5" fill="none" stroke="#c44" stroke-width="1.2" stroke-dasharray="5,3"/>
  <text x="295" y="138" text-anchor="middle" font-size="10" font-weight="700" fill="#c44">Job J2</text>
  <text x="295" y="152" text-anchor="middle" font-size="9" fill="#555">Has 4, needs 4 more</text>
  <text x="295" y="164" text-anchor="middle" font-size="9" fill="#c44">Progress: 0%</text>

  <!-- J3 waiting -->
  <rect x="125" y="185" width="150" height="32" rx="5" fill="none" stroke="#c87b2a" stroke-width="1.2" stroke-dasharray="5,3"/>
  <text x="200" y="202" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">Job J3: waiting (needs 4 GPUs, 0 available)</text>

  <!-- Circular dependency arrows -->
  <path d="M 175,145 Q 200,125 225,145" fill="none" stroke="#a31f34" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="200" y="122" text-anchor="middle" font-size="8" fill="#a31f34" font-weight="700">wants J2's GPUs</text>

  <path d="M 225,155 Q 200,175 175,155" fill="none" stroke="#a31f34" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="200" y="182" text-anchor="middle" font-size="8" fill="#a31f34" font-weight="700">wants J1's GPUs</text>

  <!-- DEADLOCK label -->
  <rect x="150" y="225" width="100" height="28" rx="14" fill="#a31f34" stroke="none"/>
  <text x="200" y="244" text-anchor="middle" font-size="11" font-weight="700" fill="white">DEADLOCK</text>

  <!-- Waste annotation -->
  <rect x="55" y="260" width="290" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="0.6"/>
  <text x="200" y="275" text-anchor="middle" font-size="9" fill="#c44" font-weight="700">8 GPUs allocated, 0 useful work. Waste: $16/hr at $2/GPU-hr.</text>

  <!-- ===== DIVIDER ===== -->
  <line x1="395" y1="14" x2="395" y2="290" stroke="#e0e0e0" stroke-width="1"/>

  <!-- ===== RIGHT SIDE: GANG SCHEDULING SOLUTION ===== -->
  <text x="530" y="22" text-anchor="middle" font-size="12" font-weight="700" fill="#3d9e5a">Solution: Gang Scheduler</text>
  <text x="530" y="46" text-anchor="middle" font-size="9.5" fill="#555">All-or-nothing allocation; atomic resource grants</text>

  <!-- Step 1: J1 gets all 4 -->
  <text x="530" y="68" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Step 1: Allocate J1 atomically</text>
  <rect x="415" y="76" width="38" height="24" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <rect x="457" y="76" width="38" height="24" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <rect x="499" y="76" width="38" height="24" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <rect x="541" y="76" width="38" height="24" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <!-- remaining free -->
  <rect x="587" y="76" width="38" height="24" rx="3" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
  <rect x="629" y="76" width="38" height="24" rx="3" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
  <text x="472" y="92" text-anchor="middle" font-size="8" fill="#4a90c4" font-weight="700">J1</text>
  <text x="518" y="92" text-anchor="middle" font-size="8" fill="#4a90c4" font-weight="700">J1</text>
  <text x="560" y="92" text-anchor="middle" font-size="8" fill="#4a90c4" font-weight="700">J1</text>
  <text x="436" y="92" text-anchor="middle" font-size="8" fill="#4a90c4" font-weight="700">J1</text>
  <text x="620" y="92" text-anchor="middle" font-size="8" fill="#bbb">free</text>

  <!-- check mark -->
  <text x="650" y="68" font-size="12" fill="#3d9e5a">&#x2713;</text>

  <!-- Step 2: J2 queued (not enough free) -->
  <text x="530" y="120" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Step 2: J2 queued (only 4 free, needs 4)</text>
  <text x="530" y="136" text-anchor="middle" font-size="9" fill="#555">J2 waits -- does not hold partial resources</text>

  <!-- Step 3: J1 finishes, J2 runs -->
  <text x="530" y="162" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Step 3: J1 completes, J2 allocated atomically</text>
  <rect x="415" y="170" width="38" height="24" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <rect x="457" y="170" width="38" height="24" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <rect x="499" y="170" width="38" height="24" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <rect x="541" y="170" width="38" height="24" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <rect x="587" y="170" width="38" height="24" rx="3" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
  <rect x="629" y="170" width="38" height="24" rx="3" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
  <text x="436" y="186" text-anchor="middle" font-size="8" fill="#c44" font-weight="700">J2</text>
  <text x="472" y="186" text-anchor="middle" font-size="8" fill="#c44" font-weight="700">J2</text>
  <text x="518" y="186" text-anchor="middle" font-size="8" fill="#c44" font-weight="700">J2</text>
  <text x="560" y="186" text-anchor="middle" font-size="8" fill="#c44" font-weight="700">J2</text>
  <text x="620" y="186" text-anchor="middle" font-size="8" fill="#bbb">free</text>
  <text x="650" y="162" font-size="12" fill="#3d9e5a">&#x2713;</text>

  <!-- Result annotation -->
  <rect x="420" y="210" width="220" height="22" rx="3" fill="#f0fff0" stroke="#3d9e5a" stroke-width="0.8"/>
  <text x="530" y="225" text-anchor="middle" font-size="9" font-weight="700" fill="#3d9e5a">No deadlock. All jobs complete sequentially.</text>

  <!-- ===== RESOURCE DEPENDENCY GRAPH (bottom) ===== -->
  <rect x="30" y="300" width="620" height="130" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.0"/>
  <text x="340" y="320" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Resource Dependency Graph (Deadlock Conditions)</text>

  <!-- Four conditions -->
  <!-- Mutual exclusion -->
  <rect x="50" y="335" width="126" height="40" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="113" y="352" text-anchor="middle" font-size="9" font-weight="700" fill="#333">Mutual Exclusion</text>
  <text x="113" y="365" text-anchor="middle" font-size="8" fill="#555">GPU not shareable</text>

  <!-- Hold and wait -->
  <rect x="190" y="335" width="126" height="40" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="253" y="352" text-anchor="middle" font-size="9" font-weight="700" fill="#333">Hold and Wait</text>
  <text x="253" y="365" text-anchor="middle" font-size="8" fill="#555">Jobs hold partial alloc</text>

  <!-- No preemption -->
  <rect x="330" y="335" width="126" height="40" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="393" y="352" text-anchor="middle" font-size="9" font-weight="700" fill="#333">No Preemption</text>
  <text x="393" y="365" text-anchor="middle" font-size="8" fill="#555">Cannot reclaim GPUs</text>

  <!-- Circular wait -->
  <rect x="470" y="335" width="160" height="40" rx="4" fill="#a31f34" stroke="#a31f34" stroke-width="1"/>
  <text x="550" y="352" text-anchor="middle" font-size="9" font-weight="700" fill="white">Circular Wait</text>
  <text x="550" y="365" text-anchor="middle" font-size="8" fill="white">J1 waits J2 waits J1</text>

  <!-- Arrow chain -->
  <line x1="176" y1="355" x2="188" y2="355" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="316" y1="355" x2="328" y2="355" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="456" y1="355" x2="468" y2="355" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>

  <!-- Gang scheduling breaks "Hold and Wait" -->
  <text x="253" y="395" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">Gang scheduling</text>
  <text x="253" y="407" text-anchor="middle" font-size="8" fill="#3d9e5a" font-weight="700">breaks this condition</text>
  <line x1="253" y1="375" x2="253" y2="388" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>

  <!-- Footnote -->
  <text x="340" y="448" text-anchor="middle" font-size="9" fill="#999" font-style="italic">Gang scheduling enforces atomicity: if a job cannot run in full, it does not run at all.</text>

</svg>
