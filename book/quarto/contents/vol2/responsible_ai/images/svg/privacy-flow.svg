<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#333"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fff"/>

  <!-- Pipeline stages: left to right -->
  <!-- Stage 0: Raw Personal Data -->
  <g transform="translate(20, 115)">
    <rect x="0" y="0" width="110" height="70" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
    <text x="55" y="28" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Raw</text>
    <text x="55" y="43" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Personal Data</text>
    <text x="55" y="58" font-size="9" fill="#555" text-anchor="middle">PII, behaviors</text>
  </g>

  <!-- Arrow 0->1 -->
  <line x1="132" y1="150" x2="152" y2="150" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Stage 1: Differential Privacy -->
  <g transform="translate(155, 100)">
    <rect x="0" y="0" width="115" height="100" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
    <text x="57" y="22" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Differential</text>
    <text x="57" y="37" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Privacy</text>
    <line x1="10" y1="46" x2="105" y2="46" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="57" y="62" font-size="9" fill="#555" text-anchor="middle">Add calibrated</text>
    <text x="57" y="74" font-size="9" fill="#555" text-anchor="middle">Laplace noise</text>
    <text x="57" y="90" font-size="9.5" font-weight="600" fill="#4a90c4" text-anchor="middle">Guarantee: e-DP</text>
  </g>

  <!-- Arrow 1->2 -->
  <line x1="272" y1="150" x2="292" y2="150" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Stage 2: Federated Learning -->
  <g transform="translate(295, 100)">
    <rect x="0" y="0" width="115" height="100" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.5"/>
    <text x="57" y="22" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Federated</text>
    <text x="57" y="37" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Learning</text>
    <line x1="10" y1="46" x2="105" y2="46" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="57" y="62" font-size="9" fill="#555" text-anchor="middle">Local training</text>
    <text x="57" y="74" font-size="9" fill="#555" text-anchor="middle">on each device</text>
    <text x="57" y="90" font-size="9.5" font-weight="600" fill="#3d9e5a" text-anchor="middle">No raw data leaves</text>
  </g>

  <!-- Arrow 2->3 -->
  <line x1="412" y1="150" x2="432" y2="150" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Stage 3: Secure Aggregation -->
  <g transform="translate(435, 100)">
    <rect x="0" y="0" width="115" height="100" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
    <text x="57" y="22" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Secure</text>
    <text x="57" y="37" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Aggregation</text>
    <line x1="10" y1="46" x2="105" y2="46" stroke="#c87b2a" stroke-width="0.8"/>
    <text x="57" y="62" font-size="9" fill="#555" text-anchor="middle">Encrypted</text>
    <text x="57" y="74" font-size="9" fill="#555" text-anchor="middle">gradient sums</text>
    <text x="57" y="90" font-size="9.5" font-weight="600" fill="#c87b2a" text-anchor="middle">Server sees sum</text>
  </g>

  <!-- Arrow 3->4 -->
  <line x1="552" y1="150" x2="572" y2="150" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Stage 4: Global Model -->
  <g transform="translate(575, 115)">
    <rect x="0" y="0" width="90" height="70" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.5"/>
    <text x="45" y="28" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Global</text>
    <text x="45" y="43" font-size="11" font-weight="700" fill="#333" text-anchor="middle">Model</text>
    <text x="45" y="58" font-size="9" fill="#3d9e5a" text-anchor="middle">Privacy-safe</text>
  </g>

  <!-- Attacker visibility gradient bar -->
  <g transform="translate(20, 260)">
    <!-- Background bar -->
    <rect x="0" y="0" width="645" height="36" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
    <!-- Gradient fill showing decreasing visibility -->
    <rect x="2" y="2" width="160" height="32" rx="3" fill="#c44" fill-opacity="0.7"/>
    <rect x="162" y="2" width="140" height="32" rx="0" fill="#c44" fill-opacity="0.4"/>
    <rect x="302" y="2" width="140" height="32" rx="0" fill="#c44" fill-opacity="0.2"/>
    <rect x="442" y="2" width="200" height="32" rx="3" fill="#c44" fill-opacity="0.08"/>

    <!-- Attacker icon and label -->
    <text x="5" y="-8" font-size="10" font-weight="700" fill="#a31f34">Attacker Visibility</text>
    <text x="645" y="-8" font-size="10" font-weight="700" fill="#3d9e5a" text-anchor="end">Decreasing</text>
  </g>

  <!-- Attacker sees labels under gradient bar -->
  <g transform="translate(20, 310)">
    <text x="75" y="0" font-size="9" fill="#a31f34" text-anchor="middle" font-weight="600">Everything</text>
    <text x="75" y="13" font-size="9" fill="#555" text-anchor="middle">raw records,</text>
    <text x="75" y="26" font-size="9" fill="#555" text-anchor="middle">identities, values</text>

    <text x="232" y="0" font-size="9" fill="#a31f34" text-anchor="middle" font-weight="600">Noisy statistics</text>
    <text x="232" y="13" font-size="9" fill="#555" text-anchor="middle">cannot isolate</text>
    <text x="232" y="26" font-size="9" fill="#555" text-anchor="middle">individuals</text>

    <text x="372" y="0" font-size="9" fill="#a31f34" text-anchor="middle" font-weight="600">Model updates only</text>
    <text x="372" y="13" font-size="9" fill="#555" text-anchor="middle">no raw data,</text>
    <text x="372" y="26" font-size="9" fill="#555" text-anchor="middle">gradients only</text>

    <text x="542" y="0" font-size="9" fill="#a31f34" text-anchor="middle" font-weight="600">Encrypted sum</text>
    <text x="542" y="13" font-size="9" fill="#555" text-anchor="middle">individual gradients</text>
    <text x="542" y="26" font-size="9" fill="#555" text-anchor="middle">never visible</text>
  </g>

  <!-- Phase labels at top -->
  <g transform="translate(20, 80)">
    <text x="55" y="0" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Input</text>
    <text x="212" y="0" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Stage 1</text>
    <text x="352" y="0" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Stage 2</text>
    <text x="492" y="0" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Stage 3</text>
    <text x="620" y="0" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Output</text>
  </g>

  <!-- Bottom annotation -->
  <text x="340" y="378" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Each stage adds a layer of privacy protection; an attacker observing later stages gains less information about any individual.</text>

  <!-- Dashed connecting lines from pipeline to visibility bar -->
  <line x1="75" y1="185" x2="75" y2="260" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="212" y1="200" x2="212" y2="260" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="352" y1="200" x2="352" y2="260" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="492" y1="200" x2="492" y2="260" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
  <line x1="620" y1="185" x2="620" y2="260" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
</svg>
