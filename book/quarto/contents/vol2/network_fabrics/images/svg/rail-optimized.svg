<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow-r" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <path d="M0,0 L6,2 L0,4 Z" fill="#555"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="white"/>

  <!-- ===== RAIL SWITCHES (top) ===== -->
  <text x="340" y="24" text-anchor="middle" font-size="9.5" font-weight="700" fill="#555">Rail Switches (Leaf Layer)</text>

  <!-- Spine switch (top-of-rack) -->
  <rect x="260" y="8" width="160" height="4" rx="2" fill="#bbb" stroke="none"/>

  <!-- Switch 0 -->
  <rect x="80" y="36" width="90" height="30" rx="5" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="125" y="55" text-anchor="middle" font-size="10" font-weight="700" fill="#4a90c4">Switch-0</text>
  <!-- spine dashed connection -->
  <line x1="125" y1="36" x2="290" y2="12" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Switch 1 -->
  <rect x="210" y="36" width="90" height="30" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="255" y="55" text-anchor="middle" font-size="10" font-weight="700" fill="#3d9e5a">Switch-1</text>
  <line x1="255" y1="36" x2="320" y2="12" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Switch 2 -->
  <rect x="340" y="36" width="90" height="30" rx="5" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="385" y="55" text-anchor="middle" font-size="10" font-weight="700" fill="#c87b2a">Switch-2</text>
  <line x1="385" y1="36" x2="360" y2="12" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Switch 3 -->
  <rect x="470" y="36" width="90" height="30" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="515" y="55" text-anchor="middle" font-size="10" font-weight="700" fill="#c44">Switch-3</text>
  <line x1="515" y1="36" x2="390" y2="12" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>

  <!-- Spine label -->
  <text x="460" y="16" font-size="8" fill="#bbb" font-style="italic">Spine (dashed)</text>

  <!-- ===== NODE 0 ===== -->
  <rect x="35" y="130" width="280" height="140" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="175" y="124" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Node 0</text>

  <!-- NVLink bus inside node 0 -->
  <rect x="55" y="220" width="240" height="8" rx="4" fill="#e8e8e8" stroke="#bbb" stroke-width="0.6"/>
  <text x="175" y="248" text-anchor="middle" font-size="8" fill="#555" font-weight="700">NVLink 4.0 (900 GB/s)</text>

  <!-- GPU G0 Node 0 -->
  <rect x="58" y="148" width="48" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="82" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G0</text>
  <!-- NVLink connector -->
  <line x1="82" y1="184" x2="82" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G1 Node 0 -->
  <rect x="120" y="148" width="48" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="144" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G1</text>
  <line x1="144" y1="184" x2="144" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G2 Node 0 -->
  <rect x="182" y="148" width="48" height="36" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="206" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G2</text>
  <line x1="206" y1="184" x2="206" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G3 Node 0 -->
  <rect x="244" y="148" width="48" height="36" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="268" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G3</text>
  <line x1="268" y1="184" x2="268" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- ===== NODE 1 ===== -->
  <rect x="365" y="130" width="280" height="140" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="505" y="124" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Node 1</text>

  <!-- NVLink bus inside node 1 -->
  <rect x="385" y="220" width="240" height="8" rx="4" fill="#e8e8e8" stroke="#bbb" stroke-width="0.6"/>
  <text x="505" y="248" text-anchor="middle" font-size="8" fill="#555" font-weight="700">NVLink 4.0 (900 GB/s)</text>

  <!-- GPU G0 Node 1 -->
  <rect x="388" y="148" width="48" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="412" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G0</text>
  <line x1="412" y1="184" x2="412" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G1 Node 1 -->
  <rect x="450" y="148" width="48" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="474" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G1</text>
  <line x1="474" y1="184" x2="474" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G2 Node 1 -->
  <rect x="512" y="148" width="48" height="36" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="536" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G2</text>
  <line x1="536" y1="184" x2="536" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- GPU G3 Node 1 -->
  <rect x="574" y="148" width="48" height="36" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="598" y="170" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G3</text>
  <line x1="598" y1="184" x2="598" y2="220" stroke="#999" stroke-width="1.5"/>

  <!-- ===== RAIL CONNECTIONS (GPU to switch) ===== -->
  <!-- Rail 0: All G0s -> Switch-0 (blue) -->
  <line x1="82" y1="148" x2="105" y2="66" stroke="#4a90c4" stroke-width="1.8"/>
  <line x1="412" y1="148" x2="145" y2="66" stroke="#4a90c4" stroke-width="1.8"/>

  <!-- Rail 1: All G1s -> Switch-1 (green) -->
  <line x1="144" y1="148" x2="235" y2="66" stroke="#3d9e5a" stroke-width="1.8"/>
  <line x1="474" y1="148" x2="275" y2="66" stroke="#3d9e5a" stroke-width="1.8"/>

  <!-- Rail 2: All G2s -> Switch-2 (orange) -->
  <line x1="206" y1="148" x2="365" y2="66" stroke="#c87b2a" stroke-width="1.8"/>
  <line x1="536" y1="148" x2="405" y2="66" stroke="#c87b2a" stroke-width="1.8"/>

  <!-- Rail 3: All G3s -> Switch-3 (red) -->
  <line x1="268" y1="148" x2="495" y2="66" stroke="#c44" stroke-width="1.8"/>
  <line x1="598" y1="148" x2="535" y2="66" stroke="#c44" stroke-width="1.8"/>

  <!-- ===== ANNOTATION BOX ===== -->
  <rect x="40" y="290" width="600" height="80" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.0"/>
  <text x="340" y="312" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Rail-Optimized Design Principle</text>
  <text x="340" y="330" text-anchor="middle" font-size="9.5" fill="#555">All GPUs of the same rank (e.g., all G0s across all nodes) share one leaf switch.</text>
  <text x="340" y="346" text-anchor="middle" font-size="9.5" fill="#555">Data-parallel AllReduce traffic stays on a single switch -- zero contention, 1 hop.</text>
  <text x="340" y="362" text-anchor="middle" font-size="9" fill="#999">Tensor-parallel traffic uses NVLink within each node (no switch traversal).</text>

  <!-- Legend -->
  <line x1="60" y1="400" x2="85" y2="400" stroke="#4a90c4" stroke-width="2"/>
  <text x="92" y="404" font-size="9" fill="#555">Rail 0</text>
  <line x1="140" y1="400" x2="165" y2="400" stroke="#3d9e5a" stroke-width="2"/>
  <text x="172" y="404" font-size="9" fill="#555">Rail 1</text>
  <line x1="220" y1="400" x2="245" y2="400" stroke="#c87b2a" stroke-width="2"/>
  <text x="252" y="404" font-size="9" fill="#555">Rail 2</text>
  <line x1="300" y1="400" x2="325" y2="400" stroke="#c44" stroke-width="2"/>
  <text x="332" y="404" font-size="9" fill="#555">Rail 3</text>

  <line x1="400" y1="400" x2="425" y2="400" stroke="#999" stroke-width="1.5"/>
  <text x="432" y="404" font-size="9" fill="#555">NVLink (intra-node)</text>
  <line x1="540" y1="400" x2="565" y2="400" stroke="#bbb" stroke-width="0.8" stroke-dasharray="4,3"/>
  <text x="572" y="404" font-size="9" fill="#555">Spine</text>

  <!-- Footnote -->
  <text x="340" y="440" text-anchor="middle" font-size="9" fill="#999" font-style="italic">Used in NVIDIA DGX SuperPOD and Meta Grand Teton cluster designs.</text>

</svg>
