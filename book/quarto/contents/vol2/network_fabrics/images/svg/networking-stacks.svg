<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow-down" markerWidth="7" markerHeight="5" refX="3.5" refY="5" orient="auto">
      <path d="M0,0 L7,0 L3.5,5 Z" fill="#555"/>
    </marker>
    <marker id="arrow-down-green" markerWidth="7" markerHeight="5" refX="3.5" refY="5" orient="auto">
      <path d="M0,0 L7,0 L3.5,5 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="white"/>

  <!-- ===== LEFT COLUMN: Traditional TCP/IP Stack ===== -->
  <text x="170" y="28" text-anchor="middle" font-size="12" font-weight="700" fill="#333">Traditional TCP/IP</text>

  <!-- MPI Layer -->
  <rect x="40" y="42" width="260" height="36" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="170" y="64" text-anchor="middle" font-size="10" font-weight="700" fill="#333">MPI / NCCL</text>
  <text x="170" y="74" text-anchor="middle" font-size="8" fill="#555">Collective library</text>

  <!-- Arrow down (stop 4px above target rect to let arrowhead show cleanly) -->
  <line x1="170" y1="78" x2="170" y2="90" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- Application -->
  <rect x="40" y="94" width="260" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="170" y="116" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Application</text>

  <!-- Arrow through kernel -->
  <line x1="170" y1="130" x2="170" y2="143" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- Kernel boundary label -->
  <rect x="40" y="147" width="260" height="20" rx="0" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="170" y="161" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">OS Kernel (context switch)</text>

  <!-- Arrow down -->
  <line x1="170" y1="167" x2="170" y2="179" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- Socket API -->
  <rect x="40" y="183" width="260" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="170" y="205" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Socket API</text>

  <!-- Arrow down -->
  <line x1="170" y1="219" x2="170" y2="231" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- TCP/UDP Transport -->
  <rect x="40" y="235" width="260" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="170" y="257" text-anchor="middle" font-size="10" font-weight="700" fill="#333">TCP / UDP</text>

  <!-- Arrow down -->
  <line x1="170" y1="271" x2="170" y2="283" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- IP / Ethernet Network -->
  <rect x="40" y="287" width="260" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="170" y="309" text-anchor="middle" font-size="10" font-weight="700" fill="#333">IP / Ethernet</text>

  <!-- Arrow down -->
  <line x1="170" y1="323" x2="170" y2="335" stroke="#555" stroke-width="1" marker-end="url(#arrow-down)"/>

  <!-- NIC / Physical -->
  <rect x="40" y="339" width="260" height="36" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="170" y="361" text-anchor="middle" font-size="10" font-weight="700" fill="#333">NIC / Physical</text>

  <!-- Latency label -->
  <rect x="60" y="388" width="220" height="22" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="0.8"/>
  <text x="170" y="403" text-anchor="middle" font-size="9" font-weight="700" fill="#c44">Latency: 10-20 us | CPU copies: 2-3x</text>

  <!-- Data path annotation (left side) -->
  <text x="22" y="160" font-size="8" fill="#c44" font-weight="700" transform="rotate(-90,22,200)">Data: App -> CPU DRAM -> Kernel -> NIC</text>

  <!-- ===== RIGHT COLUMN: RDMA / RoCE v2 Stack ===== -->
  <text x="510" y="28" text-anchor="middle" font-size="12" font-weight="700" fill="#3d9e5a">RDMA / RoCE v2</text>

  <!-- MPI Layer -->
  <rect x="380" y="42" width="260" height="36" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="510" y="64" text-anchor="middle" font-size="10" font-weight="700" fill="#333">MPI / NCCL</text>
  <text x="510" y="74" text-anchor="middle" font-size="8" fill="#555">Collective library</text>

  <!-- Arrow down -->
  <line x1="510" y1="78" x2="510" y2="90" stroke="#3d9e5a" stroke-width="1" marker-end="url(#arrow-down-green)"/>

  <!-- Application + Verbs API -->
  <rect x="380" y="94" width="260" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="510" y="112" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Application (Verbs API)</text>
  <text x="510" y="124" text-anchor="middle" font-size="8" fill="#3d9e5a">User-space, no syscall</text>

  <!-- KERNEL BYPASS: Big arrow directly to NIC -->
  <!-- Dashed box showing bypassed kernel -->
  <rect x="380" y="147" width="260" height="168" rx="4" fill="none" stroke="#bbb" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="510" y="168" text-anchor="middle" font-size="9" fill="#bbb" font-weight="700">Kernel Bypassed</text>
  <text x="510" y="200" text-anchor="middle" font-size="9" fill="#bbb">(no socket, no TCP,</text>
  <text x="510" y="212" text-anchor="middle" font-size="9" fill="#bbb">no IP stack traversal)</text>

  <!-- Bypass arrow from app directly to NIC area -->
  <path d="M 640,112 C 660,112 660,340 640,340" fill="none" stroke="#3d9e5a" stroke-width="2.5"/>
  <polygon points="640,340 648,334 648,346" fill="#3d9e5a"/>
  <text x="667" y="230" font-size="9" fill="#3d9e5a" font-weight="700" transform="rotate(90,667,230)">Kernel bypass</text>

  <!-- RDMA Transport (thin, inside bypass region) -->
  <rect x="400" y="250" width="220" height="30" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8" opacity="0.5"/>
  <text x="510" y="269" text-anchor="middle" font-size="9" fill="#3d9e5a">RDMA Transport (HW offload)</text>

  <!-- NIC / Physical (RDMA) -->
  <rect x="380" y="339" width="260" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="510" y="355" text-anchor="middle" font-size="10" font-weight="700" fill="#333">RDMA NIC (ConnectX)</text>
  <text x="510" y="368" text-anchor="middle" font-size="8" fill="#3d9e5a">GPUDirect: NIC reads GPU HBM directly</text>

  <!-- Latency label -->
  <rect x="400" y="388" width="220" height="22" rx="3" fill="#f0fff0" stroke="#3d9e5a" stroke-width="0.8"/>
  <text x="510" y="403" text-anchor="middle" font-size="9" font-weight="700" fill="#3d9e5a">Latency: 1-3 us | Zero-copy: 0 CPU</text>

  <!-- Data path annotation (right side) -->
  <text x="375" y="265" font-size="8" fill="#3d9e5a" font-weight="700" transform="rotate(-90,375,265)">Data: GPU HBM -> NIC (direct)</text>

  <!-- Center divider -->
  <line x1="340" y1="35" x2="340" y2="420" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- Comparison arrows -->
  <text x="340" y="440" text-anchor="middle" font-size="9" fill="#999" font-style="italic">RDMA eliminates kernel traversal, reducing latency by 5-10x and freeing CPU for computation.</text>

  <!-- Annotation labels -->
  <text x="340" y="148" text-anchor="middle" font-size="8" fill="#a31f34" font-weight="700">Kernel boundary</text>

</svg>
