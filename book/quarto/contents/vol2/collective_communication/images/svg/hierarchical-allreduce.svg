<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow-blue" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arrow-orange" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#c87b2a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="white"/>

  <!-- ===== NODE 0 (left) ===== -->
  <rect x="20" y="60" width="300" height="230" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="170" y="52" text-anchor="middle" font-size="12" font-weight="700" fill="#333">Node 0</text>

  <!-- GPU 0 -->
  <rect x="42" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="70" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G0</text>
  <!-- GPU 1 -->
  <rect x="118" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="146" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G1</text>
  <!-- GPU 2 -->
  <rect x="194" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="222" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G2</text>
  <!-- GPU 3 -->
  <rect x="262" y="90" width="48" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="286" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G3</text>

  <!-- NVLink ring within Node 0 (Step 1) -->
  <!-- Ring: G0->G1->G2->G3->G0 -->
  <!-- Control points offset so arrowhead arrives at a diagonal, not straight vertical -->
  <path d="M 70,130 C 80,158 136,158 146,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 146,130 C 156,158 212,158 222,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 222,130 C 230,152 277,152 285,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 285,88 C 275,64 80,64 70,88" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>

  <!-- Step 1 label Node 0 -->
  <rect x="55" y="170" width="230" height="20" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
  <text x="170" y="184" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Step 1: Intra-node NVLink ring</text>

  <!-- G0 highlight as representative -->
  <rect x="42" y="200" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="70" y="215" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">G0 (rep)</text>

  <!-- ===== NODE 1 (right) ===== -->
  <rect x="360" y="60" width="300" height="230" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="510" y="52" text-anchor="middle" font-size="12" font-weight="700" fill="#333">Node 1</text>

  <!-- GPU 4 -->
  <rect x="382" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="410" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G4</text>
  <!-- GPU 5 -->
  <rect x="458" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="486" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G5</text>
  <!-- GPU 6 -->
  <rect x="534" y="90" width="56" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="562" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G6</text>
  <!-- GPU 7 -->
  <rect x="602" y="90" width="48" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="626" y="114" text-anchor="middle" font-size="10" font-weight="700" fill="#333">G7</text>

  <!-- NVLink ring within Node 1 (Step 1) -->
  <path d="M 410,130 C 410,162 486,162 486,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 486,130 C 486,162 562,162 562,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 562,130 C 562,155 625,155 625,130" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>
  <path d="M 625,88 C 625,66 410,66 410,88" fill="none" stroke="#4a90c4" stroke-width="1.8" marker-end="url(#arrow-blue)"/>

  <!-- Step 1 label Node 1 -->
  <rect x="395" y="170" width="230" height="20" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
  <text x="510" y="184" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Step 1: Intra-node NVLink ring</text>

  <!-- G4 highlight as representative -->
  <rect x="382" y="200" width="56" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="410" y="215" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">G4 (rep)</text>

  <!-- ===== STEP 2: Inter-node IB AllReduce ===== -->
  <!-- IB connection line between representatives -->
  <line x1="98" y1="211" x2="380" y2="211" stroke="#c87b2a" stroke-width="2.5" stroke-dasharray="8,4" marker-end="url(#arrow-orange)"/>
  <line x1="380" y1="218" x2="98" y2="218" stroke="#c87b2a" stroke-width="2.5" stroke-dasharray="8,4" marker-end="url(#arrow-orange)"/>

  <!-- Step 2 label -->
  <rect x="175" y="234" width="330" height="22" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="0.8"/>
  <text x="340" y="249" text-anchor="middle" font-size="9.5" font-weight="700" fill="#c87b2a">Step 2: Inter-node InfiniBand AllReduce (representatives only)</text>

  <!-- Step 3 label -->
  <rect x="175" y="264" width="330" height="20" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
  <text x="340" y="278" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">Step 3: Intra-node broadcast (NVLink) -- result to all GPUs</text>

  <!-- ===== BANDWIDTH COMPARISON ===== -->
  <rect x="40" y="310" width="600" height="100" rx="6" fill="#f7f7f7" stroke="#bbb" stroke-width="1.0"/>
  <text x="340" y="332" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Bandwidth Comparison</text>

  <!-- NVLink bar -->
  <rect x="80" y="344" width="400" height="18" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="280" y="357" text-anchor="middle" font-size="9" font-weight="700" fill="#4a90c4">NVLink 4.0: ~900 GB/s (bidirectional)</text>

  <!-- IB bar (shorter) -->
  <rect x="80" y="372" width="88" height="18" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="255" y="385" text-anchor="middle" font-size="9" font-weight="700" fill="#c87b2a">InfiniBand NDR: ~50 GB/s (200 Gb/s per port)</text>

  <!-- Ratio annotation -->
  <text x="500" y="357" font-size="9" fill="#555">18x faster</text>
  <line x1="480" y1="353" x2="480" y2="383" stroke="#bbb" stroke-width="0.6"/>
  <path d="M 480,353 L 485,358" stroke="#bbb" stroke-width="0.6" fill="none"/>
  <path d="M 480,383 L 485,378" stroke="#bbb" stroke-width="0.6" fill="none"/>

  <!-- Legend -->
  <line x1="80" y1="432" x2="110" y2="432" stroke="#4a90c4" stroke-width="2"/>
  <text x="118" y="436" font-size="9" fill="#555">NVLink (intra-node, Steps 1 &amp; 3)</text>
  <line x1="330" y1="432" x2="360" y2="432" stroke="#c87b2a" stroke-width="2" stroke-dasharray="6,3"/>
  <text x="368" y="436" font-size="9" fill="#555">InfiniBand (inter-node, Step 2)</text>

  <!-- Footnote -->
  <text x="340" y="452" text-anchor="middle" font-size="9" fill="#999" font-style="italic">Hierarchical AllReduce minimizes slow inter-node traffic by reducing within each node first.</text>

</svg>
