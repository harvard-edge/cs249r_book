<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#333"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fff"/>

  <!-- Main flow: left to right with feedback loop -->

  <!-- Step 1: Target Label -->
  <g transform="translate(20, 120)">
    <rect x="0" y="0" width="100" height="65" rx="6" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
    <text x="50" y="22" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Target Label</text>
    <line x1="8" y1="30" x2="92" y2="30" stroke="#c87b2a" stroke-width="0.6"/>
    <text x="50" y="46" font-size="9" fill="#555" text-anchor="middle">"Person X"</text>
    <text x="50" y="58" font-size="9" fill="#555" text-anchor="middle">class = 42</text>
  </g>

  <!-- Step label -->
  <text x="70" y="108" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Step 1</text>

  <!-- Arrow -->
  <line x1="122" y1="152" x2="152" y2="152" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Step 2: Optimization loop box -->
  <g transform="translate(155, 72)">
    <rect x="0" y="0" width="250" height="175" rx="8" fill="#f9d6d5" stroke="#c44" stroke-width="1.5"/>
    <text x="125" y="22" font-size="11" font-weight="700" fill="#a31f34" text-anchor="middle">Gradient Optimization Loop</text>
    <line x1="15" y1="30" x2="235" y2="30" stroke="#c44" stroke-width="0.6"/>

    <!-- Inner loop steps -->
    <!-- Initialize -->
    <rect x="20" y="42" width="90" height="38" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1"/>
    <text x="65" y="58" font-size="9" fill="#555" text-anchor="middle">Initialize x</text>
    <text x="65" y="70" font-size="9" fill="#555" text-anchor="middle">as noise</text>

    <!-- Arrow down -->
    <line x1="65" y1="82" x2="65" y2="96" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>

    <!-- Query model -->
    <rect x="20" y="98" width="90" height="38" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
    <text x="65" y="114" font-size="9" fill="#555" text-anchor="middle">Query model</text>
    <text x="65" y="126" font-size="9" fill="#555" text-anchor="middle">f(x) = p(y|x)</text>

    <!-- Arrow right -->
    <line x1="112" y1="117" x2="132" y2="117" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>

    <!-- Compute gradient -->
    <rect x="135" y="98" width="95" height="38" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
    <text x="182" y="114" font-size="9" fill="#555" text-anchor="middle">Compute grad</text>
    <text x="182" y="126" font-size="9" fill="#555" text-anchor="middle">dL/dx</text>

    <!-- Arrow down to update -->
    <line x1="182" y1="138" x2="182" y2="148" stroke="#a31f34" stroke-width="1" marker-end="url(#arrow-red)"/>

    <!-- Update input -->
    <rect x="135" y="150" width="95" height="18" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
    <text x="182" y="163" font-size="8.5" font-weight="600" fill="#a31f34" text-anchor="middle">x = x - a * dL/dx</text>

    <!-- Loop-back arrow -->
    <path d="M 135,159 Q 115,159 115,140 Q 115,100 112,100" fill="none" stroke="#a31f34" stroke-width="1" stroke-dasharray="3,2"/>

    <!-- Iteration label -->
    <text x="125" y="52" font-size="8" fill="#a31f34" text-anchor="middle" font-style="italic">repeat N iterations</text>
  </g>

  <!-- Step label -->
  <text x="280" y="62" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Step 2</text>

  <!-- Arrow from loop to model -->
  <line x1="407" y1="152" x2="437" y2="152" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Step 3: Target Model -->
  <g transform="translate(440, 110)">
    <rect x="0" y="0" width="100" height="85" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
    <text x="50" y="22" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Target</text>
    <text x="50" y="37" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Model</text>
    <line x1="8" y1="45" x2="92" y2="45" stroke="#4a90c4" stroke-width="0.6"/>
    <text x="50" y="60" font-size="9" fill="#555" text-anchor="middle">Returns</text>
    <text x="50" y="72" font-size="9" fill="#555" text-anchor="middle">confidence</text>
    <text x="50" y="82" font-size="9" fill="#555" text-anchor="middle">p(y=42|x)</text>
  </g>

  <!-- Step label -->
  <text x="490" y="100" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Step 3</text>

  <!-- Arrow to result -->
  <line x1="542" y1="152" x2="572" y2="152" stroke="#333" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- Step 4: Reconstructed output -->
  <g transform="translate(575, 105)">
    <rect x="0" y="0" width="90" height="95" rx="6" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.5"/>
    <text x="45" y="18" font-size="9" font-weight="700" fill="#3d9e5a" text-anchor="middle">Reconstructed</text>
    <text x="45" y="30" font-size="9" font-weight="700" fill="#3d9e5a" text-anchor="middle">Input</text>

    <!-- Placeholder for "reconstructed image" (abstract pattern) -->
    <rect x="15" y="38" width="60" height="48" rx="3" fill="#f7f7f7" stroke="#bbb" stroke-width="0.8"/>
    <!-- Face-like abstract pattern -->
    <circle cx="35" cy="52" r="3" fill="#bbb"/>
    <circle cx="55" cy="52" r="3" fill="#bbb"/>
    <path d="M 38,66 Q 45,72 52,66" fill="none" stroke="#bbb" stroke-width="1.2"/>
    <ellipse cx="45" cy="56" rx="18" ry="20" fill="none" stroke="#999" stroke-width="0.8"/>
  </g>

  <!-- Step label -->
  <text x="620" y="100" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Step 4</text>

  <!-- Before/After comparison below -->
  <g transform="translate(40, 290)">
    <text x="0" y="0" font-size="11" font-weight="700" fill="#333">Before / After Reconstruction</text>

    <!-- Before: random noise -->
    <g transform="translate(0, 15)">
      <rect x="0" y="0" width="120" height="90" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
      <text x="60" y="14" font-size="9" font-weight="600" fill="#555" text-anchor="middle">Iteration 0</text>
      <!-- Random noise pattern -->
      <rect x="10" y="22" width="100" height="58" rx="2" fill="#eee" stroke="#ddd" stroke-width="0.5"/>
      <rect x="15" y="27" width="8" height="8" fill="#ccc" opacity="0.7"/>
      <rect x="28" y="27" width="8" height="8" fill="#aaa" opacity="0.5"/>
      <rect x="41" y="27" width="8" height="8" fill="#ddd" opacity="0.8"/>
      <rect x="54" y="27" width="8" height="8" fill="#bbb" opacity="0.6"/>
      <rect x="67" y="27" width="8" height="8" fill="#eee" opacity="0.4"/>
      <rect x="80" y="27" width="8" height="8" fill="#999" opacity="0.7"/>
      <rect x="93" y="27" width="8" height="8" fill="#ccc" opacity="0.5"/>
      <rect x="15" y="40" width="8" height="8" fill="#ddd" opacity="0.6"/>
      <rect x="28" y="40" width="8" height="8" fill="#999" opacity="0.8"/>
      <rect x="41" y="40" width="8" height="8" fill="#bbb" opacity="0.4"/>
      <rect x="54" y="40" width="8" height="8" fill="#aaa" opacity="0.7"/>
      <rect x="67" y="40" width="8" height="8" fill="#ccc" opacity="0.5"/>
      <rect x="80" y="40" width="8" height="8" fill="#ddd" opacity="0.8"/>
      <rect x="93" y="40" width="8" height="8" fill="#eee" opacity="0.3"/>
      <rect x="15" y="53" width="8" height="8" fill="#aaa" opacity="0.5"/>
      <rect x="28" y="53" width="8" height="8" fill="#ccc" opacity="0.7"/>
      <rect x="41" y="53" width="8" height="8" fill="#999" opacity="0.6"/>
      <rect x="54" y="53" width="8" height="8" fill="#ddd" opacity="0.4"/>
      <rect x="67" y="53" width="8" height="8" fill="#bbb" opacity="0.8"/>
      <rect x="80" y="53" width="8" height="8" fill="#aaa" opacity="0.5"/>
      <rect x="93" y="53" width="8" height="8" fill="#999" opacity="0.7"/>
      <rect x="15" y="66" width="8" height="8" fill="#ddd" opacity="0.8"/>
      <rect x="28" y="66" width="8" height="8" fill="#bbb" opacity="0.4"/>
      <rect x="41" y="66" width="8" height="8" fill="#ccc" opacity="0.6"/>
      <rect x="54" y="66" width="8" height="8" fill="#999" opacity="0.5"/>
      <rect x="67" y="66" width="8" height="8" fill="#eee" opacity="0.7"/>
      <rect x="80" y="66" width="8" height="8" fill="#aaa" opacity="0.3"/>
      <rect x="93" y="66" width="8" height="8" fill="#bbb" opacity="0.8"/>
      <text x="60" y="88" font-size="8" fill="#999" text-anchor="middle" font-style="italic">Random noise</text>
    </g>

    <!-- Arrow -->
    <line x1="135" y1="60" x2="175" y2="60" stroke="#a31f34" stroke-width="1.5" marker-end="url(#arrow-red)"/>
    <text x="155" y="50" font-size="8" fill="#a31f34" text-anchor="middle">N iters</text>

    <!-- After: recognizable pattern -->
    <g transform="translate(190, 15)">
      <rect x="0" y="0" width="120" height="90" rx="4" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
      <text x="60" y="14" font-size="9" font-weight="600" fill="#555" text-anchor="middle">Iteration N</text>
      <!-- Recognizable face-like pattern -->
      <rect x="10" y="22" width="100" height="58" rx="2" fill="#f7f7f7" stroke="#ddd" stroke-width="0.5"/>
      <!-- Head outline -->
      <ellipse cx="60" cy="50" rx="28" ry="32" fill="#eee" stroke="#999" stroke-width="1"/>
      <!-- Eyes -->
      <ellipse cx="48" cy="42" rx="5" ry="3.5" fill="#bbb" stroke="#888" stroke-width="0.6"/>
      <ellipse cx="72" cy="42" rx="5" ry="3.5" fill="#bbb" stroke="#888" stroke-width="0.6"/>
      <!-- Nose -->
      <line x1="60" y1="46" x2="58" y2="55" stroke="#aaa" stroke-width="0.8"/>
      <!-- Mouth -->
      <path d="M 52,60 Q 60,66 68,60" fill="none" stroke="#aaa" stroke-width="0.8"/>
      <text x="60" y="88" font-size="8" fill="#a31f34" text-anchor="middle" font-style="italic">Reconstructed</text>
    </g>
  </g>

  <!-- Privacy violation annotation -->
  <g transform="translate(370, 290)">
    <rect x="0" y="0" width="290" height="90" rx="6" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
    <text x="145" y="20" font-size="10" font-weight="700" fill="#333" text-anchor="middle">Privacy Violation Mechanism</text>
    <line x1="10" y1="28" x2="280" y2="28" stroke="#c87b2a" stroke-width="0.6"/>
    <text x="145" y="44" font-size="9" fill="#555" text-anchor="middle">The attacker never accesses the training set</text>
    <text x="145" y="58" font-size="9" fill="#555" text-anchor="middle">directly. The model's confidence scores serve</text>
    <text x="145" y="72" font-size="9" fill="#555" text-anchor="middle">as an optimization signal to reconstruct inputs</text>
    <text x="145" y="84" font-size="9" font-weight="600" fill="#a31f34" text-anchor="middle">that approximate original training data.</text>
  </g>

  <!-- Bottom annotation -->
  <text x="340" y="420" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Model inversion uses gradient-based optimization to reconstruct training data from model outputs alone,</text>
  <text x="340" y="434" font-size="9" fill="#999" text-anchor="middle" font-style="italic">violating data subject privacy without direct access to the training set.</text>
</svg>
