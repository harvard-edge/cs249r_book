<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arr-laser" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
    <marker id="arr-flow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arr-hijack" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fff"/>

  <!-- ===== Die view (top-down) ===== -->
  <!-- Main chip die -->
  <rect x="180" y="50" width="320" height="220" rx="6" fill="#e8e8e8" stroke="#888" stroke-width="2"/>
  <text x="340" y="73" font-size="10" font-weight="700" fill="#555" text-anchor="middle">Microcontroller Die (Top-Down View)</text>

  <!-- Circuit elements inside the die (schematic decoration) -->
  <!-- Grid of cells -->
  <g stroke="#ccc" stroke-width="0.6" fill="none">
    <line x1="200" y1="90" x2="200" y2="258"/>
    <line x1="230" y1="90" x2="230" y2="258"/>
    <line x1="260" y1="90" x2="260" y2="258"/>
    <line x1="320" y1="90" x2="320" y2="258"/>
    <line x1="380" y1="90" x2="380" y2="258"/>
    <line x1="420" y1="90" x2="420" y2="258"/>
    <line x1="460" y1="90" x2="460" y2="258"/>
    <line x1="190" y1="100" x2="490" y2="100"/>
    <line x1="190" y1="130" x2="490" y2="130"/>
    <line x1="190" y1="160" x2="490" y2="160"/>
    <line x1="190" y1="190" x2="490" y2="190"/>
    <line x1="190" y1="220" x2="490" y2="220"/>
    <line x1="190" y1="250" x2="490" y2="250"/>
  </g>

  <!-- CPU region (blue rectangle inside die) -->
  <rect x="192" y="82" width="118" height="80" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="251" y="118" font-size="8.5" fill="#1e4f7a" text-anchor="middle">CPU Core</text>

  <!-- SRAM/Memory region (gray) -->
  <rect x="322" y="82" width="158" height="80" rx="3" fill="#e0e0e0" stroke="#999" stroke-width="1"/>
  <text x="401" y="118" font-size="8.5" fill="#555" text-anchor="middle">SRAM / Code Memory</text>

  <!-- Target memory cell (highlighted, at approximately x=370, y=170) -->
  <rect x="354" y="166" width="42" height="42" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="2"/>
  <text x="375" y="186" font-size="8" font-weight="700" fill="#c87b2a" text-anchor="middle">Target</text>
  <text x="375" y="198" font-size="8" fill="#c87b2a" text-anchor="middle">cell</text>
  <!-- Transistor symbol inside cell (simple MOSFET) -->
  <!-- Gate line -->
  <line x1="375" y1="176" x2="375" y2="178" stroke="#c87b2a" stroke-width="1.2"/>
  <!-- Gate bar -->
  <line x1="370" y1="178" x2="380" y2="178" stroke="#c87b2a" stroke-width="1.2"/>

  <!-- Bit state before label -->
  <rect x="414" y="158" width="36" height="20" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="432" y="172" font-size="11" font-weight="700" fill="#1a5c30" text-anchor="middle">1</text>

  <!-- Arrow → state flip → -->
  <line x1="452" y1="168" x2="468" y2="168" stroke="#a31f34" stroke-width="1.5" marker-end="url(#arr-laser)"/>

  <rect x="470" y="158" width="36" height="20" rx="3" fill="#f9d6d5" stroke="#a31f34" stroke-width="1.5"/>
  <text x="488" y="172" font-size="11" font-weight="700" fill="#a31f34" text-anchor="middle">0</text>

  <!-- Before / after labels -->
  <text x="432" y="152" font-size="7.5" fill="#3d9e5a" text-anchor="middle" font-style="italic">before</text>
  <text x="488" y="152" font-size="7.5" fill="#a31f34" text-anchor="middle" font-style="italic">after</text>

  <!-- Laser beam (red diagonal from top-left hitting target cell) -->
  <line x1="100" y1="20" x2="360" y2="172" stroke="#a31f34" stroke-width="3" opacity="0.85" marker-end="url(#arr-laser)"/>
  <!-- Laser cone effect (lighter line) -->
  <line x1="100" y1="20" x2="358" y2="178" stroke="#f9d6d5" stroke-width="5" opacity="0.35"/>

  <!-- Laser label -->
  <rect x="18" y="10" width="120" height="36" rx="3" fill="#f9d6d5" stroke="#a31f34" stroke-width="1.2"/>
  <text x="78" y="27" font-size="9.5" font-weight="700" fill="#a31f34" text-anchor="middle">Focused Laser /</text>
  <text x="78" y="41" font-size="9.5" fill="#a31f34" text-anchor="middle">EM Pulse Source</text>

  <!-- Impact annotation -->
  <rect x="220" y="174" width="124" height="28" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="282" y="189" font-size="8.5" font-weight="700" fill="#c87b2a" text-anchor="middle">Fault injection at target cell</text>
  <text x="282" y="199" font-size="0" fill="none"/>
  <!-- Arrow from annotation to target -->
  <line x1="354" y1="188" x2="342" y2="188" stroke="#c87b2a" stroke-width="1" marker-end="url(#arr-flow)"/>

  <!-- ===== Instruction flow redirection diagram (below die) ===== -->
  <text x="340" y="294" font-size="10" font-weight="700" fill="#444" text-anchor="middle">Instruction Execution: Before and After Fault</text>
  <line x1="100" y1="300" x2="580" y2="300" stroke="#ddd" stroke-width="1"/>

  <!-- Normal flow (top row) -->
  <text x="80" y="325" font-size="8.5" fill="#3d9e5a" font-weight="600">Normal:</text>

  <rect x="120" y="312" width="80" height="26" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="160" y="329" font-size="8.5" fill="#1e4f7a" text-anchor="middle">authenticate()</text>

  <line x1="200" y1="325" x2="218" y2="325" stroke="#4a90c4" stroke-width="1.3" marker-end="url(#arr-flow)"/>

  <rect x="220" y="312" width="80" height="26" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="260" y="329" font-size="8.5" fill="#1e4f7a" text-anchor="middle">check_sig()</text>

  <line x1="300" y1="325" x2="318" y2="325" stroke="#4a90c4" stroke-width="1.3" marker-end="url(#arr-flow)"/>

  <rect x="320" y="312" width="80" height="26" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="360" y="325" font-size="8.5" fill="#1a5c30" text-anchor="middle">if (ok)</text>
  <text x="360" y="335" font-size="8.5" fill="#1a5c30" text-anchor="middle">grant_access()</text>

  <line x1="400" y1="325" x2="418" y2="325" stroke="#4a90c4" stroke-width="1.3" marker-end="url(#arr-flow)"/>

  <rect x="420" y="312" width="80" height="26" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="460" y="325" font-size="8.5" fill="#1a5c30" text-anchor="middle">secure_exec()</text>
  <text x="460" y="335" font-size="8.5" fill="#1a5c30" text-anchor="middle">&#x2713; trusted</text>

  <!-- Faulted flow (bottom row) -->
  <text x="80" y="378" font-size="8.5" fill="#a31f34" font-weight="600">Faulted:</text>

  <rect x="120" y="365" width="80" height="26" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="160" y="382" font-size="8.5" fill="#1e4f7a" text-anchor="middle">authenticate()</text>

  <line x1="200" y1="378" x2="218" y2="378" stroke="#a31f34" stroke-width="1.3" marker-end="url(#arr-hijack)"/>

  <rect x="220" y="365" width="80" height="26" rx="3" fill="#f9d6d5" stroke="#a31f34" stroke-width="1.3"/>
  <text x="260" y="378" font-size="8.5" fill="#a31f34" text-anchor="middle">check_sig()</text>
  <text x="260" y="388" font-size="8" fill="#a31f34" text-anchor="middle">&#x26A0; BIT FLIP</text>

  <!-- Hijack arrow: skips normal branch, goes to attacker payload -->
  <line x1="300" y1="378" x2="360" y2="378" stroke="#a31f34" stroke-width="1.5" stroke-dasharray="4,3"/>
  <line x1="360" y1="378" x2="360" y2="408" stroke="#a31f34" stroke-width="1.5" stroke-dasharray="4,3"/>
  <line x1="360" y1="408" x2="490" y2="408" stroke="#a31f34" stroke-width="1.5" marker-end="url(#arr-hijack)"/>

  <!-- Attacker payload box -->
  <rect x="492" y="365" width="114" height="56" rx="4" fill="#f9d6d5" stroke="#a31f34" stroke-width="2"/>
  <text x="549" y="385" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Attacker Payload</text>
  <text x="549" y="399" font-size="8" fill="#555" text-anchor="middle">Privilege escalation,</text>
  <text x="549" y="411" font-size="8" fill="#555" text-anchor="middle">key extraction</text>

  <!-- Bypass label -->
  <text x="390" y="402" font-size="8" fill="#a31f34" font-style="italic">branch hijack</text>

  <!-- Bottom annotation -->
  <text x="340" y="450" font-size="9" fill="#999" text-anchor="middle" font-style="italic">A single-bit fault in a branch condition can bypass all cryptographic checks, redirecting execution to attacker-controlled code.</text>
</svg>
