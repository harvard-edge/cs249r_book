<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arr-enc" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arr-enc-l" markerWidth="8" markerHeight="6" refX="1" refY="3" orient="auto">
      <path d="M8,0 L0,3 L8,6 Z" fill="#4a90c4"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fff"/>

  <!-- Main Processor outer boundary -->
  <rect x="30" y="50" width="480" height="360" rx="8" fill="#fafafa" stroke="#999" stroke-width="2"/>
  <text x="270" y="78" font-size="13" font-weight="700" fill="#444" text-anchor="middle">Main Processor (SoC)</text>

  <!-- Regular execution area (outside enclave) -->
  <rect x="50" y="92" width="220" height="150" rx="5" fill="#e0e0e0" stroke="#bbb" stroke-width="1.3"/>
  <text x="160" y="112" font-size="10" font-weight="600" fill="#666" text-anchor="middle">Regular Execution</text>
  <line x1="60" y1="120" x2="260" y2="120" stroke="#bbb" stroke-width="0.8"/>

  <!-- Regular CPU cores (gray) -->
  <rect x="62" y="128" width="52" height="44" rx="3" fill="#d0d0d0" stroke="#aaa" stroke-width="1"/>
  <text x="88" y="147" font-size="8" fill="#555" text-anchor="middle">CPU</text>
  <text x="88" y="158" font-size="8" fill="#555" text-anchor="middle">Core 0</text>

  <rect x="124" y="128" width="52" height="44" rx="3" fill="#d0d0d0" stroke="#aaa" stroke-width="1"/>
  <text x="150" y="147" font-size="8" fill="#555" text-anchor="middle">CPU</text>
  <text x="150" y="158" font-size="8" fill="#555" text-anchor="middle">Core 1</text>

  <rect x="186" y="128" width="52" height="44" rx="3" fill="#d0d0d0" stroke="#aaa" stroke-width="1"/>
  <text x="212" y="147" font-size="8" fill="#555" text-anchor="middle">GPU</text>
  <text x="212" y="158" font-size="8" fill="#555" text-anchor="middle">Engine</text>

  <!-- Regular memory (gray) -->
  <rect x="62" y="184" width="176" height="44" rx="3" fill="#e8e8e8" stroke="#aaa" stroke-width="1"/>
  <text x="150" y="203" font-size="8.5" font-weight="600" fill="#666" text-anchor="middle">Regular Memory (DRAM)</text>
  <text x="150" y="218" font-size="8" fill="#888" text-anchor="middle">Accessible to OS / other processes</text>

  <!-- "untrusted" label -->
  <text x="160" y="250" font-size="8.5" fill="#888" text-anchor="middle" font-style="italic">Untrusted execution environment</text>

  <!-- SECURE ENCLAVE — dashed thick boundary -->
  <rect x="50" y="264" width="434" height="124" rx="6" fill="#c8daf0" stroke="#4a90c4" stroke-width="2.5" stroke-dasharray="8,4"/>
  <text x="267" y="286" font-size="11" font-weight="700" fill="#1e4f7a" text-anchor="middle">Secure Enclave</text>
  <text x="267" y="298" font-size="8.5" fill="#3a6a99" text-anchor="middle" font-style="italic">Isolated, attested, encrypted — inaccessible to normal OS or hypervisor</text>
  <line x1="60" y1="304" x2="474" y2="304" stroke="#4a90c4" stroke-width="0.8"/>

  <!-- Enclave sub-components -->
  <!-- CPU Core -->
  <rect x="64" y="312" width="84" height="62" rx="4" fill="#fafafa" stroke="#4a90c4" stroke-width="1.3"/>
  <text x="106" y="336" font-size="9" font-weight="700" fill="#1e4f7a" text-anchor="middle">CPU Core</text>
  <text x="106" y="350" font-size="8" fill="#555" text-anchor="middle">Isolated exec.</text>
  <text x="106" y="362" font-size="8" fill="#555" text-anchor="middle">context</text>

  <!-- AES Engine -->
  <rect x="162" y="312" width="84" height="62" rx="4" fill="#fafafa" stroke="#4a90c4" stroke-width="1.3"/>
  <text x="204" y="336" font-size="9" font-weight="700" fill="#1e4f7a" text-anchor="middle">AES Engine</text>
  <text x="204" y="350" font-size="8" fill="#555" text-anchor="middle">HW-accel.</text>
  <text x="204" y="362" font-size="8" fill="#555" text-anchor="middle">encryption</text>

  <!-- TRNG -->
  <rect x="260" y="312" width="84" height="62" rx="4" fill="#fafafa" stroke="#4a90c4" stroke-width="1.3"/>
  <text x="302" y="336" font-size="9" font-weight="700" fill="#1e4f7a" text-anchor="middle">TRNG</text>
  <text x="302" y="350" font-size="8" fill="#555" text-anchor="middle">True Random</text>
  <text x="302" y="362" font-size="8" fill="#555" text-anchor="middle">Number Gen.</text>

  <!-- PKA -->
  <rect x="358" y="312" width="84" height="62" rx="4" fill="#fafafa" stroke="#4a90c4" stroke-width="1.3"/>
  <text x="400" y="336" font-size="9" font-weight="700" fill="#1e4f7a" text-anchor="middle">PKA</text>
  <text x="400" y="350" font-size="8" fill="#555" text-anchor="middle">Public Key</text>
  <text x="400" y="362" font-size="8" fill="#555" text-anchor="middle">Accelerator</text>

  <!-- External Memory (outside SoC) -->
  <rect x="546" y="130" width="108" height="80" rx="5" fill="#e0e0e0" stroke="#999" stroke-width="1.5"/>
  <text x="600" y="160" font-size="10" font-weight="600" fill="#666" text-anchor="middle">External</text>
  <text x="600" y="174" font-size="10" font-weight="600" fill="#666" text-anchor="middle">Memory</text>
  <text x="600" y="190" font-size="8.5" fill="#888" text-anchor="middle">(Flash / DRAM)</text>
  <text x="600" y="202" font-size="8.5" fill="#888" text-anchor="middle">Off-chip storage</text>

  <!-- Encrypted channel arrow: enclave → external memory -->
  <line x1="484" y1="340" x2="534" y2="200" stroke="#4a90c4" stroke-width="1.8" stroke-dasharray="5,3" marker-end="url(#arr-enc)"/>
  <line x1="534" y1="200" x2="544" y2="180" stroke="#4a90c4" stroke-width="1.8" stroke-dasharray="5,3" marker-end="url(#arr-enc)"/>

  <!-- Encrypted channel label -->
  <rect x="500" y="248" width="132" height="32" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="566" y="263" font-size="8.5" font-weight="700" fill="#c87b2a" text-anchor="middle">Encrypted + Authenticated</text>
  <text x="566" y="275" font-size="8" fill="#555" text-anchor="middle">channel (AES-GCM, MAC)</text>

  <!-- Isolation boundary label -->
  <text x="267" y="406" font-size="9" font-weight="700" fill="#4a90c4" text-anchor="middle">- - - Isolation boundary: hardware-enforced, OS cannot cross - - -</text>

  <!-- Legend -->
  <rect x="30" y="428" width="12" height="12" rx="2" fill="#c8daf0" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="48" y="439" font-size="9" fill="#555">Secure Enclave (hardware-enforced)</text>
  <rect x="240" y="428" width="12" height="12" rx="2" fill="#e0e0e0" stroke="#999" stroke-width="1"/>
  <text x="258" y="439" font-size="9" fill="#555">Untrusted region</text>
  <line x1="370" y1="434" x2="392" y2="434" stroke="#4a90c4" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="398" y="439" font-size="9" fill="#555">Encrypted channel</text>

  <!-- Bottom annotation -->
  <text x="340" y="456" font-size="9" fill="#999" text-anchor="middle" font-style="italic">The Secure Enclave provides hardware-rooted confidentiality and integrity even if the host OS is fully compromised.</text>
</svg>
