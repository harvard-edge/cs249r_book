<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arr" markerWidth="9" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <path d="M0,0 L9,3.5 L0,7 Z" fill="#333"/>
    </marker>
    <marker id="arr-blue" markerWidth="9" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <path d="M0,0 L9,3.5 L0,7 Z" fill="#4a90c4"/>
    </marker>
    <marker id="arr-green" markerWidth="9" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <path d="M0,0 L9,3.5 L0,7 Z" fill="#3d9e5a"/>
    </marker>
    <marker id="arr-orange" markerWidth="9" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <path d="M0,0 L9,3.5 L0,7 Z" fill="#c87b2a"/>
    </marker>
  </defs>

  <rect width="680" height="460" fill="#fff"/>

  <!-- Client A box -->
  <rect x="30" y="30" width="170" height="360" rx="6" fill="#fafafa" stroke="#4a90c4" stroke-width="1.5"/>
  <rect x="30" y="30" width="170" height="30" rx="6" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
  <rect x="30" y="46" width="170" height="14" fill="#cfe2f3"/>
  <text x="115" y="50" font-size="11" font-weight="700" fill="#1a5a8a" text-anchor="middle">Client A</text>

  <!-- Client A weights -->
  <rect x="50" y="82" width="130" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1"/>
  <text x="115" y="97" font-size="9" fill="#1a5a8a" text-anchor="middle" font-weight="600">Model weights</text>
  <text x="115" y="111" font-size="10" fill="#1a5a8a" text-anchor="middle" font-family="monospace">w_A</text>

  <!-- Random mask r -->
  <rect x="50" y="140" width="130" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="115" y="155" font-size="9" fill="#1a6a3a" text-anchor="middle" font-weight="600">Random mask</text>
  <text x="115" y="169" font-size="10" fill="#1a6a3a" text-anchor="middle" font-family="monospace">r (shared secret)</text>

  <!-- Plus operation -->
  <text x="115" y="200" font-size="20" fill="#4a90c4" text-anchor="middle">+</text>

  <!-- Result: w_A + r -->
  <rect x="50" y="212" width="130" height="36" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.5"/>
  <text x="115" y="227" font-size="9" fill="#1a5a8a" text-anchor="middle" font-weight="600">Masked update</text>
  <text x="115" y="241" font-size="10" fill="#1a5a8a" text-anchor="middle" font-family="monospace">w_A + r</text>

  <!-- Arrow from client A to server -->
  <line x1="200" y1="230" x2="280" y2="230" stroke="#4a90c4" stroke-width="2" marker-end="url(#arr-blue)"/>
  <text x="240" y="222" font-size="8.5" fill="#4a90c4" text-anchor="middle" font-weight="600">sends</text>
  <text x="240" y="244" font-size="8.5" fill="#4a90c4" text-anchor="middle" font-family="monospace">w_A + r</text>

  <!-- Privacy annotation for A -->
  <rect x="50" y="272" width="130" height="44" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="0.8"/>
  <text x="115" y="289" font-size="8" fill="#a31f34" text-anchor="middle" font-weight="600">Server sees only</text>
  <text x="115" y="302" font-size="8" fill="#a31f34" text-anchor="middle" font-family="monospace">w_A + r</text>
  <text x="115" y="314" font-size="7.5" fill="#a31f34" text-anchor="middle">Not w_A alone</text>

  <!-- Client B box -->
  <rect x="480" y="30" width="170" height="360" rx="6" fill="#fafafa" stroke="#c87b2a" stroke-width="1.5"/>
  <rect x="480" y="30" width="170" height="30" rx="6" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <rect x="480" y="46" width="170" height="14" fill="#fdebd0"/>
  <text x="565" y="50" font-size="11" font-weight="700" fill="#7a4a10" text-anchor="middle">Client B</text>

  <!-- Client B weights -->
  <rect x="500" y="82" width="130" height="36" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1"/>
  <text x="565" y="97" font-size="9" fill="#7a4a10" text-anchor="middle" font-weight="600">Model weights</text>
  <text x="565" y="111" font-size="10" fill="#7a4a10" text-anchor="middle" font-family="monospace">w_B</text>

  <!-- Same mask r -->
  <rect x="500" y="140" width="130" height="36" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1"/>
  <text x="565" y="155" font-size="9" fill="#1a6a3a" text-anchor="middle" font-weight="600">Same random mask</text>
  <text x="565" y="169" font-size="10" fill="#1a6a3a" text-anchor="middle" font-family="monospace">r (shared secret)</text>

  <!-- Minus operation -->
  <text x="565" y="200" font-size="20" fill="#c87b2a" text-anchor="middle">–</text>

  <!-- Result: w_B - r -->
  <rect x="500" y="212" width="130" height="36" rx="4" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.5"/>
  <text x="565" y="227" font-size="9" fill="#7a4a10" text-anchor="middle" font-weight="600">Masked update</text>
  <text x="565" y="241" font-size="10" fill="#7a4a10" text-anchor="middle" font-family="monospace">w_B – r</text>

  <!-- Arrow from client B to server -->
  <line x1="480" y1="230" x2="400" y2="230" stroke="#c87b2a" stroke-width="2" marker-end="url(#arr-orange)"/>
  <text x="440" y="222" font-size="8.5" fill="#c87b2a" text-anchor="middle" font-weight="600">sends</text>
  <text x="440" y="244" font-size="8.5" fill="#c87b2a" text-anchor="middle" font-family="monospace">w_B – r</text>

  <!-- Privacy annotation for B -->
  <rect x="500" y="272" width="130" height="44" rx="3" fill="#f9d6d5" stroke="#c44" stroke-width="0.8"/>
  <text x="565" y="289" font-size="8" fill="#a31f34" text-anchor="middle" font-weight="600">Server sees only</text>
  <text x="565" y="302" font-size="8" fill="#a31f34" text-anchor="middle" font-family="monospace">w_B – r</text>
  <text x="565" y="314" font-size="7.5" fill="#a31f34" text-anchor="middle">Not w_B alone</text>

  <!-- Server box (center) -->
  <rect x="290" y="80" width="100" height="200" rx="6" fill="#fafafa" stroke="#999" stroke-width="1.5"/>
  <rect x="290" y="80" width="100" height="28" rx="6" fill="#e0e0e0" stroke="#999" stroke-width="1.5"/>
  <rect x="290" y="96" width="100" height="12" fill="#e0e0e0"/>
  <text x="340" y="98" font-size="9.5" font-weight="700" fill="#444" text-anchor="middle">Server</text>

  <!-- Server receives both -->
  <rect x="302" y="124" width="76" height="28" rx="3" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
  <text x="340" y="137" font-size="8" fill="#1a5a8a" text-anchor="middle" font-family="monospace">w_A + r</text>

  <rect x="302" y="164" width="76" height="28" rx="3" fill="#fdebd0" stroke="#c87b2a" stroke-width="0.8"/>
  <text x="340" y="177" font-size="8" fill="#7a4a10" text-anchor="middle" font-family="monospace">w_B – r</text>

  <!-- Sum symbol -->
  <text x="340" y="210" font-size="16" fill="#333" text-anchor="middle">Σ</text>

  <!-- Aggregated result -->
  <rect x="302" y="224" width="76" height="28" rx="3" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="340" y="237" font-size="7.5" fill="#1a6a3a" text-anchor="middle" font-weight="600" font-family="monospace">w_A + w_B</text>
  <text x="340" y="249" font-size="7" fill="#3d9e5a" text-anchor="middle">(masks cancel)</text>

  <!-- Algebraic proof box -->
  <rect x="220" y="300" width="240" height="80" rx="5" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="340" y="318" font-size="9" font-weight="700" fill="#1a6a3a" text-anchor="middle">Mask Cancellation</text>
  <text x="340" y="334" font-size="9" fill="#333" text-anchor="middle" font-family="monospace">(w_A + r) + (w_B – r)</text>
  <text x="340" y="350" font-size="9" fill="#333" text-anchor="middle" font-family="monospace">= w_A + w_B + (r – r)</text>
  <text x="340" y="366" font-size="9" fill="#1a6a3a" text-anchor="middle" font-weight="700" font-family="monospace">= w_A + w_B ✓</text>

  <!-- Privacy guarantee box -->
  <rect x="180" y="400" width="320" height="44" rx="5" fill="#f9d6d5" stroke="#c44" stroke-width="1"/>
  <text x="340" y="418" font-size="9" font-weight="700" fill="#a31f34" text-anchor="middle">Individual contributions hidden from server</text>
  <text x="340" y="434" font-size="8.5" fill="#c44" text-anchor="middle">Server learns only the aggregate w_A + w_B, not individual w_A or w_B</text>

  <!-- Arrow server to result -->
  <line x1="340" y1="280" x2="340" y2="298" stroke="#3d9e5a" stroke-width="1.5" marker-end="url(#arr-green)"/>

  <!-- Shared mask label -->
  <text x="340" y="72" font-size="8.5" fill="#3d9e5a" text-anchor="middle" font-style="italic">Clients agree on shared random mask r via key agreement protocol</text>
</svg>
