<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3d9e5a"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#a31f34"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="460" fill="white"/>

  <!-- START NODE: "Training is slow" -->
  <rect x="248" y="12" width="184" height="34" rx="17" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="340" y="34" text-anchor="middle" font-size="11" font-weight="700" fill="#333">Training is slow</text>

  <!-- Arrow down -->
  <line x1="340" y1="46" x2="340" y2="66" stroke="#555" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- DECISION 1: GPU utilization < 70%? -->
  <polygon points="340,68 430,98 340,128 250,98" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="340" y="95" text-anchor="middle" font-size="10" font-weight="700" fill="#333">GPU util &lt; 70%?</text>
  <text x="340" y="107" text-anchor="middle" font-size="9" fill="#555">(Nsight / nvidia-smi)</text>

  <!-- YES branch right from Decision 1 -->
  <line x1="430" y1="98" x2="468" y2="98" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <text x="449" y="92" font-size="9" fill="#3d9e5a" font-weight="700">Yes</text>

  <!-- DECISION 2: I/O bound? -->
  <polygon points="555,68 625,98 555,128 485,98" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="555" y="95" text-anchor="middle" font-size="10" font-weight="700" fill="#333">I/O bound?</text>
  <text x="555" y="107" text-anchor="middle" font-size="9" fill="#555">(DataLoader stall)</text>

  <!-- YES from Decision 2 right -->
  <line x1="625" y1="98" x2="625" y2="138" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <text x="633" y="118" font-size="9" fill="#3d9e5a" font-weight="700">Yes</text>

  <!-- ACTION: Increase DataLoader workers / GDS -->
  <rect x="560" y="140" width="130" height="42" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="625" y="157" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">More DL workers</text>
  <text x="625" y="170" text-anchor="middle" font-size="9" fill="#555">Use GDS / NVMe</text>

  <!-- NO from Decision 2 down -->
  <line x1="555" y1="128" x2="555" y2="168" stroke="#a31f34" stroke-width="1.2" marker-end="url(#arrow-red)"/>
  <text x="540" y="148" font-size="9" fill="#a31f34" font-weight="700">No</text>

  <!-- DECISION 3: CPU bound? -->
  <polygon points="555,170 625,200 555,230 485,200" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="555" y="197" text-anchor="middle" font-size="10" font-weight="700" fill="#333">CPU bound?</text>
  <text x="555" y="209" text-anchor="middle" font-size="9" fill="#555">(preprocessing)</text>

  <!-- YES from Decision 3 right -->
  <line x1="625" y1="200" x2="625" y2="240" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <text x="633" y="220" font-size="9" fill="#3d9e5a" font-weight="700">Yes</text>

  <!-- ACTION: Offload preprocessing -->
  <rect x="560" y="242" width="130" height="42" rx="4" fill="#d4edda" stroke="#3d9e5a" stroke-width="1.2"/>
  <text x="625" y="259" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Offload to GPU</text>
  <text x="625" y="272" text-anchor="middle" font-size="9" fill="#555">DALI / async preproc</text>

  <!-- NO from Decision 3 down -->
  <line x1="555" y1="230" x2="555" y2="300" stroke="#a31f34" stroke-width="1.2" marker-end="url(#arrow-red)"/>
  <text x="540" y="265" font-size="9" fill="#a31f34" font-weight="700">No</text>

  <!-- ACTION: Communication overhead -->
  <rect x="490" y="302" width="130" height="42" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="555" y="319" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Comm overhead</text>
  <text x="555" y="332" text-anchor="middle" font-size="9" fill="#555">Overlap / compress</text>

  <!-- NO branch down from Decision 1 -->
  <line x1="340" y1="128" x2="340" y2="168" stroke="#a31f34" stroke-width="1.2" marker-end="url(#arrow-red)"/>
  <text x="325" y="148" font-size="9" fill="#a31f34" font-weight="700">No</text>

  <!-- DECISION 4: Arithmetic Intensity > Ridge? -->
  <polygon points="340,170 430,200 340,230 250,200" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
  <text x="340" y="197" text-anchor="middle" font-size="10" font-weight="700" fill="#333">AI &gt; ridge point?</text>
  <text x="340" y="209" text-anchor="middle" font-size="9" fill="#555">(Roofline analysis)</text>

  <!-- YES from Decision 4: Compute-bound path left -->
  <line x1="250" y1="200" x2="195" y2="200" stroke="#3d9e5a" stroke-width="1.2" marker-end="url(#arrow-green)"/>
  <text x="222" y="194" font-size="9" fill="#3d9e5a" font-weight="700">Yes</text>

  <!-- LABEL: COMPUTE BOUND -->
  <rect x="30" y="184" width="164" height="32" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="112" y="205" text-anchor="middle" font-size="11" font-weight="700" fill="#4a90c4">COMPUTE BOUND</text>

  <!-- Arrow down to actions -->
  <line x1="112" y1="216" x2="112" y2="240" stroke="#555" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ACTION: Precision engineering -->
  <rect x="22" y="242" width="100" height="42" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="72" y="259" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">FP8 / INT4</text>
  <text x="72" y="272" text-anchor="middle" font-size="9" fill="#555">Precision eng.</text>

  <!-- ACTION: Algorithmic -->
  <rect x="132" y="242" width="100" height="42" rx="4" fill="#cfe2f3" stroke="#4a90c4" stroke-width="1.2"/>
  <text x="182" y="259" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">MoE / Specul.</text>
  <text x="182" y="272" text-anchor="middle" font-size="9" fill="#555">Algorithmic opt.</text>

  <!-- NO from Decision 4: Memory-bound path down -->
  <line x1="340" y1="230" x2="340" y2="270" stroke="#a31f34" stroke-width="1.2" marker-end="url(#arrow-red)"/>
  <text x="325" y="250" font-size="9" fill="#a31f34" font-weight="700">No</text>

  <!-- LABEL: MEMORY BOUND -->
  <rect x="258" y="272" width="164" height="32" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="340" y="293" text-anchor="middle" font-size="11" font-weight="700" fill="#c44">MEMORY BOUND</text>

  <!-- Arrow down to actions -->
  <line x1="340" y1="304" x2="340" y2="328" stroke="#555" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ACTION: Operator fusion -->
  <rect x="250" y="330" width="100" height="42" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="300" y="347" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">Operator fusion</text>
  <text x="300" y="360" text-anchor="middle" font-size="9" fill="#555">FlashAttention</text>

  <!-- ACTION: Tiling / torch.compile -->
  <rect x="360" y="330" width="100" height="42" rx="4" fill="#f9d6d5" stroke="#c44" stroke-width="1.2"/>
  <text x="410" y="347" text-anchor="middle" font-size="9.5" font-weight="700" fill="#333">torch.compile</text>
  <text x="410" y="360" text-anchor="middle" font-size="9" fill="#555">Graph compilation</text>

  <!-- Re-profile loop -->
  <rect x="248" y="406" width="184" height="30" rx="15" fill="#f7f7f7" stroke="#bbb" stroke-width="1.2"/>
  <text x="340" y="425" text-anchor="middle" font-size="10" font-weight="700" fill="#333">Re-profile</text>

  <!-- Arrows into re-profile -->
  <line x1="300" y1="372" x2="300" y2="406" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="410" y1="372" x2="410" y2="393" stroke="#555" stroke-width="1"/>
  <line x1="410" y1="393" x2="340" y2="393" stroke="#555" stroke-width="1"/>
  <line x1="340" y1="393" x2="340" y2="406" stroke="#555" stroke-width="1" marker-end="url(#arrow)"/>

  <line x1="72" y1="284" x2="72" y2="393" stroke="#555" stroke-width="1"/>
  <line x1="72" y1="393" x2="248" y2="393" stroke="#555" stroke-width="1"/>
  <line x1="182" y1="284" x2="182" y2="388" stroke="#555" stroke-width="1"/>
  <line x1="182" y1="388" x2="248" y2="388" stroke="#555" stroke-width="1"/>

  <line x1="555" y1="344" x2="555" y2="393" stroke="#555" stroke-width="1"/>
  <line x1="555" y1="393" x2="432" y2="393" stroke="#555" stroke-width="1"/>

  <line x1="625" y1="182" x2="660" y2="182" stroke="#555" stroke-width="1"/>
  <line x1="660" y1="182" x2="660" y2="440" stroke="#555" stroke-width="1"/>
  <line x1="660" y1="440" x2="340" y2="440" stroke="#555" stroke-width="1"/>
  <line x1="340" y1="436" x2="340" y2="440" stroke="#555" stroke-width="1"/>

  <line x1="625" y1="284" x2="650" y2="284" stroke="#555" stroke-width="1"/>
  <line x1="650" y1="284" x2="650" y2="440" stroke="#555" stroke-width="1"/>

  <!-- Dashed loop back arrow -->
  <path d="M 248,421 Q 20,421 20,34 Q 20,14 248,27" fill="none" stroke="#999" stroke-width="1" stroke-dasharray="5,3" marker-end="url(#arrow)"/>
  <text x="10" y="230" font-size="9" fill="#999" font-style="italic" transform="rotate(-90, 10, 230)">iterate until target met</text>

</svg>
