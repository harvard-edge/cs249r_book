<?xml version="1.0" encoding="UTF-8"?>
<!--
  Roofline Model: attainable performance vs. arithmetic intensity (log-log)
  Shows H100 roofline with realistic workload points.
  Vol 2 textbook figure — no title (provided by QMD fig-cap).

  Hardware basis (H100 SXM5):
    Peak FP16 Tensor: ~2,000 TFLOPS (flat roof)
    HBM3 bandwidth:   ~3,350 GB/s  (slope)
    Ridge point:      2000/3.35 ≈ 597 FLOP/Byte ≈ log10(597)=2.776
-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 420" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <style>
      .axis       { stroke: #333; stroke-width: 1.2; fill: none; }
      .grid       { stroke: #e8e8e8; stroke-width: 0.8; }
      .tick-label { font-size: 9.5px; fill: #555; text-anchor: middle; }
      .y-label    { font-size: 9.5px; fill: #555; text-anchor: end; }
      .axis-title { font-size: 11px; fill: #333; font-weight: 600; }
      .roofline   { fill: none; stroke: #a31f34; stroke-width: 2.5; stroke-linejoin: round; }
      .region-mem { fill: rgba(0,99,149,0.06); }
      .region-cmp { fill: rgba(163,31,52,0.04); }
      .region-lbl { font-size: 9px; font-weight: 600; letter-spacing: 0.4px; }
      .workload   { stroke: white; stroke-width: 1.5; }
      .annot      { font-size: 9px; fill: #555; }
      .annot-bold { font-size: 9px; fill: #333; font-weight: 700; }
      .ridge-line { stroke: #888; stroke-width: 1; stroke-dasharray: 4,3; }
      .bw-label   { font-size: 8.5px; fill: #006395; font-style: italic; }
    </style>
    <marker id="arr" markerWidth="8" markerHeight="7" refX="7" refY="3.5" orient="auto">
      <polygon points="0 0, 8 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!--
    Chart area: x=80..590, y=55..340
    X axis (log scale): FLOP/Byte  1/8 → 1024
      log10(0.125)=-0.903  → x=80
      log10(1024) =3.01    → x=590
      span = 510px for 3.913 decades → 130.3 px/decade
      x(v) = 80 + (log10(v) - (-0.903)) * 130.3

    Y axis (log scale): TFLOPS  0.1 → 4000
      log10(0.1)=-1  → y=340
      log10(4000)=3.602 → y=55
      span = 285px for 4.602 decades → 61.93 px/decade
      y(v) = 340 - (log10(v) - (-1)) * 61.93

    Ridge point: 597 FLOP/Byte, 2000 TFLOPS
      xR = 80 + (2.776+0.903)*130.3 = 80 + 479.5 = 559 ... clamp to 558
      yR = 340 - (3.301+1)*61.93 = 340 - 266.5 = 73.5

    Memory slope line: from (0.125, 0.418) to (597, 2000)
      (0.125 FLOP/Byte × 3.35 TB/s = 0.418 TFLOPS)
      x0 = 80, y0 = 340 - (-0.622+1)*61.93 = 340 - 23.4 = 316.6
      x1 = 558, y1 = 74

    Flat compute roof: from (597, 2000) to (1024, 2000)
      x = 558 to 590, y = 74
  -->

  <!-- ── Regions ─────────────────────────────────── -->
  <!-- Memory-bound region (left of ridge) -->
  <polygon points="80,316 558,74 558,340 80,340" class="region-mem" />
  <!-- Compute-bound region (right of ridge) -->
  <polygon points="558,74 590,74 590,340 558,340" class="region-cmp" />

  <!-- ── Grid lines (Y: 0.1, 1, 10, 100, 1000, 4000) ── -->
  <!-- y(0.1)=340, y(1)=278.1, y(10)=216.1, y(100)=154.1, y(1000)=92.1, clamp 4000=74 -->
  <line x1="80" y1="278" x2="590" y2="278" class="grid" />
  <line x1="80" y1="216" x2="590" y2="216" class="grid" />
  <line x1="80" y1="154" x2="590" y2="154" class="grid" />
  <line x1="80" y1="92"  x2="590" y2="92"  class="grid" />

  <!-- Grid lines (X: 0.125, 1, 8, 64, 512) -->
  <!-- x(0.125)=80, x(1)=198, x(8)=315, x(64)=433, x(512)=558 -->
  <line x1="198" y1="55" x2="198" y2="340" class="grid" />
  <line x1="315" y1="55" x2="315" y2="340" class="grid" />
  <line x1="433" y1="55" x2="433" y2="340" class="grid" />
  <line x1="558" y1="55" x2="558" y2="340" class="grid" />

  <!-- ── Roofline (memory slope + compute flat) ── -->
  <polyline points="80,317 558,74 590,74" class="roofline" />

  <!-- ── Ridge point ── -->
  <circle cx="558" cy="74" r="5" fill="#a31f34" stroke="white" stroke-width="1.5" />
  <!-- vertical dashed drop -->
  <line x1="558" y1="74" x2="558" y2="340" class="ridge-line" />
  <text x="558" y="352" class="tick-label" fill="#888">~600</text>

  <!-- ── Axes ── -->
  <line x1="80" y1="340" x2="595" y2="340" class="axis" marker-end="url(#arr)" />
  <line x1="80" y1="340" x2="80"  y2="50"  class="axis" marker-end="url(#arr)" />

  <!-- ── X ticks & labels (FLOP/Byte) ── -->
  <!-- 1/8, 1, 8, 64, 512 -->
  <line x1="80"  y1="340" x2="80"  y2="345" stroke="#333" stroke-width="1" />
  <line x1="198" y1="340" x2="198" y2="345" stroke="#333" stroke-width="1" />
  <line x1="315" y1="340" x2="315" y2="345" stroke="#333" stroke-width="1" />
  <line x1="433" y1="340" x2="433" y2="345" stroke="#333" stroke-width="1" />
  <line x1="558" y1="340" x2="558" y2="345" stroke="#333" stroke-width="1" />

  <text x="80"  y="356" class="tick-label">⅛</text>
  <text x="198" y="356" class="tick-label">1</text>
  <text x="315" y="356" class="tick-label">8</text>
  <text x="433" y="356" class="tick-label">64</text>
  <text x="558" y="356" class="tick-label">512</text>

  <!-- ── Y ticks & labels (TFLOPS) ── -->
  <line x1="80" y1="340" x2="75" y2="340" stroke="#333" stroke-width="1" />
  <line x1="80" y1="278" x2="75" y2="278" stroke="#333" stroke-width="1" />
  <line x1="80" y1="216" x2="75" y2="216" stroke="#333" stroke-width="1" />
  <line x1="80" y1="154" x2="75" y2="154" stroke="#333" stroke-width="1" />
  <line x1="80" y1="92"  x2="75" y2="92"  stroke="#333" stroke-width="1" />
  <line x1="80" y1="74"  x2="75" y2="74"  stroke="#333" stroke-width="1" />

  <text x="72" y="344" class="y-label">0.1</text>
  <text x="72" y="282" class="y-label">1</text>
  <text x="72" y="220" class="y-label">10</text>
  <text x="72" y="158" class="y-label">100</text>
  <text x="72" y="96"  class="y-label">1,000</text>
  <text x="72" y="78"  class="y-label">2,000</text>

  <!-- ── Axis titles ── -->
  <text x="338" y="378" class="axis-title" text-anchor="middle">Arithmetic Intensity  (FLOP / Byte)  →  log scale</text>
  <text x="22" y="198" class="axis-title" text-anchor="middle" transform="rotate(-90,22,198)">Attainable Performance (TFLOPS) — log</text>

  <!-- ── Region labels ── -->
  <text x="200" y="72" class="region-lbl" fill="#006395" text-anchor="middle" letter-spacing="0.5">MEMORY-BOUND</text>
  <text x="574" y="170" class="region-lbl" fill="#a31f34" text-anchor="middle" transform="rotate(90,574,170)" letter-spacing="0.5">COMPUTE-BOUND</text>

  <!-- Slope label (bandwidth) -->
  <text x="224" y="196" class="bw-label" transform="rotate(-29,224,196)">slope = 3.35 TB/s (HBM3)</text>

  <!-- Roof label -->
  <text x="520" y="68" font-size="9" fill="#a31f34" text-anchor="middle" font-weight="700">2,000 TFLOPS (FP16)</text>

  <!-- ── Workload points ── -->
  <!--
    Realistic arithmetic intensities (log-scale x positions):
    Decode (B=1):      ~1 F/B   → x=198, y~=278+
    Prefill (B=32):    ~10 F/B  → x=315, y~=200
    Conv train:        ~100 F/B → x=433, y~=138
    Dense transformer: ~300 F/B → x=510, y~=90
  -->

  <!-- Workload: Autoregressive Decode (batch=1) — memory-bound -->
  <!-- ~0.7 TFLOPS actual → y=340-(log10(0.7)+1)*61.93=340-8.8=331... let's say ~5 TFLOPS on modern HW → y=281 -->
  <circle cx="178" cy="290" r="5" fill="#006395" class="workload" />
  <line x1="178" y1="290" x2="178" y2="316" stroke="#006395" stroke-width="1" stroke-dasharray="3,2" />
  <text x="145" y="278" class="annot-bold" fill="#006395">Decode</text>
  <text x="145" y="289" class="annot" fill="#006395">(batch=1)</text>

  <!-- Workload: LLM Prefill (long prompt) — moderate AI ~8 F/B -->
  <circle cx="308" cy="210" r="5" fill="#006395" class="workload" />
  <line x1="308" y1="210" x2="308" y2="227" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
  <text x="318" y="208" class="annot-bold">Prefill</text>
  <text x="318" y="219" class="annot">(long prompt)</text>

  <!-- Workload: Transformer Training (batch=512) — ~30–80 F/B → x≈400, y≈158 -->
  <circle cx="395" cy="158" r="5" fill="#555" class="workload" />
  <text x="405" y="156" class="annot-bold">Transformer</text>
  <text x="405" y="167" class="annot">training (B=512)</text>

  <!-- Workload: Convolution (ResNet, high AI) — ~200 F/B → x≈488, y≈95 -->
  <circle cx="510" cy="96" r="5" fill="#c87b2a" class="workload" />
  <text x="515" y="90" class="annot-bold" fill="#c87b2a">Conv. training</text>
  <text x="515" y="101" class="annot" fill="#c87b2a">(ResNet)</text>

  <!-- ── Ridge point label ── -->
  <text x="563" y="70" font-size="8.5" fill="#333">Ridge ≈ 600 F/B</text>

  <!-- ── Efficiency gap annotations ── -->
  <!-- Arrow showing gap for Decode workload -->
  <line x1="178" y1="292" x2="178" y2="315" stroke="#ccc" stroke-width="1" />
  <text x="135" y="310" font-size="8" fill="#999" font-style="italic">peak ≫ actual</text>

  <!-- ── Bottom note ── -->
  <text x="338" y="400" font-size="9" fill="#999" text-anchor="middle" font-style="italic">
    H100 SXM5 reference: 3.35 TB/s HBM3 bandwidth · 2,000 TFLOPS FP16 Tensor Core
  </text>
</svg>
