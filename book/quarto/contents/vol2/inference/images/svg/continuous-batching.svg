<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 460" font-family="Helvetica Neue, Helvetica, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5 Z" fill="#333"/>
    </marker>
  </defs>

  <!-- ====== Top: Static Batching (Contrast) ====== -->
  <text x="24" y="18" font-size="12" font-weight="700" fill="#333">Static Batching</text>
  <text x="200" y="18" font-size="9" fill="#555">(all requests wait for the longest)</text>

  <!-- Y axis labels (request slots) -->
  <g transform="translate(24, 30)">
    <text x="46" y="16" text-anchor="end" font-size="9.5" fill="#555">R1</text>
    <text x="46" y="42" text-anchor="end" font-size="9.5" fill="#555">R2</text>
    <text x="46" y="68" text-anchor="end" font-size="9.5" fill="#555">R3</text>
    <text x="46" y="94" text-anchor="end" font-size="9.5" fill="#555">R4</text>
  </g>

  <!-- Grid and cells (iteration steps = columns) -->
  <!-- Cell size: 44w x 24h -->
  <g transform="translate(80, 32)">
    <!-- Iteration labels -->
    <text x="22" y="-4" text-anchor="middle" font-size="8" fill="#555">i1</text>
    <text x="66" y="-4" text-anchor="middle" font-size="8" fill="#555">i2</text>
    <text x="110" y="-4" text-anchor="middle" font-size="8" fill="#555">i3</text>
    <text x="154" y="-4" text-anchor="middle" font-size="8" fill="#555">i4</text>
    <text x="198" y="-4" text-anchor="middle" font-size="8" fill="#555">i5</text>
    <text x="242" y="-4" text-anchor="middle" font-size="8" fill="#555">i6</text>
    <text x="286" y="-4" text-anchor="middle" font-size="8" fill="#555">i7</text>
    <text x="330" y="-4" text-anchor="middle" font-size="8" fill="#555">i8</text>

    <!-- R1: active 3 steps, then wasted 5 steps -->
    <rect x="0" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="44" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="88" y="2" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="110" y="17" text-anchor="middle" font-size="7.5" fill="#3d9e5a">done</text>
    <rect x="132" y="2" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="176" y="2" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="220" y="2" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="264" y="2" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="308" y="2" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>

    <!-- R2: active all 8 steps (longest) -->
    <rect x="0" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="44" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="88" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="132" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="176" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="220" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="264" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="308" y="28" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="330" y="43" text-anchor="middle" font-size="7.5" fill="#3d9e5a">done</text>

    <!-- R3: active 5 steps, then wasted 3 -->
    <rect x="0" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="44" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="88" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="132" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="176" y="54" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="198" y="69" text-anchor="middle" font-size="7.5" fill="#3d9e5a">done</text>
    <rect x="220" y="54" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="264" y="54" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="308" y="54" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>

    <!-- R4: active 4 steps, then wasted 4 -->
    <rect x="0" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="44" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="88" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <rect x="132" y="80" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="154" y="95" text-anchor="middle" font-size="7.5" fill="#3d9e5a">done</text>
    <rect x="176" y="80" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="220" y="80" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="264" y="80" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="308" y="80" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>

    <!-- Wasted cells annotation -->
    <text x="400" y="62" font-size="9" font-weight="600" fill="#a31f34">37.5% wasted</text>
    <text x="400" y="76" font-size="8.5" fill="#555">15 of 32 cells idle</text>
  </g>

  <!-- Divider -->
  <line x1="24" y1="148" x2="656" y2="148" stroke="#bbb" stroke-width="0.8" stroke-dasharray="6,3"/>

  <!-- ====== Bottom: Continuous Batching ====== -->
  <text x="24" y="170" font-size="12" font-weight="700" fill="#333">Continuous Batching</text>
  <text x="230" y="170" font-size="9" fill="#555">(iteration-level scheduling; R5 joins when R1 finishes)</text>

  <!-- Y axis labels -->
  <g transform="translate(24, 182)">
    <text x="46" y="16" text-anchor="end" font-size="9.5" fill="#555">Slot 1</text>
    <text x="46" y="42" text-anchor="end" font-size="9.5" fill="#555">Slot 2</text>
    <text x="46" y="68" text-anchor="end" font-size="9.5" fill="#555">Slot 3</text>
    <text x="46" y="94" text-anchor="end" font-size="9.5" fill="#555">Slot 4</text>
    <text x="46" y="120" text-anchor="end" font-size="9.5" fill="#555">Slot 5</text>
    <text x="46" y="146" text-anchor="end" font-size="9.5" fill="#555">Slot 6</text>
  </g>

  <g transform="translate(80, 184)">
    <!-- Iteration labels -->
    <text x="22" y="-4" text-anchor="middle" font-size="8" fill="#555">i1</text>
    <text x="66" y="-4" text-anchor="middle" font-size="8" fill="#555">i2</text>
    <text x="110" y="-4" text-anchor="middle" font-size="8" fill="#555">i3</text>
    <text x="154" y="-4" text-anchor="middle" font-size="8" fill="#555">i4</text>
    <text x="198" y="-4" text-anchor="middle" font-size="8" fill="#555">i5</text>
    <text x="242" y="-4" text-anchor="middle" font-size="8" fill="#555">i6</text>
    <text x="286" y="-4" text-anchor="middle" font-size="8" fill="#555">i7</text>
    <text x="330" y="-4" text-anchor="middle" font-size="8" fill="#555">i8</text>
    <text x="374" y="-4" text-anchor="middle" font-size="8" fill="#555">i9</text>
    <text x="418" y="-4" text-anchor="middle" font-size="8" fill="#555">i10</text>

    <!-- Slot 1: R1 for 3 steps, then R5 joins immediately -->
    <rect x="0" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="22" y="16" text-anchor="middle" font-size="8" fill="#333">R1</text>
    <rect x="44" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="66" y="16" text-anchor="middle" font-size="8" fill="#333">R1</text>
    <rect x="88" y="2" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="110" y="16" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R1 done</text>
    <!-- R5 joins slot 1 at i4 (orange = newly joined) -->
    <rect x="132" y="2" width="44" height="22" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
    <text x="154" y="16" text-anchor="middle" font-size="8" font-weight="700" fill="#c87b2a">R5</text>
    <rect x="176" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="198" y="16" text-anchor="middle" font-size="8" fill="#333">R5</text>
    <rect x="220" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="242" y="16" text-anchor="middle" font-size="8" fill="#333">R5</text>
    <rect x="264" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="286" y="16" text-anchor="middle" font-size="8" fill="#333">R5</text>
    <rect x="308" y="2" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="330" y="16" text-anchor="middle" font-size="8" fill="#333">R5</text>
    <rect x="352" y="2" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="374" y="16" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R5 done</text>

    <!-- Slot 2: R2 full duration (8 steps) -->
    <rect x="0" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="22" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="44" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="66" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="88" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="110" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="132" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="154" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="176" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="198" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="220" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="242" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="264" y="28" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="286" y="42" text-anchor="middle" font-size="8" fill="#333">R2</text>
    <rect x="308" y="28" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="330" y="42" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R2 done</text>

    <!-- Slot 3: R3 5 steps, then R6 joins -->
    <rect x="0" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="22" y="68" text-anchor="middle" font-size="8" fill="#333">R3</text>
    <rect x="44" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="66" y="68" text-anchor="middle" font-size="8" fill="#333">R3</text>
    <rect x="88" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="110" y="68" text-anchor="middle" font-size="8" fill="#333">R3</text>
    <rect x="132" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="154" y="68" text-anchor="middle" font-size="8" fill="#333">R3</text>
    <rect x="176" y="54" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="198" y="68" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R3 done</text>
    <!-- R6 joins -->
    <rect x="220" y="54" width="44" height="22" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
    <text x="242" y="68" text-anchor="middle" font-size="8" font-weight="700" fill="#c87b2a">R6</text>
    <rect x="264" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="286" y="68" text-anchor="middle" font-size="8" fill="#333">R6</text>
    <rect x="308" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="330" y="68" text-anchor="middle" font-size="8" fill="#333">R6</text>
    <rect x="352" y="54" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="374" y="68" text-anchor="middle" font-size="8" fill="#333">R6</text>
    <rect x="396" y="54" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="418" y="68" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R6 done</text>

    <!-- Slot 4: R4 4 steps, then R7 joins -->
    <rect x="0" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="22" y="94" text-anchor="middle" font-size="8" fill="#333">R4</text>
    <rect x="44" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="66" y="94" text-anchor="middle" font-size="8" fill="#333">R4</text>
    <rect x="88" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="110" y="94" text-anchor="middle" font-size="8" fill="#333">R4</text>
    <rect x="132" y="80" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="154" y="94" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R4 done</text>
    <!-- R7 joins -->
    <rect x="176" y="80" width="44" height="22" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
    <text x="198" y="94" text-anchor="middle" font-size="8" font-weight="700" fill="#c87b2a">R7</text>
    <rect x="220" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="242" y="94" text-anchor="middle" font-size="8" fill="#333">R7</text>
    <rect x="264" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="286" y="94" text-anchor="middle" font-size="8" fill="#333">R7</text>
    <rect x="308" y="80" width="44" height="22" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="330" y="94" text-anchor="middle" font-size="8" fill="#333">R7</text>
    <rect x="352" y="80" width="44" height="22" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="374" y="94" text-anchor="middle" font-size="7.5" fill="#3d9e5a">R7 done</text>

    <!-- Slot 5 (empty initially, used later) -->
    <rect x="0" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="44" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="88" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="132" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="176" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="220" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="264" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="308" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="352" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="396" y="106" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>

    <!-- Slot 6 (empty) -->
    <rect x="0" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="44" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="88" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="132" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="176" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="220" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="264" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="308" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="352" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <rect x="396" y="132" width="44" height="22" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>

    <!-- Annotation -->
    <text x="460" y="30" font-size="9" font-weight="600" fill="#3d9e5a">0% wasted</text>
    <text x="460" y="44" font-size="8.5" fill="#555">Freed slots immediately</text>
    <text x="460" y="58" font-size="8.5" fill="#555">reused by new requests</text>
  </g>

  <!-- Legend at bottom -->
  <g transform="translate(80, 420)">
    <rect x="0" y="0" width="20" height="12" rx="2" fill="#cfe2f3" stroke="#4a90c4" stroke-width="0.8"/>
    <text x="26" y="10" font-size="9" fill="#555">Active (decoding)</text>

    <rect x="130" y="0" width="20" height="12" rx="2" fill="#f7f7f7" stroke="#bbb" stroke-width="0.6" stroke-dasharray="2,2"/>
    <text x="156" y="10" font-size="9" fill="#555">Wasted (idle)</text>

    <rect x="240" y="0" width="20" height="12" rx="2" fill="#d4edda" stroke="#3d9e5a" stroke-width="0.8"/>
    <text x="266" y="10" font-size="9" fill="#555">Completed</text>

    <rect x="340" y="0" width="20" height="12" rx="2" fill="#fdebd0" stroke="#c87b2a" stroke-width="1.2"/>
    <text x="366" y="10" font-size="9" fill="#555">Newly joined</text>
  </g>

  <!-- X axis label -->
  <text x="340" y="450" text-anchor="middle" font-size="9" font-style="italic" fill="#999">Iteration steps (each column = one decode step across all active requests)</text>
</svg>
