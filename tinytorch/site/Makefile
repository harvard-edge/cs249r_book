# TinyTorch Book Build Makefile
# Convenient shortcuts for building HTML and PDF versions

.PHONY: help html pdf clean install test

help:
	@echo "TinyğŸ”¥Torch Build Commands"
	@echo "=========================="
	@echo ""
	@echo "  make html        - Build HTML version (website)"
	@echo "  make pdf         - Build PDF via LuaLaTeX"
	@echo "  make clean       - Remove all build artifacts"
	@echo "  make install     - Install Python dependencies"
	@echo "  make test        - Test build configuration"
	@echo ""

html:
	@echo "ğŸŒ Building HTML version..."
	@jupyter-book build .

pdf:
	@echo "ğŸ”¥ Building TinyğŸ”¥Torch PDF via LuaLaTeX..."
	@echo ""
	@# Check dependencies
	@command -v jupyter-book >/dev/null 2>&1 || { echo "âŒ Error: jupyter-book not installed. Run: pip install jupyter-book"; exit 1; }
	@command -v lualatex >/dev/null 2>&1 || { echo "âŒ Error: lualatex not found. Install TeX Live from https://www.tug.org/texlive/"; exit 1; }
	@echo "âœ… Dependencies OK"
	@echo ""
	@# Clean previous builds
	@echo "ğŸ§¹ Cleaning previous builds..."
	@jupyter-book clean . --all 2>/dev/null || true
	@echo ""
	@# Build PDF
	@echo "ğŸ“š Building LaTeX/PDF (this may take a few minutes)..."
	@echo "   Using LuaLaTeX engine with TinyğŸ”¥Torch branding"
	@jupyter-book build . --builder pdflatex --config _config_pdf.yml
	@# Check if build succeeded
	@if [ -f "_build/latex/tinytorch-course.pdf" ]; then \
		PDF_SIZE=$$(du -h "_build/latex/tinytorch-course.pdf" | cut -f1); \
		echo ""; \
		echo "âœ… PDF build complete!"; \
		echo "ğŸ“„ Output: _build/latex/tinytorch-course.pdf"; \
		echo "ğŸ“Š Size: $${PDF_SIZE}"; \
		echo ""; \
		echo "To view: open _build/latex/tinytorch-course.pdf"; \
	else \
		echo ""; \
		echo "âŒ PDF build failed - check errors above"; \
		echo "ğŸ“ Check _build/latex/tinytorch-course.log for details"; \
		exit 1; \
	fi

clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	jupyter-book clean . --all
	rm -rf _build/

install:
	@echo "ğŸ“¦ Installing dependencies..."
	pip install -U pip
	pip install "jupyter-book<1.0"
	pip install -r requirements.txt

test:
	@echo "ğŸ§ª Testing build configuration..."
	jupyter-book config sphinx .
	@echo "âœ… Configuration valid"

# Default target
.DEFAULT_GOAL := help

