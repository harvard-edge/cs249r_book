/*-- scss:defaults --*/

// Dark mode color overrides for Harvard Crimson Theme
// This file is applied when users toggle dark mode on the website

// Redefine crimson to be brighter for dark mode - this makes it universal
$crimson: #E85D75;  // Much lighter, vibrant crimson for dark backgrounds
$crimson-dark: $crimson;  // Alias for clarity in code

// Dark mode specific colors
$body-bg-dark: #1a1a1a;
$body-color-dark: #e6e6e6;
$link-color-dark: $crimson;  // Brighter crimson for dark backgrounds
$link-hover-color-dark: lighten($crimson, 10%);

// Sidebar and navigation
$sidebar-bg-dark: #212529;
$navbar-bg-dark: #212529;
$border-color-dark: #454d55;

/*-- scss:rules --*/

// Main body styling
body {
  background-color: $body-bg-dark;
  color: $body-color-dark;
}

// Links in dark mode - brighter crimson
a {
  color: $link-color-dark;
  
  &:hover {
    color: lighten($crimson, 20%) !important;  // Bright crimson on hover
    text-decoration: underline;
  }
  
  &:visited {
    color: lighten($crimson, 10%);
  }
}

// Content area
.content,
main,
article,
#quarto-content {
  background-color: $body-bg-dark;
  color: $body-color-dark;
}

// Sidebar - match TOC styling with muted colors - MAXIMUM SPECIFICITY
.sidebar,
.sidebar-navigation,
#quarto-sidebar,
.sidebar.sidebar-navigation {
  background-color: $sidebar-bg-dark;
  border-color: $border-color-dark;
  
  // Part dividers (PART I, PART II, etc.) - keep crimson
  .sidebar-item.sidebar-item-section > .sidebar-item-toggle,
  .sidebar-item.sidebar-item-section .sidebar-item-toggle,
  .part-divider {
    color: $crimson-dark !important;  // Bright crimson for part headers
    font-weight: 600;
  }
  
  // ALL navigation links - very muted gray
  a,
  .sidebar-link,
  .sidebar-item a,
  .sidebar-item-text,
  .menu-text,
  .chapter-number {
    color: #888888 !important;  // Muted gray for all text
    font-weight: 400 !important;
    
    &:hover {
      color: $crimson-dark !important;
      background-color: rgba($crimson-dark, 0.15) !important;
    }
    
    &.active,
    &[aria-current="page"] {
      color: $crimson-dark !important;
      background-color: rgba($crimson-dark, 0.2) !important;
      font-weight: 500 !important;
    }
  }
  
  // Section containers
  .sidebar-item-container,
  .sidebar-item,
  .sidebar-item-text {
    color: #888888 !important;
  }
}

// Additional high-specificity rules for stubborn elements
#quarto-sidebar .sidebar-menu a:not(.active),
#quarto-sidebar .sidebar-menu .sidebar-link:not(.active),
#quarto-sidebar .menu-text {
  color: #888888 !important;
}

// Ensure active/hover states work
#quarto-sidebar a.active,
#quarto-sidebar a[aria-current="page"],
#quarto-sidebar .sidebar-link.active {
  color: $crimson-dark !important;
}

// TOC (table of contents) - Right sidebar "On this page"
.table-of-contents,
#TOC,
.quarto-toc,
nav[role="doc-toc"],
.sidebar.toc-left,
div[role="doc-toc"] {
  background-color: transparent;
  border-left-color: $crimson-dark;  // Brighter crimson border
  
  // TOC title
  .toc-title,
  .sidebar-title,
  h2 {
    color: #e6e6e6 !important;
    border: none !important;
  }
  
  // All links in TOC - match sidebar muted level
  a,
  .nav-link {
    color: #888888 !important;  // Same muted gray as sidebar
    
    &:hover {
      color: $crimson-dark !important;
    }
  }
  
  .active,
  .nav-link.active {
    color: $crimson-dark !important;
    font-weight: 500 !important;
  }
  
  // Nested lists
  ul, ol {
    li {
      color: #888888;
      
      a {
        color: #888888 !important;
      }
    }
  }
}

// Headers - adjust border colors for dark mode
.content h2,
main h2,
article h2,
#quarto-content h2 {
  border-left-color: $crimson-dark;
  border-bottom-color: rgba($crimson-dark, 0.4);
  color: #e6e6e6;
}

.content h3,
main h3,
article h3,
#quarto-content h3 {
  border-left-color: $crimson-dark;
  border-bottom-color: rgba($crimson-dark, 0.35);
  color: #d0d0d0;
}

.content h4,
main h4,
article h4,
#quarto-content h4 {
  border-left-color: $crimson-dark;
  border-bottom-color: rgba($crimson-dark, 0.3);
  color: #c0c0c0;
}

.content h5,
main h5,
article h5,
#quarto-content h5 {
  border-left-color: $crimson-dark;
  border-bottom-color: rgba($crimson-dark, 0.25);
  color: #b0b0b0;
}

.content h6,
main h6,
article h6,
#quarto-content h6 {
  border-left-color: $crimson-dark;
  border-bottom-color: rgba($crimson-dark, 0.2);
  color: #a0a0a0;
}

// Tables - improved contrast for dark mode
table {
  background-color: #1a1a1a;
  
  th {
    background-color: #2c2c2c !important;
    border-bottom: 2px solid $crimson-dark !important;
    color: #f0f0f0 !important;
    font-weight: 600;
  }
  
  td {
    background-color: #242424 !important;
    border-bottom-color: #454d55 !important;
    color: #e0e0e0 !important;
  }
  
  tbody tr:nth-child(even) {
    background-color: #1e1e1e;
    
    td {
      background-color: #1e1e1e !important;
    }
  }
  
  tbody tr:hover {
    background-color: #2a2a2a !important;
    
    td {
      background-color: #2a2a2a !important;
    }
  }
  
  td:first-child,
  th:first-child {
    background-color: #323232 !important;
    border-right-color: #454d55;
    font-weight: 500;
  }
}

// Table container
.table-container,
.cell-output-display {
  table {
    th {
      background-color: #2c2c2c !important;
      color: #f0f0f0 !important;
    }
    
    td {
      background-color: #242424 !important;
      color: #e0e0e0 !important;
    }
  }
}

// Code blocks
pre {
  background-color: #2c2c2c;
  color: #e6e6e6;
  border: 1px solid #454d55;
}

// Inline code
code {
  background-color: #2c2c2c;
  color: #e94560;  // Slightly pink/red for visibility
  padding: 0.2em 0.4em;
  border-radius: 3px;
}

// Code blocks inside pre (override inline styling)
pre code {
  color: #e6e6e6;
  background-color: transparent;
  padding: 0;
}

// Figures and captions
.figure-caption,
.caption,
figure figcaption,
.quarto-figure figcaption {
  color: #c0c0c0 !important;
  background-color: transparent !important;
}

// Footnotes and margin notes - critical fix
.sidenote,
.marginnote,
.margin-note,
aside,
.aside,
.column-margin,
.column-margin p,
.margin-caption,
div[class*="margin"] {
  color: #c0c0c0 !important;
  background-color: transparent !important;
}

// Footnote references and content
.footnote-ref,
.footnotes,
.footnotes p,
.footnotes li,
#footnotes {
  color: #c0c0c0 !important;
}

// Margin content (where footnotes appear)
.page-columns .column-margin {
  color: #c0c0c0 !important;
}

// Quarto's margin content
.margin-caption,
.column-margin > * {
  color: #c0c0c0 !important;
}

// Navbar
.navbar {
  background-color: $navbar-bg-dark !important;
  border-bottom: 1px solid $border-color-dark;
}

.navbar-nav .nav-link {
  color: #adb5bd !important;
  
  &:hover {
    color: $link-color-dark !important;
  }
  
  &.active {
    color: $link-color-dark !important;
  }
}

// Footer
.page-footer {
  background-color: $navbar-bg-dark;
  border-top-color: $border-color-dark;
  color: #adb5bd;
}

// Blockquotes
blockquote {
  border-left-color: #6c757d;
  background-color: #232323;
  color: #d0d0d0;
}

// Announcement bar - enhanced dark mode visibility
.alert-primary,
.announcement {
  background: linear-gradient(135deg, 
    rgba($crimson-dark, 0.25) 0%, 
    rgba($crimson-dark, 0.18) 100%) !important;
  border-color: rgba($crimson-dark, 0.6) !important;
  border-left: 4px solid $crimson-dark !important;
  color: #f0f0f0 !important;  // Bright white for main text
  
  // All text elements in the banner
  p, span, strong, em {
    color: #f0f0f0 !important;
  }
  
  // Links in the banner
  a {
    color: lighten($crimson-dark, 25%) !important;  // Extra bright for visibility
    font-weight: 500;
    text-decoration: none;
    
    &:hover {
      color: lighten($crimson-dark, 35%) !important;  // Super bright on hover
      text-decoration: underline !important;
    }
    
    &:visited {
      color: lighten($crimson-dark, 25%) !important;
    }
  }
  
  // Icons in the banner (if using Bootstrap icons)
  .bi {
    color: $crimson-dark !important;
  }
}

// Code listings
.listing figure {
  border-color: #454d55;
  background: linear-gradient(135deg, #2c2c2c 0%, #232323 100%);
}

.listing figcaption,
.listing .listing-caption {
  background: linear-gradient(135deg, #2c2c2c 0%, #252525 100%) !important;
  border-bottom-color: #454d55 !important;
  color: #e6e6e6 !important;
}

.listing .sourceCode {
  background-color: #1e1e1e !important;
}

// Video containers
.video-container {
  border-color: rgba(255, 255, 255, 0.1);
}

// Embedded iframes (Google Looker Studio, etc.)
// We can't control their internal styling, but we can frame them nicely
iframe {
  background-color: #ffffff;  // Ensure white background
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

// Wrapper for embedded content
div:has(> iframe) {
  background-color: #2c2c2c;
  padding: 1rem;
  border-radius: 12px;
  border: 1px solid #454d55;
}

// Support sections
.support-mission,
.podcast-section {
  background-color: #232323;
  border-color: #454d55;
  
  p {
    color: #d0d0d0;
  }
}

// Button styling
.btn-primary {
  background-color: $crimson-dark;
  border-color: $crimson-dark;
  color: #1a1a1a;
  font-weight: 500;
  
  &:hover {
    background-color: lighten($crimson-dark, 10%);
    border-color: lighten($crimson-dark, 10%);
  }
}

.github-star-btn {
  background-color: $crimson-dark !important;
  color: #1a1a1a !important;
  
  &:hover {
    background-color: lighten($crimson-dark, 10%) !important;
  }
}

// Back to top button
.back-to-top,
#quarto-back-to-top {
  background-color: $crimson-dark !important;
  color: #1a1a1a !important;
  border: 1px solid lighten($crimson-dark, 10%);
  
  &:hover {
    background-color: lighten($crimson-dark, 15%) !important;
  }
}

// Foldbox callouts (custom numbered blocks) - override for manual dark mode toggle
details.fbx-default,
details.fbx-answer,
details.fbx-question,
details.callout-quiz-question,
details.callout-quiz-answer,
details.callout-example,
details.callout-definition,
details.callout-chapter-connection,
details.callout-chapter-forward,
details.callout-chapter-recall,
details.callout-resource-slides,
details.callout-resource-videos,
details.callout-resource-exercises,
details.callout-code {
  --text-color: #e6e6e6 !important;
  border-color: #454d55 !important;
}

// Foldbox summary headers - ensure bright, legible text
details.callout-quiz-question summary,
details.callout-quiz-question summary strong,
details.callout-quiz-question > summary,
details.callout-quiz-answer summary,
details.callout-quiz-answer summary strong,
details.callout-quiz-answer > summary,
details.callout-example summary,
details.callout-example summary strong,
details.callout-example > summary,
details.callout-definition summary,
details.callout-definition summary strong,
details.callout-definition > summary {
  color: #f0f0f0 !important;
}

// Other foldbox callout headers
details.callout-chapter-connection summary,
details.callout-chapter-forward summary,
details.callout-chapter-recall summary,
details.callout-resource-slides summary,
details.callout-resource-videos summary,
details.callout-resource-exercises summary,
details.callout-code summary {
  color: #e6e6e6 !important;
}

// Foldbox background colors for dark mode
details.callout-quiz-question {
  --background-color: rgba(91, 75, 138, 0.12) !important;
  --title-background-color: rgba(91, 75, 138, 0.12) !important;
  border-color: #5B4B8A !important;
}

details.callout-quiz-answer {
  --background-color: rgba(74, 124, 89, 0.12) !important;
  --title-background-color: rgba(74, 124, 89, 0.12) !important;
  border-color: #4a7c59 !important;
}

details.callout-example {
  --background-color: rgba(20, 143, 119, 0.12) !important;
  --title-background-color: rgba(20, 143, 119, 0.12) !important;
  border-color: #148F77 !important;
}

details.callout-definition {
  --background-color: rgba(27, 79, 114, 0.12) !important;
  --title-background-color: rgba(27, 79, 114, 0.12) !important;
  border-color: #1B4F72 !important;
}

details.callout-chapter-connection,
details.callout-chapter-forward {
  --background-color: rgba(165, 28, 48, 0.12) !important;
  --title-background-color: rgba(165, 28, 48, 0.12) !important;
  border-color: #A51C30 !important;
}

details.callout-chapter-recall {
  --background-color: rgba(192, 96, 20, 0.12) !important;
  --title-background-color: rgba(192, 96, 20, 0.12) !important;
  border-color: #C06014 !important;
}

details.callout-resource-slides,
details.callout-resource-videos,
details.callout-resource-exercises {
  --background-color: rgba(32, 178, 170, 0.12) !important;
  --title-background-color: rgba(32, 178, 170, 0.12) !important;
  border-color: #20B2AA !important;
}

details.callout-code {
  --background-color: rgba(60, 72, 88, 0.12) !important;
  --title-background-color: rgba(60, 72, 88, 0.12) !important;
}

// Foldbox content body dark backgrounds
details.fbx-default > div,
details.fbx-answer > div,
details.fbx-question > div,
details.callout-quiz-question > div,
details.callout-quiz-answer > div,
details.callout-example > div,
details.callout-definition > div,
details.callout-chapter-connection > div,
details.callout-chapter-forward > div,
details.callout-chapter-recall > div,
details.callout-resource-slides > div,
details.callout-resource-videos > div,
details.callout-resource-exercises > div,
details.callout-code > div {
  background-color: #212529 !important;
  color: #e6e6e6 !important;
}

// Foldbox arrows in dark mode
details.fbx-default > summary::after,
details.fbx-answer > summary::after,
details.fbx-question > summary::after,
details.callout-quiz-question > summary::after,
details.callout-quiz-answer > summary::after,
details.callout-example > summary::after,
details.callout-definition > summary::after {
  background-color: #e6e6e6 !important;
}

// Foldbox code elements in dark mode
details.callout-example code,
details.callout-definition code {
  color: #e6e6e6 !important;
}

// Links inside foldbox callouts - ensure bright hover
details.fbx-default a,
details.fbx-answer a,
details.fbx-question a,
details.callout-quiz-question a,
details.callout-quiz-answer a,
details.callout-example a,
details.callout-definition a,
details.callout-chapter-connection a,
details.callout-chapter-forward a,
details.callout-chapter-recall a,
details.callout-resource-slides a,
details.callout-resource-videos a,
details.callout-resource-exercises a,
details.callout-code a {
  color: $crimson-dark !important;
  
  &:hover {
    color: lighten($crimson, 20%) !important;
    text-decoration: underline !important;
  }
  
  &:visited {
    color: lighten($crimson, 10%) !important;
  }
}


